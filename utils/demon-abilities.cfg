#textdomain wesnoth-Genesis

#define ABILITY_FAUX_VISAGE
    [dummy]
        id=faux_visage
        name= _ "faux visage"
        description= _"This unit sometimes takes on the form of a different unit."
    [/dummy]
#enddef

#define WEAPON_SPECIAL_OBLIVION
    [dummy]
        id=abeyance
        name= _ "oblivion"
        name_inactive= _ "oblivion"
        description= _ "This attack will deal 10 bonus damage that ignores all resists."
        description_inactive= _ "This attack will deal 10 bonus damage that ignores all resists."
    [/dummy]
#enddef

#define ABILITY_GNS_INVISIBILITY
    [hides]
        id=invisibility
        name= _ "invisibility"
        female_name= _ "invisibility"
        description= _ "The unit is invisible.

Enemy units cannot see this unit, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        name_inactive= _ "invisibility"
        female_name_inactive= _ "female^invisibility"
        description_inactive= _ "The unit is invisible.

Enemy units cannot see this unit, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
    [/hides]
#enddef

#define WEAPON_SPECIAL_ABEYANCE2
    [dummy]
        id=abeyance
        name= _ "abeyance"
        name_inactive= _ "abeyance"
        description= _ "This attack does 3 damage that ignores all resists."
        description_inactive= _ "This attack does 3 damage that ignores all resists."
    [/dummy]
#enddef

#define WEAPON_SPECIAL_ABYSS
    [dummy]
        id=abeyance
        name= _ "abyss"
        name_inactive= _ "abyss"
        description= _ "This attack will deal 15 bonus damage that ignores all resists."
        description_inactive= _ "This attack will deal 15 bonus damage that ignores all resists."
    [/dummy]
#enddef

#define ABILITY_TERROR_LEVEL_2
    [leadership]
        id=terror
        value=-45
        cumulative=no
		name= _ "terror"
		description= _ "This unit can frighten enemy units that are next to it, making them fight worse.

Adjacent enemy units of the same or lower level will do less damage in battle. When an enemy unit of the same or lower level is adjacent and engages in combat, its attacks do 15% less damage times the difference in their levels + 15%."
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-30
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-15
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=2
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef

#define ABILITY_TERROR_LEVEL_3
    [leadership]
        id=terror
        value=-60
        cumulative=no
		name= _ "terror"
		description= _ "This unit can frighten enemy units that are next to it, making them fight worse.

Adjacent enemy units of the same or lower level will do less damage in battle. When an enemy unit of the same or lower level is adjacent and engages in combat, its attacks do 15% less damage times the difference in their levels + 15%."
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-45
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-30
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=2
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-15
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=3
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef
#define ABILITY_INCORPOREAL
    [dummy]
        id=gns_incorporeal
        name= _ "incorporeal"
		female_name= _ "female^incorporeal"
        description= _ "This unit will not take damage from physical attacks, except for blows that will kill it."
    [/dummy]
#enddef
#define ABILITY_DECOMPOSITION
    [dummy]
        id=decomposition
        name= _ "decomposition"
		female_name= _ "female^decomposition"
        description= _ "This unit will reduce the hitpoints of nearby enemies in half (within a radius of 4) on each new turn."
    [/dummy]
#enddef


#define GNS_INCORPOREAL TYPE
	[event]
        name=attacker hits
        first_time_only=no
		[filter_attack]
			type=impact
			[or]
				type=pierce
			[/or]
			[or]
				type=blade
			[/or]
		[/filter_attack]
		[filter_second]
            type={TYPE}
			ability=gns_incorporeal
		[/filter_second]
		[if]
			[variable]
				name=second_unit.hitpoints
				greater_than=1
			[/variable]
			[then]
				[heal_unit]
					[filter]
						x,y=$x2,$y2
					[/filter]
					amount=$damage_inflicted
					animate=yes
					restore_statuses=no
				[/heal_unit]
			[/then]
		[/if]
	[/event]
	[event]
        name=defender hits
        first_time_only=no
		[filter_second_attack]
			type=impact
			[or]
				type=pierce
			[/or]
			[or]
				type=blade
			[/or]
		[/filter_second_attack]
		[filter]
            type={TYPE}
			ability=gns_incorporeal
		[/filter]
		[if]
			[variable]
				name=unit.hitpoints
				greater_than=1
			[/variable]
			[then]
				[heal_unit]
					[filter]
						x,y=$x1,$y1
					[/filter]
					amount=$damage_inflicted
					animate=yes
					restore_statuses=no
				[/heal_unit]
			[/then]
		[/if]
	[/event]
#enddef
#define WEAPON_SPECIAL_MIRRORFORCE
    [dummy]
        id=mirrorforce
        name= _ "mirror force"
        name_inactive= _ "mirror force"
        description= _ "This attack reflects 50% of all damage."
        description_inactive= _ "This attack reflects 50% of all damage."
    [/dummy]
#enddef
#define MIRRORFORCE
	[event]
        name=attacker hits
        first_time_only=no
		[filter_second_attack]
			special=mirrorforce
		[/filter_second_attack]
		[if]
			[variable]
				name=second_unit.hitpoints
				greater_than=1
			[/variable]
			[then]
                {VARIABLE_OP damage_inflicted multiply 0.5}
				[heal_unit]
					[filter]
						x,y=$x2,$y2
					[/filter]
					amount=$damage_inflicted
					animate=no
					restore_statuses=no
				[/heal_unit]
                [harm_unit]
					[filter]
						x,y=$x1,$y1
					[/filter]
                    kill=no
					amount=$damage_inflicted
					animate=no
					restore_statuses=no
				[/harm_unit]
			[/then]
		[/if]
	[/event]
	[event]
        name=defender hits
        first_time_only=no
		[filter_attack]
			special=mirrorforce
		[/filter_attack]
		[if]
			[variable]
				name=unit.hitpoints
				greater_than=1
			[/variable]
			[then]
                {VARIABLE_OP damage_inflicted multiply 0.5}
				[heal_unit]
					[filter]
						x,y=$x1,$y1
					[/filter]
					amount=$damage_inflicted
					animate=no
					restore_statuses=no
				[/heal_unit]
                [harm_unit]
					[filter]
						x,y=$x2,$y2
					[/filter]
                    kill=no
					amount=$damage_inflicted
					animate=no
					restore_statuses=no
				[/harm_unit]
			[/then]
		[/if]
	[/event]
#enddef

#define ABILITY_ETHEREAL
    [dummy]
        id=gns_ethereal
        name= _ "ethereal"
		female_name= _ "female^ethereal"
        description= _ "This unit will not take damage from arcane or fire attacks, except for those that will kill it."
    [/dummy]
#enddef
#define ETHEREAL TYPE
	[event]
        name=attacker hits
        first_time_only=no
		[filter_attack]
			type=fire
			[or]
				type=arcane
			[/or]
		[/filter_attack]
		[filter_second]
            type={TYPE}
			ability=gns_ethereal
		[/filter_second]
		[if]
			[variable]
				name=second_unit.hitpoints
				greater_than=1
			[/variable]
			[then]
				[heal_unit]
					[filter]
						x,y=$x2,$y2
					[/filter]
					amount=$damage_inflicted
					animate=yes
					restore_statuses=no
				[/heal_unit]
			[/then]
		[/if]
	[/event]
	[event]
        name=defender hits
        first_time_only=no
		[filter_second_attack]
			type=fire
			[or]
				type=arcane
			[/or]
		[/filter_second_attack]
		[filter]
            type={TYPE}
			ability=gns_ethereal
		[/filter]
		[if]
			[variable]
				name=unit.hitpoints
				greater_than=1
			[/variable]
			[then]
				[heal_unit]
					[filter]
						x,y=$x1,$y1
					[/filter]
					amount=$damage_inflicted
					animate=yes
					restore_statuses=no
				[/heal_unit]
			[/then]
		[/if]
	[/event]
#enddef
#define WEAPON_SPECIAL_COUNTERSTRIKE   
    [attacks]        
		id=counterstrike        
		name= _ "counterstrike"       
		description= _ "The opponent has a 0% chance to hit when this attack is used offensively."   	
		value=0        
		cumulative=no     
		apply_to=opponent
		active_on=offense  
    [/attacks]
#enddef
#define WEAPON_SPECIAL_TERROR
    [damage]
        id=terror
        name= _ "terror"
        name_inactive= _ "terror"
        description= _ "Enemies deal half damage when this attack is used."
        description_inactive= _ "Enemies deal half damage when this attack is used."
        apply_to=opponent
        multiply=0.5
    [/damage]
#enddef

#define WEAPON_SPECIAL_SPELLBIND1
    [damage]
        id=spellbind1
        name= _ "spell bind"
        name_inactive= _ "spell bind"
        description= _ "When this attack is used, all spell damage taken will be reduced by 70%."
        description_inactive= _ "When this attack is used, all spell damage taken will be reduced by 70%."
		[filter_opponent]
			[filter_weapon]
				type=fire,cold,arcane
			[/filter_weapon]
		[/filter_opponent]
        apply_to=opponent
        multiply=0.3
    [/damage]
#enddef

#define ABILITY_ENERVATE20
    [leadership]
        id=enervate20
        value=-20
        cumulative=no
        name= _ "enervate"
        female_name= _ "female^enervate"
        description= _ "This unit reduces the damage of nearby enemies by 20%."
        affect_self=no
		affect_allies=no
		affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/leadership]
#enddef

#define ABILITY_ENERVATE30
    [leadership]
        id=enervate30
        value=-30
        cumulative=no
        name= _ "enervate"
        female_name= _ "female^enervate"
        description= _ "This unit reduces the damage of nearby enemies by 30%."
        affect_self=no
		affect_allies=no
		affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/leadership]
#enddef
#define WEAPON_SPECIAL_SCORCHED_EARTH
    [dummy]
        id=scorched_earth
        name= _ "scorched earth"
        name_inactive= _ "scorched earth"
        description= _ "On attack, this weapon burns the nearby ground that it strikes. Units that stand on patches of earth that have been struck within the last 10 turns are dealt 3 damage (stacking) upon turn refresh."
        description_inactive= _ "On attack, this weapon burns the nearby ground that it strikes. Units that stand on patches of earth that have been struck within the last 10 turns are dealt 3 damage (stacking) upon turn refresh."
    [/dummy]
#enddef
#define SCORCHED_EARTH TURNS DMG
    [event]
        name=attacker_hits
        first_time_only=no
        [filter_attack]
			special=scorched_earth
        [/filter_attack]
		[store_unit]
            [filter]
                x,y=$x2,$y2
            [/filter]
			variable=opp
        [/store_unit]
		{PLAY_SOUND "flame-big.ogg"}
		[terrain]
			x,y=$x2,$y2
			radius=1
			terrain=Rd
		[/terrain]
		[item]
			x,y=$x2,$y2
			radius=1
			image=misc/blank-hex.png~NOP()~NOP()~NOP()~NOP() 
			halo=scenery/flames[01~15].png:120 
		[/item]
		[set_variables]
			name=searthloc
			mode=append
			[value]
				x=$x2
				y=$y2
				turn_num=0
			[/value]
		[/set_variables]
		{CLEAR_VARIABLE opp}
	[/event]
	[event]
		name=new turn
		first_time_only=no
		{VARIABLE sedmg {DMG}}
		{VARIABLE endturn {TURNS}}
		{VARIABLE_OP endturn add 1}
		{FOREACH searthloc i}
		{VARIABLE_OP searthloc[$i].turn_num add 1}
		[if]
			[have_unit]
				x,y=$searthloc[$i].x,$searthloc[$i].y
				[or]
					[filter_location]
						[filter_adjacent_location]
							x,y=$searthloc[$i].x,$searthloc[$i].y
						[/filter_adjacent_location]
					[/filter_location]
				[/or]
			[/have_unit]
			[and]
				[variable]
					name=searthloc[$i].turn_num
					less_than_equal={TURNS}
				[/variable]
			[/and]
			[then]
				{PLAY_SOUND "flame-big.ogg"}
				[harm_unit]
					[filter]
						x,y=$searthloc[$i].x,$searthloc[$i].y
						[or]
							[filter_location]
								[filter_adjacent_location]
									x,y=$searthloc[$i].x,$searthloc[$i].y
								[/filter_adjacent_location]
							[/filter_location]
						[/or]
					[/filter]
					fire_event=yes
					animate=yes
					type=fire
					amount=$sedmg
					delay=100
				[/harm_unit]
			[/then]
		[/if]
		[if]
			[variable]
				name=searthloc[$i].turn_num
				numerical_equals=$endturn
			[/variable]
			[then]
				[remove_item] 
					x,y=$searthloc[$i].x,$searthloc[$i].y
					radius=1
					image=misc/blank-hex.png~NOP()~NOP()~NOP()~NOP() 
				[/remove_item]
			[/then]
		[/if]
		{NEXT i}
		{CLEAR_VARIABLE sedmg}
	[/event]
	[event]
		name=victory
		first_time_only=no
		{CLEAR_VARIABLE searthloc}
	[/event]
#enddef
#define ABILITY_BLITZ
    [dummy]
        id=blitz
        name= _ "blitz"
        description= _"This unit can attack three times in one turn."
    [/dummy]
#enddef

#define BLITZ
	[event]
		name=new turn
		first_time_only=no
		[if]
			[have_unit]
				ability=blitz
			[/have_unit]
			[then]
				[modify_unit]
					[filter]
						ability=blitz
					[/filter]
					max_attacks=3
					attacks_left=3
				[/modify_unit]
			[/then]
		[/if]
	[/event]
	[event]
		name=attack_end
		first_time_only=no
		[if]
			[have_unit]
				ability=blitz
				[filter]
					ability=blitz
					x,y=$x1,$y1
				[/filter]
			[/have_unit]
			[then]
				[modify_unit]
					[filter]
						ability=blitz
					[/filter]
					moves=5
				[/modify_unit]
			[/then]
		[/if]
	[/event]
#enddef

#define ABILITY_DREAMWALK
    [dummy]
        id=dreamwalk
        name= _ "dreamwalk"
        name_inactive= _ "dreamwalk"
        description= _ "This unit heals 40% of its missing health a turn and can generate copies of itself."
        description_inactive= _ "This unit heals 40% of its missing health a turn and can generate copies of itself."
    [/dummy]
#enddef

#define ABILITY_DREAMWEAVE
    [dummy]
        id=dreamweave
        name= _ "dreamweave"
        name_inactive= _ "dreamweave"
        description= _ "This unit generates a copy of each adjacent unit on each turn."
        description_inactive= _ "This unit generates a copy of each adjacent unit on each turn."
    [/dummy]
#enddef

#define ABILITY_NOCTURNE
    [dummy]
        id=nocturne
        name= _ "nocturne"
		female_name= _ "female^nocturne"
        description= _ "This unit generates a copy of nearby units (within a radius of 3) on each turn."
        description_inactive= _ "This unit generates a copy of nearby (within a radius of 3)  units on each turn."
    [/dummy]
#enddef
#define WEAPON_SPECIAL_MIRROR
    [dummy]
        id=mirror
        name= _ "mirror"
        name_inactive= _ "mirror"
        description= _ "This attack copies the attack used against it."
        description_inactive= _ "This attack copies the attack used against it."
    [/dummy]
#enddef

#define ABILITY_DEVOUR
    [dummy]
        id=essence_devouring
        name= _ "devour"
        name_inactive= _ "devour"
        description= _ "This unit deals 3 damage to nearby enemies on each new turn and heals for half the damage dealt."
        description_inactive= _ "This unit deals 3 damage to nearby enemies on each new turn and heals for half the damage dealt."
    [/dummy]
#enddef

#define ESSENCE_DEVOURING
    [event]
        name=new turn
        first_time_only=no

		[store_unit]
            [filter]				
                [filter_adjacent]
					ability=essence_devouring
                    is_enemy=yes
                [/filter_adjacent]
            [/filter]
            variable=opp
        [/store_unit]
        [store_unit]
            [filter]               
				ability=essence_devouring
            [/filter]
            variable=unit
        [/store_unit]
		{VARIABLE counter 0}
		{FOREACH opp i}
			{VARIABLE_OP counter add 1}
		{NEXT i}
		{FOREACH opp i}
		[harm_unit]
			[filter]
				x,y=$opp[$i].x,$opp[$i].y
			[/filter]
			fire_event=yes
			animate=yes						
			amount=3
			delay=25
		[/harm_unit]
		[if]
			[have_unit]
				x,y=$opp[$i].x,$opp[$i].y
			[/have_unit]
			[else]
				{VARIABLE exp $opp[$i].level}
				{VARIABLE_OP exp multiply 8}
				{VARIABLE_OP unit.experience add $exp}
				{CLEAR_VARIABLE exp}
				[unstore_unit]
					variable=unit
					find_vacant=no
				[/unstore_unit]
			[/else]
		[/if]
        {NEXT i}
		{VARIABLE_OP counter multiply 1.5}
		[heal_unit]
			[filter]
				ability=essence_devouring
			[/filter]
			amount=$counter
			animate=yes
		[/heal_unit]
		{CLEAR_VARIABLE opp}
        {CLEAR_VARIABLE unit}
		{CLEAR_VARIABLE counter}
	[/event]
#enddef

# don't use this one for now, I can't get it to work
#define MIRROR_DOESNOTWORK
	[event]
		id=mirror_dreamlord1
		name=attack
		first_time_only=no
		[filter_attack]
			special=mirror
        [/filter_attack]
		
		[store_unit]
			[filter]
				x,y=$x1,$y1
			[/filter]
			variable=attacker
		[/store_unit]
		[store_unit]
			[filter]
				x,y=$x2,$y2
			[/filter]
			variable=defender
		[/store_unit]
		
		[set_variable]
			name=defender.image
			value=$attacker.image
		[/set_variable]
		[set_variable]
			name=defender.profile
			value=$attacker.profile
		[/set_variable]
		[set_variable]
			name=defender.small_profile
			value=$attacker.small_profile
		[/set_variable]
		[set_variable]
			name=defender.facing
			value=$attacker.facing
		[/set_variable]
		[set_variable]
			name=defender.advances_to
			value=$attacker.advances_to
		[/set_variable]
		[set_variable]
			name=defender.name
			value=$attacker.name
		[/set_variable]
		[set_variable]
			name=defender.alignment
			value=$attacker.alignment
		[/set_variable]
		[set_variable]
			name=defender.id
			value=$attacker.id
		[/set_variable]
		[set_variable]
			name=defender.race
			value=$attacker.race
		[/set_variable]
		[set_variable]
			name=defender.movement_type
			value=$attacker.movement_type
		[/set_variable]
		[set_variable]
			name=defender.level
			value=$attacker.level
		[/set_variable]
		[set_variable]
			name=defender.side
			value=$attacker.side
		[/set_variable]
		[set_variable]
			name=defender.flying
			value=$attacker.flying
		[/set_variable]
		[set_variable]
			name=defender.gender
			value=$attacker.gender
		[/set_variable]
		[set_variable]
			name=defender.max_experience
			value=$attacker.max_experience
		[/set_variable]
		[set_variable]
			name=defender.experience
			value=$attacker.experience
		[/set_variable]
		[set_variable]
			name=defender.max_hitpoints
			value=$attacker.max_hitpoints
		[/set_variable]
		[set_variable]
			name=defender.hitpoints
			value=$attacker.hitpoints
		[/set_variable]
		[set_variable]
			name=defender.type
			value=$attacker.type
		[/set_variable]
		
		[set_variable]
			name=attacker_mirror
			value=1
		[/set_variable]
		[set_variable]
			name=defender_mirror
			value=0
		[/set_variable]
		
		[unstore_unit]
			variable=defender
			x,y=$x1,$y1
		[/unstore_unit]
		
		[object]
			take_only_once=no
			silent=yes
			[filter]
				x,y=$x1,$y1
			[/filter]
			[effect]
				apply_to=remove_attacks
				[not]
					name=$second_weapon.name
				[/not]
			[/effect]
		[/object]
		

	[/event]
	[event]
        name=attack end
		id=mirror_dreamlord_end
        first_time_only=no	
		
		[if]
			[variable]
				name=attacker_mirror
				numerical_equals=1
			[/variable]
			[then]
				#[unstore_unit]
				#	variable=attacker
				#[/unstore_unit]
			[/then]
		[/if]
		
#		{CLEAR_VARIABLE attacker_mirror}
#		{CLEAR_VARIABLE defender_mirror}		
#		{CLEAR_VARIABLE attacker}
#		{CLEAR_VARIABLE defender}		
	[/event]
#enddef