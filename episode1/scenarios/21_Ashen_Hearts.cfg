#textdomain wesnoth-Genesis

[scenario]
    id=21_Ashen_Hearts
    name= _ "Ashen Hearts - III"
    map_data="{~add-ons/Genesis/episode1/maps/21_Ashen_Hearts.map}"
    next_scenario=null
    next_scenario=22_Moonlit_Night
    disallow_recall=no
    theme=Cutscene
    victory_when_enemies_defeated=no
    turns=-1
    {DARK_INDOORS}

    {SCENARIO_MUSIC underground.ogg}
    {EXTRA_SCENARIO_MUSIC snowfall.ogg}

    [side]
        type=Fire Fae
        id=Esther
        side=1
        controller=human
        recruit=
        gold=100
        income=-2
        village_gold=0
        village_support=0
        fog=yes
        shroud=yes
        team_name=fae
        user_team_name= _ "team_name^Fae"
    [/side]
    [side]
        side=2
        no_leader=yes
        user_team_name= _ "team_name^Undead"
        team_name=demons
        hidden=yes
        color=black
        [ai]
            aggression=1
            caution=0
            grouping=false
        [/ai]
    [/side]
    [side]
        side=3
        no_leader=yes
        user_team_name= _ "team_name^Hybrids"
        team_name=demons
        {GOLD 300 325 400}
        {INCOME 35 37 45}
        recruit=Wraith,Shadow
        hidden=yes
        color=black
        [ai]
            aggression=1
            caution=0
            grouping=false
        [/ai]
    [/side]
    [side]
        side=4
        no_leader=yes
        user_team_name= _ "team_name^Blue Demons"
        team_name=demons
        hidden=yes
        color=blue
        [ai]
            aggression=1
            caution=0
            grouping=false
        [/ai]
    [/side]
    [side]
        side=5
        no_leader=yes
        user_team_name= _ "team_name^Black Demons"
        team_name=demons
        hidden=yes
        color=black
        [ai]
            aggression=1
            caution=0
            grouping=false
        [/ai]
    [/side]
    [side]
        side=6
        no_leader=yes
        team_name=demons
        user_team_name= _ "team_name^Copies"
        hidden=yes
        color=blue
    [/side]
    [side]
        side=7
        no_leader=yes
        team_name=merthiaal
        hidden=yes
        color=black
    [/side]

    [event]
        name=prestart

        {VARIABLE part2 0}
        {VARIABLE part3 0}
        {VARIABLE part4 0}
        {VARIABLE boss_stage 0}
        {VARIABLE illusion_flag 0}
        {VARIABLE ud_spawns1 0}
        {VARIABLE ud_spawns2 0}
        {VARIABLE puzzle_counter 0}
        {VARIABLE turn_count 0}
    [/event]

    [event]
        name=unit placed
        first_time_only=no
        [filter]
            side=1
        [/filter]

        [object]
            silent=yes
            duration=scenario
            [filter]
                x,y=$x1,$y1
            [/filter]
            [effect]
                apply_to=loyal
            [/effect]
        [/object]
    [/event]

    [event]
        name=start

        {RECALL_ARYEL 10 2}
        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]
        {RECALL_YUMI 9 2}
        [message]
            speaker=Aryel
            message= _ "I guess we should find somewhere more secluded than this. Follow me."
        [/message]

        [move_unit]
            id=Aryel
            to_x,to_y=12,4
        [/move_unit]
        [move_unit]
            id=Yumi
            to_x,to_y=11,4
        [/move_unit]
        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]
        {TURN_UNIT5 "Aryel"}
        [message]
            speaker=Aryel
            message= _ "That way."
        [/message]
        [move_unit]
            id=Aryel
            to_x,to_y=9,8
        [/move_unit]
        [move_unit]
            id=Yumi
            to_x,to_y=10,7
        [/move_unit]
        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]
        {DELAY 500}
        [move_unit]
            id=Aryel
            to_x,to_y=6,12
        [/move_unit]
        {DELAY 1500}
        [move_unit]
            id=Yumi
            to_x,to_y=6,11
        [/move_unit]
        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]
        [message]
            speaker=Aryel
            message= _ "Why are you so nervous, Yumi? It's just us."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shrugs</i>)"
        [/message]
        [move_unit]
            id=Aryel
            to_x,to_y=10,16
        [/move_unit]
        [move_unit]
            id=Yumi
            to_x,to_y=9,16
        [/move_unit]
        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]
        {DELAY 500}
        [move_unit]
            id=Aryel
            to_x,to_y=14,16
        [/move_unit]
        [move_unit]
            id=Yumi
            to_x,to_y=15,17
        [/move_unit]
        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]
        {MODIFY_UNIT (id=Yumi) facing sw}
        [message]
            speaker=Aryel
            message= _ "Okay, Yumi. Talk."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>bites lip</i>)"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>Is it wise to tell her?</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>I...</i>"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Hello? Did you hear me?"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>She will become part of your nightmare. If you allow her to enter your thoughts, she will be in danger.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>But-</i>"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yumi."
        [/message]
        {TURN_UNIT5 "Yumi"}
        {MODIFY_UNIT (id=Yumi) facing sw}
        [message]
            speaker=Yumi
            message= _ "<i>I said I would tell her.</i>"
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>rubs temples</i>) I am getting <i>so</i> tired of this. I'm tired of being hunted by the demons day and night and I'm sick of not knowing who I can trust. And... the way you keep secrets from me... (<i>quietly</i>) sometimes it feels like I can't trust you either."
        [/message]
        [message]
            speaker=Yumi
            message= _ "B-but..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "But?"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>It will become her problem as well. Better frustrated than dead.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "I can't say it."
        [/message]
        [message]
            speaker=Aryel
            message= _ "..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>clenches hands</i>)"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Seriously?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "How many times are we going to have to go through this? It's always the same story. You can't tell me anything because if I sucked into your mess, I'll be in danger too, and blah blah blah-"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>whispers</i>) But it's true..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "No. No it's absolutely not. I've put up with this for long enough. Stop being a little brat. Tell me what you know. What are these blue demons? Who sent them here and why are they after us?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "I-I... don't know..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yes you do! At this point, your excuse of being shy is not going to cut it either-"
        [/message]
        [message]
            speaker=Yumi
            message= _ "I'm not trying to make excuses-"
        [/message]
        [message]
            speaker=Aryel
            message= _ "You're just like a spoiled child! I've given you so much time and space, yet you still haven't come up with even one coherent sentence about why you're keeping all these secrets, let alone your idiotic behavior."
        [/message]
        [message]
            speaker=Yumi
            message= _ "Aryel..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "But no matter what I say, you just <i>won't listen</i>. It's like my feelings don't even matter to you. You might think that you're protecting me by keeping me in the dark, and maybe that's true, but don't you think I can be the judge of that? Hmm?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "I can't tell you..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "You're kidding. How do you expect me to trust you when you act like this?"
        [/message]
        {DELAY 750}
        {MODIFY_UNIT (id=Yumi) facing se}
        {DELAY 750}
        [message]
            speaker=Aryel
            message= _ "At least have the decency to look at me while I'm talking."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Come on, stop this juvenile behavior."
        [/message]
        {DELAY 1750}
        {MODIFY_UNIT (id=Aryel) facing sw}
        {DELAY 250}
        [message]
            speaker=Aryel
            message= _ "(<i>frustrated</i>) Ugh. Sometimes I wonder why we're even friends. I can't stand you when you get like this. You always say you want to be left alone and you tell us to stay out of it. Like seriously, if you keep saying that forever, I might as well just leave."
        [/message]
        [message]
            speaker=Aryel
            message= _ "There's no point in trying to talk to someone who doesn't even care at all. I shouldn't even bother with you. I shouldn't, but like-"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>closes eyes</i>)"
        [/message]
        {FADE_SCREEN}

        [store_unit]
            [filter]
                id=Yumi
            [/filter]
            variable=yumi
        [/store_unit]
        [kill]
            id=Yumi
        [/kill]
        [message]
            speaker=Aryel
            message= _ "I-"
        [/message]
        {DELAY 500}
        {UNFADE_SCREEN}
        {DELAY 500}
        [message]
            speaker=Aryel
            message= _ "I-"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yumi?"
        [/message]
        {TURN_UNIT5 "Aryel"}
        {DELAY 250}
        [message]
            speaker=Aryel
            message= _ "Oh my god. She ran away."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yumi? Yuuuumiii? Um. You there?"
        [/message]
        [message]
            speaker=narrator
            message= _ "(<i>silence</i>)"
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>covers face</i>) I was just so frustrated. I didn't mean to yell like that."
        [/message]
        [message]
            speaker=Aryel
            message= _ "..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "I'm so stupid."
        [/message]
        {DELAY 500}
        [move_unit]
            id=Aryel
            to_x,to_y=9,14
        [/move_unit]
        [message]
            speaker=Aryel
            message= _ "I can't believe I let my emotions get out of control like that."
        [/message]
        {DELAY 500}
        [move_unit]
            id=Aryel
            to_x,to_y=7,9
        [/move_unit]
        [message]
            speaker=Aryel
            message= _ "(<i>sighs</i>)"
        [/message]
        {DELAY 500}
        [move_unit]
            id=Aryel
            to_x,to_y=12,5
        [/move_unit]
        {MODIFY_UNIT (id=Aryel) facing se}
        [message]
            speaker=Aryel
            message= _ "I-I need to look for her."
        [/message]
        {DELAY 500}
        [unstore_unit]
            variable=esther
            x,y=6,1
        [/unstore_unit]
        [move_unit]
            id=Esther
            to_x,to_y=11,4
        [/move_unit]
        [message]
            speaker=Esther
            message= _ "Looks like I finally caught up."
        [/message]
        [message]
            speaker=Esther
            message= _ "Aryel? You look distraught. Did something happen? Where's Yumi?"
        [/message]
        {DELAY 250}
        {MODIFY_UNIT (id=Aryel) facing sw}
        {DELAY 250}
        [message]
            speaker=Aryel
            message= _ "Esther..."
        [/message]
        [message]
            speaker=Esther
            message= _ "Where's Yumi?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>in a tiny voice</i>) I... kind of blew up at her. For being so secretive and not telling us anything. Ohhh Esther, I can't believe I yelled at her like that... I must've made her feel terrible..."
        [/message]
        [message]
            speaker=Esther
            message= _ "You what?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "I cussed her out. For being so secretive and not telling us anything. Ohhh Esther, I can't believe I yelled at her like that... I must've made her feel terrible..."
        [/message]
        [message]
            speaker=Esther
            message= _ "You <i>what?</i>"
        [/message]
        [message]
            speaker=Aryel
            message= _ "I'm so, so stupid."
        [/message]
        [message]
            speaker=Esther
            message= _ "Ugh. You just had to-"
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>looks away</i>) I'm sorry."
        [/message]
        [message]
            speaker=Esther
            message= _ "(<i>takes deep breaths</i>)"
        [/message]
        [message]
            speaker=Esther
            message= _ "What's done is done. Right now, we need to look for her. It looks like there's a couple paths leading away from here, so it'll be faster if we split up. Some of the faerie offered to help us, so ask a few of them to help you look."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Esther..."
        [/message]
        [message]
            speaker=Esther
            message= _ "Don't get me wrong. I still think it's ridiculous how much trouble you two get in when I leave you alone, but our first priority is finding Yumi. You know how reckless she gets when she's upset."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>quietly</i>) I know."
        [/message]
        [message]
            speaker=Esther
            message= _ "... and it looks like you feel bad enough already, so a lecture from me isn't really going help. Just... just find her and bring her back safely, okay?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>nods</i>)"
        [/message]
        {DELAY 250}
        {FADE_SCREEN}
        [store_unit]
            [filter]
                id=Aryel
            [/filter]
            variable=aryel
        [/store_unit]
        [kill]
            id=Aryel,Esther
        [/kill]
        [place_shroud]
            side=1
            x=1-24
            y=1-19
        [/place_shroud]
        [replace_schedule]
            {ETERNALDARK}
        [/replace_schedule]
        {SCROLL_TO 43 4}
        [remove_shroud]
            side=1
            x,y=43,4
            radius=6
        [/remove_shroud]

        [fire_event]
            name=part2cutscene
        [/fire_event]
    [/event]

    [event]
        name=part2cutscene
        first_time_only=yes


        {UNFADE_SCREEN}

        [unstore_unit]
            variable=yumi
            x,y=43,4
        [/unstore_unit]
        {MODIFY_UNIT (id=Yumi) facing sw}
        {MODIFY_UNIT (id=Yumi) moves 6}
        [unhide_unit]
            [filter][/filter]
        [/unhide_unit]
        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]
        {DELAY 500}
        [message]
            speaker=Yumi
            message= _ "<i>Aryel...</i>"
        [/message]
        {DELAY 250}
        {COLOR_ADJUST 33 33 33}
        {DELAY 100}
        {COLOR_ADJUST 67 67 67}
        {DELAY 100}
        {COLOR_ADJUST 100 100 100}
        {DELAY 100}
        {COLOR_ADJUST 133 133 133}
        {DELAY 100}
        [unit]
            id=Fake Yumi
            type=Fake Shadow Fae
            side=7
            x,y=42,4
            find_vacant=yes
            name= _ "Yumi"
            random_traits=no
            animate=yes
            facing=ne
        [/unit]
        {DELAY 250}
        [message]
            speaker=Fake Yumi
            message= _ "<i>She hates you</i>."
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>She doesn't.</i>"
        [/message]
        [message]
            speaker=Fake Yumi
            message= _ "<i>She's sick of you being the way you are. She's tired of taking care of you.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>No.</i>"
        [/message]
        [message]
            speaker=Fake Yumi
            message= _ "<i>You're just a burden to them. She said it herself. Just give up.</i>"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>There's no point anyway. You cannot protect them. And by resisting the way you are, you're just making everyone's lives miserable.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>covers ears</i>)"
        [/message]
        [message]
            speaker=Fake Yumi
            message= _ "<i>You're just hurting her, you know. If you keep up like this, she really won't care about you anymore. It's not like they know the whole picture.</i>"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>Why bother? They'll all die in the end.</i>"
        [/message]
        [message]
            speaker=Fake Yumi
            message= _ "<i>She wants to cherish them while they still live. Letting them into that little head of hers will only accelerate the process.</i>"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>What does it matter? She cannot protect them indefinitely. And this way, they will not hate her.</i>"
        [/message]
        [message]
            speaker=Fake Yumi
            message= _ "<i>Aryel already does.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shakes head</i>)"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>She is stubborn.</i>"
        [/message]
        [message]
            speaker=Fake Yumi
            message= _ "<i>She always resists. Even with it encroaching on her mind already, she tries to face it alone... in order to keep everyone else safe from it.</i>"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>She wants to try, but it will kill them sooner or later.</i>"
        [/message]
        {DELAY 2000}
        [message]
            speaker=Yumi
            message= _ "<i>No. I won't let it.</i>"
        [/message]
        {DELAY 250}
        [kill]
            id=Fake Yumi
        [/kill]
        {DELAY 100}
        {COLOR_ADJUST 100 100 100}
        {DELAY 100}
        {COLOR_ADJUST 67 67 67}
        {DELAY 100}
        {COLOR_ADJUST 33 33 33}
        {DELAY 100}
        {COLOR_ADJUST 0 0 0}
        {DELAY 100}

        [message]
            speaker=Yumi
            message= _ "(<i>clutches chest</i>)"
        [/message]
        {DELAY 750}
        {PLAY_SOUND "magic-faeriefire.ogg"}
        {DELAY 500}
        [unit]
            type=Guardian of Darkness
            id=Merthiaal
            name= _ "Merthiaal"
            x,y=41,5
            side=7
            random_traits=no
            find_vacant=yes
            facing=ne
        [/unit]
        {DELAY 250}
        [message]
            speaker=Yumi
            message= _ "(<i>gasps</i>)"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "Relax. I'm just here to talk."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>glares</i>) You want to take my friends from me."
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "(<i>snorts</i>) Even if I wanted to, I wouldn't be able to just like that. It's not like this projection of mine can actually do anything."
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "I just want to talk to you."
        [/message]
        {DELAY 750}
        {MODIFY_UNIT (id=Yumi) facing se}
        {DELAY 750}
        [message]
            speaker=Merthiaal
            message= _ "Listen to me. The void grows more powerful day by day. You've seen what it can do to your world already. Just the tiniest sliver seeping through the cracks and you already were nearly overwhelmed trying to stop it. If we let it keep growing, it will destroy us all completely."
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "The other Guardians aren't even trying to stop it. Yarae doesn't even care. He's too busy holed up at the Well of Life, trying to manipulate it and the Tree to preserve his own soul. He'd sooner leave us to rot than risk trying to save us. And everyone else would rather buy into his lies than think for themselves."
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "So it's up to me to stop it. But I can't do it alone. I need your help."
        [/message]
        [message]
            speaker=narrator
            message= _ "(<i>silence</i>)"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "... Look at me. I need to know that you're listening to me."
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "..."
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "I won't ask twice."
        [/message]
        {DELAY 750}
        [move_unit]
            id=Merthiaal
            to_x,to_y=42,4
        [/move_unit]
        {DELAY 2000}
        {MODIFY_UNIT (id=Yumi) facing sw}
        {DELAY 500}
        [message]
            speaker=Merthiaal
            message= _ "Don't give me that face, brat. I'm not going to play these games with you anymore. I <i>know</i> what you are, and I know you can be useful to me. It's in your best interest to cooperate."
        [/message]
        [message]
            speaker=Yumi
            message= _ "Why would I be useful to you? I'm just a faerie."
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "No you're not. Faerie are physical beings who were birthed from the Tree of Life like almost everything else in our universe. You three are something else. You're made of pure energy that didn't come from the Tree or from any of the Guardians. You're from somewhere else entirely. Maybe you don't know the details, but you know I'm telling you the truth."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shrugs</i>)"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "(<i>snaps</i>) Don't you get it? That means you're a completely separate embodiment of an Aspect. While I can't absorb the power of other Aspects that stem from the Tree of Life, I have the ability to utilize yours <i>because</i> you don't come from the Tree."
        [/message]
        [message]
            speaker=Yumi
            message= _ "So?"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "So, if you three lend me your powers, I might be able to figure out a way to stop the void from consuming us all. If you don't, then we'll all just die miserably."
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>She's telling the truth... but not entirely. She's not saying how she intends to use our powers?</i>"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "Please. You have to help me. Nobody else trusts me. They all treat me like a child because I'm the youngest. They think I'm a lunatic. It's the same with you, isn't it?"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "But that's because they haven't seen it. Not like you and I have. Your nightmares are visions of the future, where all of creation is slaughtered in a mass of blood and darkness and chaos consumes our worlds as the void encroaches upon them. They won't believe me. Half of the others aren't even aware of it, while the rest think it can be stopped. Yarae knows the truth, but he doesn't care to help us. I have no one else to confide in."
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "I need you three to help me."
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>... I should, but... I can't right now.</i>"
        [/message]
        {DELAY 750}
        {MODIFY_UNIT (id=Yumi) facing se}
        {DELAY 1750}
        {MODIFY_UNIT (id=Yumi) facing sw}
        {DELAY 750}
        [message]
            speaker=Yumi
            message= _ "(<i>eyes glow</i>)"
        [/message]
        {WHITE_SCREEN}
        {DELAY 500}
        [kill]
            id=Merthiaal
        [/kill]
        {DELAY 500}
        {UNWHITE_SCREEN}
        [message]
            speaker=Yumi
            message= _ "<i>She'll be back later.</i>"
        [/message]

        [fade_out_music][/fade_out_music]
        {REPLACE_SCENARIO_MUSIC silence.ogg}

        {DELAY 500}

        {PLACE_IMAGE items/crystal-glyph-message.png 35 4}
        {PLACE_IMAGE items/crystal-glyph-message.png 37 4}
        {PLACE_IMAGE items/crystal-glyph-message.png 39 4}
        {PLACE_IMAGE items/crystal-glyph.png 37 6}

        [set_variable]
            name=part2
            value=1
        [/set_variable]
        [store_locations]
            x=35,37,39
            y=4,4,4
            variable=sound_hex
        [/store_locations]

        [set_variable]
            name=swap1
            rand=0..1
        [/set_variable]
        [set_variable]
            name=swap2
            rand=1..2
        [/set_variable]
        [set_variable]
            name=x_tmp
            value=$sound_hex[$swap1].x
        [/set_variable]
        [set_variable]
            name=y_tmp
            value=$sound_hex[$swap1].y
        [/set_variable]
        [set_variable]
            name=sound_hex[$swap1].x
            value=$sound_hex[$swap2].x
        [/set_variable]
        [set_variable]
            name=sound_hex[$swap1].y
            value=$sound_hex[$swap2].y
        [/set_variable]
        [set_variable]
            name=sound_hex[$swap2].x
            value=$x_tmp
        [/set_variable]
        [set_variable]
            name=sound_hex[$swap2].y
            value=$y_tmp
        [/set_variable]
        [set_variable]
            name=swap1
            rand=0..1
        [/set_variable]
        [set_variable]
            name=swap2
            rand=1..2
        [/set_variable]
        [set_variable]
            name=x_tmp
            value=$sound_hex[$swap1].x
        [/set_variable]
        [set_variable]
            name=y_tmp
            value=$sound_hex[$swap1].y
        [/set_variable]
        [set_variable]
            name=sound_hex[$swap1].x
            value=$sound_hex[$swap2].x
        [/set_variable]
        [set_variable]
            name=sound_hex[$swap1].y
            value=$sound_hex[$swap2].y
        [/set_variable]
        [set_variable]
            name=sound_hex[$swap2].x
            value=$x_tmp
        [/set_variable]
        [set_variable]
            name=sound_hex[$swap2].y
            value=$y_tmp
        [/set_variable]
        [set_variable]
            name=swap1
            rand=0..1
        [/set_variable]
        [set_variable]
            name=swap2
            rand=1..2
        [/set_variable]
        [set_variable]
            name=x_tmp
            value=$sound_hex[$swap1].x
        [/set_variable]
        [set_variable]
            name=y_tmp
            value=$sound_hex[$swap1].y
        [/set_variable]
        [set_variable]
            name=sound_hex[$swap1].x
            value=$sound_hex[$swap2].x
        [/set_variable]
        [set_variable]
            name=sound_hex[$swap1].y
            value=$sound_hex[$swap2].y
        [/set_variable]
        [set_variable]
            name=sound_hex[$swap2].x
            value=$x_tmp
        [/set_variable]
        [set_variable]
            name=sound_hex[$swap2].y
            value=$y_tmp
        [/set_variable]
        {CLEAR_VARIABLE swap1}
        {CLEAR_VARIABLE swap2}
        {CLEAR_VARIABLE x_tmp}
        {CLEAR_VARIABLE y_tmp}

        [objectives]
            {OBJECTIVE_VICTORY  ( _ "Solve the puzzle")}
        [/objectives]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
        [/filter]
        [filter_condition]
            [variable]
                name=part2
                numerical_equals=1
            [/variable]
        [/filter_condition]

        {MODIFY_UNIT (x,y=$x1,$y1) moves 6}
        {MODIFY_UNIT (x,y=$x1,$y1) attacks_left 1}
    [/event]

    ################################################################################
    #################################### PUZZLE ####################################
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            [filter_location]
                x,y=$sound_hex[1].x,$sound_hex[1].y
            [/filter_location]
        [/filter]

        {DELAY 150}
        {PLAY_SOUND "flute_g#_high.ogg"}
        {PLACE_IMAGE items/crystal-glyph-light-1.png $sound_hex[1].x $sound_hex[1].y}

        [if]
            [variable]
                name=puzzle_counter
                numerical_equals=1
            [/variable]
            [then]
                [set_variable]
                    name=puzzle_counter
                    value=2
                [/set_variable]
            [/then]
            [else]
                [set_variable]
                    name=puzzle_counter
                    value=0
                [/set_variable]
            [/else]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            [filter_location]
                x,y=$sound_hex[2].x,$sound_hex[2].y
            [/filter_location]
        [/filter]

        {DELAY 150}
        {PLAY_SOUND "flute_f#.ogg"}
        {PLACE_IMAGE items/crystal-glyph-light.png $sound_hex[2].x $sound_hex[2].y}

        [if]
            [variable]
                name=puzzle_counter
                numerical_equals=2
            [/variable]
            [then]
                [set_variable]
                    name=puzzle_counter
                    value=3
                [/set_variable]
            [/then]
            [else]
                [set_variable]
                    name=puzzle_counter
                    value=0
                [/set_variable]
            [/else]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            [filter_location]
                x,y=$sound_hex[0].x,$sound_hex[0].y
            [/filter_location]
        [/filter]

        {DELAY 150}
        {PLAY_SOUND "flute_d#.ogg"}

        [if]
            [variable]
                name=puzzle_counter
                numerical_equals=3
            [/variable]
            [then]
                {CLEAR_VARIABLE puzzle_counter}
                {DELAY 500}

                [store_unit]
                    [filter]
                        id=Yumi
                    [/filter]
                    variable=yumi
                [/store_unit]

                #ifdef EASY
                {VARIABLE_OP yumi.experience add 100}

                [unstore_unit]
                    variable=yumi
                    find_vacant=no
                    text= _ "+100 XP"
                    red,green,blue=255,0,255
                    advance=no
                [/unstore_unit]
                #endif
                #ifdef NORMAL
                {VARIABLE_OP yumi.experience add 75}
                [unstore_unit]
                    variable=yumi
                    find_vacant=no
                    text= _ "+75 XP"
                    red,green,blue=255,0,255
                    advance=no
                [/unstore_unit]
                #endif
                #ifdef HARD
                {VARIABLE_OP yumi.experience add 25}

                [unstore_unit]
                    variable=yumi
                    find_vacant=no
                    text= _ "+25 XP"
                    red,green,blue=255,0,255
                    advance=no
                [/unstore_unit]
                #endif

                {CLEAR_VARIABLE yumi}

                {DELAY 750}
                {REMOVE_IMAGE 35 4}
                {REMOVE_IMAGE 37 4}
                {REMOVE_IMAGE 39 4}
                {REMOVE_IMAGE 37 6}
                [redraw][/redraw]

                {DELAY 500}
                {TURN_UNIT5 "Yumi"}
                [fire_event]
                    name=part3
                [/fire_event]
            [/then]
            [else]
                [set_variable]
                    name=puzzle_counter
                    value=1
                [/set_variable]
            [/else]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            [filter_location]
                x,y=37,6
            [/filter_location]
        [/filter]

        [message]
            speaker=narrator
            message= _ "Her voice wept in a lonely melody. It started low, in a muted tone, then rose to a brittle, crystalline note. She breathed and her song dropped, just a little lower, before finally returning to its original tone. She hummed the four note sequence over and over, crying it out into the darkness."
        [/message]
    [/event]

    ###########################################################################################
    ##################################### PART 3 ##############################################
    ###########################################################################################

     #ifdef HARD
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 27 26 4 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 19 25 4 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 26 33 4 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 22 35 4 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 20 38 4 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 25 41 4 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 6 48 2 ("ud_spawns2")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 28 50 2 ("ud_spawns2")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 28 46 2 ("ud_spawns2")}
    #endif
    #ifdef NORMAL
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 27 26 8 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 19 25 8 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 26 33 8 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 22 35 8 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 20 38 8 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 25 41 8 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 6 48 4 ("ud_spawns2")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 28 50 4 ("ud_spawns2")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 28 46 4 ("ud_spawns2")}
    #endif
    #ifdef EASY
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 27 26 10 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 19 25 10 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 26 33 10 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 22 35 10 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 20 38 10 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 25 41 10 ("ud_spawns1")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 6 48 6 ("ud_spawns2")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 28 50 6 ("ud_spawns2")}
        {RESPAWN_POINT_CONDITIONAL ("Spectre,Spectre,Nightgaunt") 2 28 46 6 ("ud_spawns2")}
    #endif

    [event]
        name=part3
        first_time_only=yes

        [fade_out_music][/fade_out_music]
        {REPLACE_SCENARIO_MUSIC underground.ogg}
        {APPEND_MUSIC           suspense.ogg}

        [set_variable]
            name=part2
            value=0
        [/set_variable]
        {FADE_SCREEN}
        [place_shroud]
            side=1
            x=1-47
            y=1-15
        [/place_shroud]

        [store_unit]
            [filter]
                id=Yumi
            [/filter]
            variable=yumi
        [/store_unit]
        [kill]
            id=Yumi
        [/kill]
        {SCROLL_TO 6 23}
        [remove_shroud]
            side=1
            x,y=6,23
            radius=4
        [/remove_shroud]
        [replace_schedule]
            {DARK_INDOORS}
        [/replace_schedule]
        {DELAY 500}
        [change_theme]
            theme=
        [/change_theme]

        {UNFADE_SCREEN}
        [set_variable]
            name=aryel.moves
            value=7
        [/set_variable]
        [unstore_unit]
            variable=aryel
            x,y=6,23
        [/unstore_unit]
        [unhide_unit]
            [filter][/filter]
        [/unhide_unit]
        {CLEAR_VARIABLE aryel}

        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]

        [message]
            speaker=Aryel
            message= _ "Yumi? Yumi, you here?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>softly</i>) I'm... really sorry. I didn't mean to yell at you..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "I'm such a jerk."
        [/message]

        {DELAY 500}
        [set_variable]
            name=talya.moves
            value=7
        [/set_variable]
        [unstore_unit]
            variable=talya
            x,y=6,17
        [/unstore_unit]
        [unhide_unit]
            [filter][/filter]
        [/unhide_unit]

        [message]
            speaker=Talya
            message= _ "Aryel?"
        [/message]

        [move_unit]
            id=Talya
            to_x,to_y=7,23
        [/move_unit]
        {CLEAR_VARIABLE talya}
        {DELAY 500}

        {MODIFY_UNIT (id=Aryel) facing se}
        {DELAY 500}
        [message]
            speaker=Talya
            message= _ "Hey. I overheard you and Esther talking. You okay?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Ugh."
        [/message]
        [message]
            speaker=Talya
            message= _ "Come on, you need to relax a bit. You look so stressed."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>holds head</i>) That's not an excuse for cursing at a friend."
        [/message]
        [message]
            speaker=Aryel
            message= _ "I can't believe I yelled at Yumi like that. I've never done anything like that before."
        [/message]
        [message]
            speaker=Talya
            message= _ "Did you... make her cry or something? Or..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yumi doesn't cry. She doesn't show any emotion at all, in case you noticed."
        [/message]
        [message]
            speaker=Talya
            message= _ "I've always wondered about that."
        [/message]
        [message]
            speaker=Aryel
            message= _ "She's... a little different. It's not like she doesn't have emotions, but they're all twisted and warped and she never lets them show. I don't know. She's really hard to read, but it's just... you know, she always used to run to me whenever she needed to be cheered up. And now she's running away from me because she doesn't trust me."
        [/message]
        [message]
            speaker=Talya
            message= _ "That can't be true."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>shrugs</i>) I don't know. Even for me, it's often hard to tell what she thinks. She's not very outwardly expressive."
        [/message]
        [message]
            speaker=Talya
            message= _ "She's really shy. I don't think she's said even a full sentence to me yet."
        [/message]
        [message]
            speaker=Aryel
            message= _ "She has a lot of unpleasant secrets. I understand why she hides them. The only reason I nag her about it is because she's, well..."
        [/message]
        [message]
            speaker=Talya
            message= _ "She's precious to you. Especially since you're two of a kind- ah."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>frowns</i>) What did you just say?"
        [/message]
        [message]
            speaker=Talya
            message= _ "You're, erm... well, you, Yumi, and Esther aren't regular faerie, right? That's why you all care about each other so much. N-not that that's the only reason, of course."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Of course <i>you'd</i> notice. I should have expected that. Being a hybrid yourself, you're more attuned to others who are different."
        [/message]
        [message]
            speaker=Talya
            message= _ "Haha, you knew that all along? That I was part faerie?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Of course. I might not be as good as Yumi at this kind of stuff, but you'll find that I'm more than adequate for most situations. I just kind of didn't really want to bother you about it. You were obviously trying to fit in with the rest of the humans and it can be a sensitive issue."
        [/message]
        [message]
            speaker=Talya
            message= _ "Like with you."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yeah..."
        [/message]
        [message]
            speaker=Talya
            message= _ "Sorry. I shouldn't have brought it up. It kind of just slipped out, since well, I was thinking about your relationship with Yumi."
        [/message]
        [message]
            speaker=Aryel
            message= _ "For the record, I don't only care about Esther and her because we're three of a kind. I care about them because they're my friends. And Esther and I are especially protective of Yumi, because, well... she is who she is. You understand."
        [/message]
        [message]
            speaker=Talya
            message= _ "Yeah, I do. She's just so quiet. I can't imagine what goes on in her head."
        [/message]
        [message]
            speaker=Aryel
            message= _ "I feel like she'd go to pieces if she were left alone. And she doesn't have a good sense of danger. Either that or she doesn't care about putting herself in danger. If we weren't around to protect her, she'd end up either dead, or totally miserable. I can't let that happen. That's why I've got to find her."
        [/message]
        [message]
            speaker=Talya
            message= _ "I'm here to help!"
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>nods</i>) Thanks. You're pretty cool for a human."
        [/message]
        [message]
            speaker=Talya
            message= _ "(<i>grins</i>) Even if I'm not totally human, I'll take that as a compliment. Now, let's go find Yumi?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yeah."
        [/message]

        [unit]
            type=Demon Diviner
            canrecruit=yes
            generate_name=yes
            random_traits=no
            x,y=4,32
            animate=no
            side=3
        [/unit]
        [unit]
            type=Demon Diviner
            canrecruit=yes
            generate_name=yes
            random_traits=no
            x,y=21,29
            animate=no
            side=3
        [/unit]
        [unit]
            type=Demon Diviner
            canrecruit=yes
            generate_name=yes
            random_traits=no
            x,y=12,42
            animate=no
            side=3
        [/unit]

        [set_variable]
            name=ud_spawns1
            value=1
        [/set_variable]
        [set_variable]
            name=part3
            value=1
        [/set_variable]
        {VARIABLE turn_dmg 0}

        [objectives]
            {OBJECTIVE_VICTORY  ( _ "Find Yumi")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Aryel")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Talya")}
        [/objectives]
    [/event]

    [event]
        name=sighted
        first_time_only=yes
        [filter]
            type=Demon Diviner
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=Talya
            message= _ "Demons? But they look way different than the Urdemons who've been attacking Caerleon."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>eyes narrow</i>) Definitely not like any demons I've ever seen. It feels like the energies coming from them... are composed of multiple elements!"
        [/message]
        [message]
            speaker=unit
            message= _ "A mere faerie like you has the ability to ascertain our nature?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "A mere faerie? Don't give me that. You might be strong, but even you will still find that we're more than a match for you."
        [/message]
        [message]
            speaker=unit
            message= _ "We shall see."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>whispers</i>) Ugh, I don't really want to get bogged down here now, but looks like we have no choice but to fight. Can't just leave them here to ambush us later."
        [/message]
        [message]
            speaker=Talya
            message= _ "(<i>whispers</i>) Yeah. But with how many undead they've got, we might need some help."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>whispers</i>) I can summon some undead of my own, if we could get to that keep."
        [/message]
        [message]
            speaker=Talya
            message= _ "(<i>whispers</i>) Some of the faerie also followed me and Esther down here just in case. Let's get the girls to help us."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>nods</i>)"
        [/message]

        [objectives]
            {OBJECTIVE_VICTORY  ( _ "Defeat all enemies")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Aryel")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Talya")}
        [/objectives]
    [/event]
    [event]
        name=die
        first_time_only=no
        [filter]
            type=Demon Diviner
        [/filter]

        [fire_event]
            name=diviner_death
        [/fire_event]

        [kill]
            x,y=$x1,$y1
        [/kill]
        [if]
            [have_unit]
                type=Demon Diviner
                side=3
            [/have_unit]
            [then][/then]
            [else]
                [set_variable]
                    name=ud_spawns1
                    value=0
                [/set_variable]
                [kill]
                    side=2,3
                    animate=yes
                [/kill]
                [message]
                    speaker=Talya
                    message= _ "Guess with those demons gone, the undead have nothing to sustain them anymore."
                [/message]
                [message]
                    speaker=Aryel
                    message= _ "Looks like it."
                [/message]
            [/else]
        [/if]
    [/event]
    [event]
        name=diviner_death
        first_time_only=yes

        [message]
            speaker=Aryel
            message= _ "Tch. Even if we beat one of them, they <i>are</i> a lot stronger than your regular demons. Whatever they are, they might become a real problem in the future..."
        [/message]
        [message]
            speaker=Talya
            message= _ "You're telling me. I feel like a direct hit from their magic would rip me apart."
        [/message]
        [message]
            speaker=Aryel
            message= _ "It very well might. Be careful."
        [/message]
        [message]
            speaker=Talya
            message= _ "Will do."
        [/message]
    [/event]
    [event]
        name=new turn
        first_time_only=no
        [filter_condition]
            [variable]
                name=part3
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=ud_spawns1
                    numerical_equals=1
                [/variable]
            [/and]
        [/filter_condition]

        {VARIABLE_OP turn_count add 1}

        [switch]
            variable=turn_count
            [case]
                value=7
                [set_variable]
                    name=turn_dmg
                    value=4
                [/set_variable]
            [/case]
            [case]
                value=11
                [set_variable]
                    name=turn_dmg
                    value=6
                [/set_variable]
            [/case]
            [case]
                value=15
                [set_variable]
                    name=turn_dmg
                    value=8
                [/set_variable]
            [/case]
        [/switch]

        [if]
            [variable]
                name=turn_dmg
                greater_than=3
            [/variable]
            [then]
                [store_unit]
                    [filter]
                        side=1
                        [not]
                            id=Aryel
                        [/not]
                    [/filter]
                    variable=fire_dmg_unit
                [/store_unit]
                {PLAY_SOUND "magic-dark.ogg"}
                [for]
                    array=fire_dmg_unit
                    [do]
                        [if]
                            [variable]
                                name=fire_dmg_unit[$i].hitpoints
                                greater_than=$turn_dmg
                            [/variable]

                            [then]
                                {VARIABLE_OP fire_dmg_unit[$i].hitpoints sub $turn_dmg}
                            [/then]
                            [else]
                                [set_variable]
                                    name=fire_dmg_unit[$i].hitpoints
                                    value=1
                                [/set_variable]
                            [/else]
                        [/if]
                        [unstore_unit]
                            variable=fire_dmg_unit[$i]
                            find_vacant=no
                            text= _ "harmed"
                            {COLOR_HARM}
                        [/unstore_unit]
                    [/do]
                [/for]
                {CLEAR_VARIABLE fire_dmg_unit}

                [switch]
                    variable=turn_count
                    [case]
                        value=7
                        [message]
                            speaker=Talya
                            message= _ "Ow!"
                        [/message]
                        [message]
                            speaker=Aryel
                            message= _ "You okay?"
                        [/message]
                        [message]
                            speaker=Talya
                            message= _ "Peachy, but fine. I guess that was the demons' doing?"
                        [/message]
                        [message]
                            speaker=Aryel
                            message= _ "Seems like it. We've got to beat them to stop their spell."
                        [/message]
                    [/case]
                    [case]
                        value=11
                        [message]
                            speaker=Talya
                            message= _ "Ohhhh, that hurts..."
                        [/message]
                        [message]
                            speaker=Aryel
                            message= _ "Hang in there."
                        [/message]
                    [/case]
                    [case]
                        value=15
                        [set_variable]
                            name=turn_dmg
                            value=8
                        [/set_variable]
                        [message]
                            speaker=Aryel
                            message= _ "We really need to stop those demons."
                        [/message]
                    [/case]
                [/switch]
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        [filter]
            [filter_location]
                x,y=17,46
                radius=5
            [/filter_location]
            side=1
        [/filter]

        [set_variable]
            name=ud_spawns2
            value=1
        [/set_variable]

        {FADE_SCREEN}
        {DELAY 750}
        {SCROLL_TO 17 46}
        [fade_out_music][/fade_out_music]
        {DELAY 250}
        {REPLACE_SCENARIO_MUSIC the_city_falls.ogg}
        {APPEND_MUSIC           knalgan_theme.ogg}
        {DELAY 250}
        {UNFADE_SCREEN}
        [unit]
            id=S21Lamia
            type=Demon Lamia
            canrecruit=yes
            generate_name=yes
            random_traits=no
            x,y=17,46
            animate=no
            side=3
        [/unit]
        {DELAY 500}
        [message]
            speaker=Aryel
            message= _ "Oh boy."
        [/message]
        [message]
            speaker=S21Lamia
            message= _ "Oh? Where did a faerie like you come from? The others were supposed to guard the entrance."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Sorry, but we took care of them already. You're next."
        [/message]
        [message]
            speaker=S21Lamia
            message= _ "A battle is not necessary. Turn back and we will not pursue you."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Too bad. I'm looking for my friend, and somehow I doubt that going back is going to help me find her. And something tells me you're not going to just let us get past you either."
        [/message]
        [message]
            speaker=S21Lamia
            message= _ "You will jeopardize our operation. Leave."
        [/message]
        [message]
            speaker=Aryel
            message= _ "No."
        [/message]

        {DELAY 1000}
        [modify_side]
            side=3
            gold=250
        [/modify_side]

        [unit]
            type=Spectre
            generate_name=no
            random_traits=no
            x,y=16,46
            animate=yes
            side=2
        [/unit]
        [unit]
            type=Spectre
            generate_name=no
            random_traits=no
            x,y=17,45
            animate=yes
            side=2
        [/unit]
        [unit]
            type=Spectre
            generate_name=no
            random_traits=no
            x,y=18,46
            animate=yes
            side=2
        [/unit]

        [message]
            speaker=S21Lamia
            message= _ "If you wish to fight, I will have no choice but to eradicate you."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Your pathetic little pets won't stop us."
        [/message]
        [message]
            speaker=S21Lamia
            message= _ "Try me, faerie."
        [/message]
        [objectives]
            {OBJECTIVE_VICTORY  ( _ "Defeat all enemies")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Aryel")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Talya")}
        [/objectives]
    [/event]

    [event]
        name=side 3 turn
        first_time_only=no

        [filter_condition]
            [variable]
                name=ud_spawns2
                numerical_equals=1
            [/variable]
        [/filter_condition]
        [store_unit]
            [filter]
                side=1
                [filter_location]
                    radius=4
                    [and]
                        [filter]
                            ability=decomposition
                        [/filter]
                    [/and]
                [/filter_location]
            [/filter]
            variable=harm_unit
        [/store_unit]
        [for]
            array=harm_unit
            [do]
                {VARIABLE_OP harm_unit[$i].hitpoints multiply 0.5}

                [unstore_unit]
                    variable=harm_unit[$i]
                    find_vacant=no
                    text= _ "harmed"
                    {COLOR_HARM}
                [/unstore_unit]
                [fire_event]
                    name=lamia damage
                [/fire_event]
            [/do]
        [/for]
        {CLEAR_VARIABLE harm_unit}
    [/event]
    [event]
        name=lamia damage
        first_time_only=yes

        [message]
            speaker=Aryel
            message= _ "<i>What kind of sorcery is this? I didn't know normal demons could get that powerful. Definitely can't underestimate her.</i>"
        [/message]
    [/event]

    [event]
        name=last breath
        first_time_only=yes
        [filter]
            type=Demon Lamia
        [/filter]

        [set_variable]
            name=ud_spawns1
            value=0
        [/set_variable]
        [set_variable]
            name=ud_spawns2
            value=0
        [/set_variable]
        [set_variable]
            name=turn_dmg
            value=0
        [/set_variable]

        [kill]
            side=2,3
            [not]
                type=Demon Lamia
            [/not]
            animate=yes
        [/kill]

        [message]
            speaker=Aryel
            message= _ "Gotcha. Now, you're going to answer some questions for me."
        [/message]
        [message]
            speaker=S21Lamia
            message= _ "Am I?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yes, you are. I want to know everything. About the blue demons, why they're attacking us, who sent them-"
        [/message]
        [message]
            speaker=S21Lamia
            message= _ "I'm afraid I know nothing about that. I was sent here to investigate as well."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>frowns</i>)"
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>stares</i>)"
        [/message]
        {DELAY 1500}
        [message]
            speaker=Aryel
            message= _ "<i>She's not lying.</i>"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Who sent you? What is your purpose in coming here?"
        [/message]
        [message]
            speaker=S21Lamia
            message= _ "You will find out in due course. Suffice to say, we need not be enemies for the moment."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Says the one who attacked us first- Hey! Where do you think you're going-"
        [/message]
        {FADE_SCREEN}
        [kill]
            id=S21Lamia
        [/kill]
        {DELAY 500}
        {UNFADE_SCREEN}
        [message]
            speaker=Aryel
            message= _ "Rrrgh."
        [/message]
        [message]
            speaker=Talya
            message= _ "That was strange. You sure she wasn't lying?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "She wasn't. It looks like there might be multiple demon factions at work here..."
        [/message]
        [message]
            speaker=Talya
            message= _ "That's just great. As if the blue demons and the ones from Ethea weren't enough, now these weird multi-element ones show up."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Whatever. These new ones weren't really here to fight us. It looks like we just caught them in the middle of whatever they were doing. We can't worry about them right now."
        [/message]
        [message]
            speaker=Talya
            message= _ "Anxious to go find Yumi, huh?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yes. That stalled us for long enough already, so let's go."
        [/message]

        [remove_terrain_overlays]
            x,y=13,50
        [/remove_terrain_overlays]
        {DELAY 150}
        {PLAY_SOUND "gate-fall.ogg"}
        {DELAY 150}
        [message]
            speaker=narrator
            message= _ "A gate has been lowered."
        [/message]

        [store_unit]
            [filter]
                id=Aryel
            [/filter]
            variable=aryel
        [/store_unit]
        [store_unit]
            [filter]
                id=Talya
            [/filter]
            variable=talya
        [/store_unit]

        #ifdef EASY
        {VARIABLE_OP aryel.experience add 225}
        {VARIABLE_OP talya.experience add 75}

        [unstore_unit]
            variable=aryel
            find_vacant=no
            text= _ "+225 XP"
            red,green,blue=255,0,255
        [/unstore_unit]
        [unstore_unit]
            variable=talya
            find_vacant=no
            text= _ "+75 XP"
            red,green,blue=255,0,255
        [/unstore_unit]
        #endif
        #ifdef NORMAL
        {VARIABLE_OP aryel.experience add 150}
        {VARIABLE_OP talya.experience add 50}

        [unstore_unit]
            variable=aryel
            find_vacant=no
            text= _ "+150 XP"
            red,green,blue=255,0,255
        [/unstore_unit]
        [unstore_unit]
            variable=talya
            find_vacant=no
            text= _ "+50 XP"
            red,green,blue=255,0,255
        [/unstore_unit]
        #endif
        #ifdef HARD
        {VARIABLE_OP aryel.experience add 75}
        {VARIABLE_OP talya.experience add 25}

        [unstore_unit]
            variable=aryel
            find_vacant=no
            text= _ "+75 XP"
            red,green,blue=255,0,255
        [/unstore_unit]
        [unstore_unit]
            variable=talya
            find_vacant=no
            text= _ "+25 XP"
            red,green,blue=255,0,255
        [/unstore_unit]
        #endif

        {CLEAR_VARIABLE aryel}
        {CLEAR_VARIABLE talya}


        [objectives]
            {OBJECTIVE_VICTORY  ( _ "Find Yumi")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Aryel")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Talya")}
        [/objectives]
    [/event]
    ###########################################################################################
    ##################################### PART 4 ##############################################
    ###########################################################################################

#define DRAW_VOID
    [store_locations]
        variable=hex
        terrain=Woby,Gll^Fet
        [filter_adjacent_location]
            terrain=Qxu
        [/filter_adjacent_location]
    [/store_locations]
    [for]
        array=hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..12
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    less_than=6
                [/variable]
                [then]
                    [terrain]
                         x,y=$hex[$i].x,$hex[$i].y
                        terrain=Qxu
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE hex}
    [redraw][/redraw]
#enddef

    [event]
        name=moveto
        [filter]
            [filter_location]
                x=9-16
                y=51-54
            [/filter_location]
            side=1
        [/filter]

        [set_variable]
            name=part3
            value=0
        [/set_variable]

        [message]
            speaker=Aryel
            message= _ "Hmm. One sec. Let's see how far down this goes."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>throws pebble</i>)"
        [/message]
        [message]
            speaker=Talya
            message= _ "..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "..."
        [/message]
        [message]
            speaker=narrator
            message= _ "(<i>dink</i>)"
        [/message]
        [message]
            speaker=Talya
            message= _ "Long way down. Sure we want to go?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "I have a feeling we'll find Yumi down there. Probably Esther too. They'll need us. <i>And I need to apologize to Yumi</i>..."
        [/message]
        [message]
            speaker=Talya
            message= _ "'Kay. Let's get going, then."
        [/message]
        {FADE_SCREEN}
        [fade_out_music][/fade_out_music]
        {REPLACE_SCENARIO_MUSIC silence.ogg}
        {DELAY 750}
        [store_unit]
            [filter]
                id=Aryel
            [/filter]
            variable=aryel
        [/store_unit]
        [store_unit]
            [filter]
                id=Talya
            [/filter]
            variable=talya
        [/store_unit]
        [kill]
            id=Aryel,Talya
        [/kill]

        [store_unit]
            [filter]
                side=1
            [/filter]
            variable=side1units
        [/store_unit]
        [kill]
            side=1
        [/kill]
        {DELAY 750}
        [for]
            array=side1units
            [do]
                [unstore_unit]
                    variable=side1units[$i]
                    x,y=recall,recall
                    find_vacant=yes
                [/unstore_unit]
            [/do]
        [/for]
        {CLEAR_VARIABLE side1units}

        [place_shroud]
            side=1
            x=1-28
            y=16-57
        [/place_shroud]
        [remove_shroud]
            side=1
            x,y=36,24
            radius=2
        [/remove_shroud]
        [replace_schedule]
            {ETERNALDARK}
        [/replace_schedule]
        {SCROLL_TO 36 24}
        {DELAY 750}
        {UNFADE_SCREEN}
        {REPLACE_SCENARIO_MUSIC into_the_shadows.ogg}
        {APPEND_MUSIC           wind3.ogg}
        [unstore_unit]
            variable=yumi
            x,y=36,24
        [/unstore_unit]
        {MODIFY_UNIT (id=Yumi) facing sw}
        [unhide_unit]
            [filter][/filter]
        [/unhide_unit]
        {CLEAR_VARIABLE yumi}
        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]
        [message]
            speaker=Yumi
            message= _ "<i>I'm... alone...</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>No. Someone's coming</i>?"
        [/message]
        {DELAY 500}
        [unit]
            type=Fake Fire Fae2
            random_traits=no
            name= _ "Esther"
            x,y=35,25
            animate=yes
            side=1
        [/unit]
        [unstore_unit]
            variable=esther
            x,y=35,25
        [/unstore_unit]
        [unhide_unit]
            [filter][/filter]
        [/unhide_unit]
        {CLEAR_VARIABLE esther}

        [message]
            speaker=Esther
            message= _ "Thank goodness. I finally caught up."
        [/message]
        [message]
            speaker=Esther
            message= _ "... Yumi? Why the long face?"
        [/message]
        {DELAY 500}
        {MODIFY_UNIT (id=Yumi) facing se}
        {DELAY 500}
        [message]
            speaker=Esther
            message= _ "This is about Aryel, isn't it?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shrugs</i>)"
        [/message]
        {DELAY 500}
        {MODIFY_UNIT (id=Yumi) facing sw}
        {DELAY 500}
        [message]
            speaker=Yumi
            message= _ "We can't stay. They're coming."
        [/message]
        [message]
            speaker=Esther
            message= _ "Yumi, you're avoiding the question-"
        [/message]

        {REPEAT 2 ({QUAKE_FIXED "rumble.ogg"})}
        {DELAY 350}
        {PLAY_SOUND "magic-dark.ogg"}
        {DELAY 250}
        {DRAW_VOID}
        {SPAWN_NOID ("Demon Voidhunter,Demon Voidreaver") 5 39 21}
        {SPAWN_NOID ("Demon Voidhunter,Demon Voidreaver") 5 43 24}
        [redraw][/redraw]
        {DELAY 750}
        {PLAY_SOUND "magic-dark.ogg"}
        {DELAY 250}
        {DRAW_VOID}
        {SPAWN_NOID ("Demon Voidhunter,Demon Voidreaver") 5 30 23}
        {SPAWN_NOID ("Demon Voidhunter,Demon Voidreaver") 5 31 26}
        [redraw][/redraw]
        {DELAY 350}
        [message]
            speaker=Esther
            message= _ "... okay, I see that you were being serious. Those things look really dangerous. <i>I really ought to avoid those void areas.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>tugs Esther's sleeve</i>)"
        [/message]
        [message]
            speaker=Esther
            message= _ "Even so, can we talk while we find a way out?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shrugs</i>)"
        [/message]

        [objectives]
            {OBJECTIVE_VICTORY  ( _ "Find Aryel")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Yumi")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Esther")}
            {OBJECTIVE_NOTE ( _ "You may recruit by right clicking on a hex next to Yumi.")}
        [/objectives]

        [set_menu_item]
            id=recruit_manifestation
            description= _ "Recruit Manifestation"
            image="attacks/wail.png~SCALE(18,18)"
            [show_if]
                [variable]
                    name=side_number
                    numerical_equals=1
                [/variable]
            [/show_if]
            [filter_location]
                [not]
                    [filter][/filter]
                [/not]
                [filter_adjacent_location]
                    [filter]
                        side=1
                        id=Yumi
                    [/filter]
                [/filter_adjacent_location]
            [/filter_location]
            [command]
                [store_gold]
                    [filter_side]
                        side=1
                    [/filter_side]
                    variable=side1gold
                [/store_gold]
                [if]
                    [variable]
                        name=side1gold
                        less_than=6
                    [/variable]
                    [then]
                        {MESSAGE_NOT_ENOUGH_GOLD}
                    [/then]
                    [else]
                        [unit]
                            side=1
                            type=Manifestation
                            x,y=$x1,$y1
                            moves,attacks_left=0,0
                            animate=yes
                            upkeep=free
                            [modifications]
                                {TRAIT_LOYAL}
                            [/modifications]
                        [/unit]
                        {VARIABLE_OP side1gold sub 6}
                        [modify_side]
                            side=1
                            gold=$side1gold
                        [/modify_side]
                        {CLEAR_VARIABLE side1gold}
                    [/else]
                [/if]
            [/command]
        [/set_menu_item]

        [set_variable]
            name=part4
            value=1
        [/set_variable]
        [set_variable]
            name=turn_count
            value=0
        [/set_variable]
    [/event]

    [event]
        name=new turn
        first_time_only=no
        [filter_condition]
            [variable]
                name=part4
                numerical_equals=1
            [/variable]
        [/filter_condition]

        {VARIABLE_OP turn_count add 1}
        [switch]
            variable=turn_count
            [case]
                value=1
                [message]
                    speaker=Esther
                    message= _ "I know Aryel gets mad, but that's only because she cares about you. You know she's quite high strung."
                [/message]
            [/case]
            [case]
                value=2
                [message]
                    speaker=Esther
                    message= _ "You're not upset with her, are you?"
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "(<i>shakes head</i>)"
                [/message]
                [message]
                    speaker=Esther
                    message= _ "What did she say to you?"
                [/message]
            [/case]
            [case]
                value=3
                [message]
                    speaker=Esther
                    message= _ "Won't you talk a little, Yumi?"
                [/message]
            [/case]
            [case]
                value=4
                [message]
                    speaker=Yumi
                    message= _ "She yelled at me for keeping secrets from her. She says I know everything that's happening. About the demons, about the void destroying things..."
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "And she always says I run into danger alone."
                [/message]
                [message]
                    speaker=Esther
                    message= _ "And let me guess, she also used some nasty language while she was at it?"
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "(<i>nods</i>)"
                [/message]
                [message]
                    speaker=Esther
                    message= _ "Of course she did. That's Aryel for you. Though, what she said is all true, isn't it?"
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "(<i>pouts</i>)"
                [/message]
            [/case]
            [case]
                value=5
                [message]
                    speaker=Esther
                    message= _ "I know it sucks. Believe me, I've been on the receiving end of several of Aryel's tantrums."
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "She's never yelled at me like that before..."
                [/message]
                [message]
                    speaker=Esther
                    message= _ "We've also never been in this kind of situation before. She gets stressed too and she freaks out a lot more easily than either of us. Except unlike you, she doesn't always bottle up all her feelings."
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "... she also said she hated that about me. She doesn't like me."
                [/message]
                [message]
                    speaker=Esther
                    message= _ "You know that's not true."
                [/message]
            [/case]
            [case]
                value=6
                [message]
                    speaker=Yumi
                    message= _ "Do you hate me too?"
                [/message]
                [message]
                    speaker=Esther
                    message= _ "What? Don't be ridiculous."
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "(<i>frowns</i>)"
                [/message]
                [message]
                    speaker=Esther
                    message= _ "I mean... (<i>sighs</i>)"
                [/message]
                [message]
                    speaker=Esther
                    message= _ "It's hard to deal with it sometimes, yes. You have so many secrets and a lot of them are directly related with all this weird stuff that's been happening. Of course Aryel would get upset."
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "But what about you?"
                [/message]
                [message]
                    speaker=Esther
                    message= _ "Me? Of course I would prefer if you at least told us a little bit, Yumi."
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "But if I tell you, you'll be in danger. If you stay away, it won't chase you."
                [/message]
                [message]
                    speaker=Esther
                    message= _ "Maybe, but you know, we don't want you to get hurt either."
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "(<i>holds head</i>) <i>I don't know what to do...</i>"
                [/message]
            [/case]
            [case]
                value=7
                [message]
                    speaker=Esther
                    message= _ "Maybe I didn't phrase it well. What I meant was, it would be nice if you would be more open with us. I know that's not who you are and there's nothing wrong with that, but it's hard sometimes."
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "Aryel hates me for that. And you do too-"
                [/message]
                [message]
                    speaker=Esther
                    message= _ "No, I don't. And Aryel doesn't either. Please, Yumi. We're your friends."
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "But you don't like it when I'm like this."
                [/message]
                [message]
                    speaker=Esther
                    message= _ "Yumi. You're not an open person. I understand. That's fine. I like you the way you are. Please don't feel like there's something wrong with you."
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "(<i>looks up</i>) You mean it?"
                [/message]
                [message]
                    speaker=Esther
                    message= _ "Of course I do."
                [/message]
            [/case]
            [case]
                value=9
                [message]
                    speaker=Esther
                    message= _ "Something still bothering you?"
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "I just... wish all these demons would stop hunting us."
                [/message]
                [message]
                    speaker=Esther
                    message= _ "Yeah, me too."
                [/message]
            [/case]
        [/switch]
    [/event]

    [event]
        name=new turn
        first_time_only=no
        [filter_condition]
            [variable]
                name=part4
                numerical_equals=1
            [/variable]
        [/filter_condition]

        {PLAY_SOUND "rumble.ogg"}
        {DRAW_VOID}
        {DRAW_VOID}
        [if]
            [variable]
                name=turn_count
                greater_than=9
            [/variable]
            [then]
                {DRAW_VOID}
                {DRAW_VOID}
            [/then]
        [/if]
        [store_locations]
            variable=hex
            terrain=Qxu
        [/store_locations]
        [for]
            array=hex
            [do]
                #ifdef HARD
                [set_variable]
                    name=spawn_val
                    rand=1..100
                [/set_variable]
                #endif
                #ifdef NORMAL
                [set_variable]
                    name=spawn_val
                    rand=1..300
                [/set_variable]
                #endif
                #ifdef EASY
                [set_variable]
                    name=spawn_val
                    rand=1..450
                [/set_variable]
                #endif
                [switch]
                    variable=spawn_val
                    [case]
                        value=5
                        [unit]
                            type=Demon Voidhunter
                            animate=no
                            side=5
                            x,y=$hex[$i].x,$hex[$i].y
                            random_gender=yes
                            generate_name=no
                            find_vacant=yes
                        [/unit]
                    [/case]
                    [case]
                        value=6
                        [unit]
                            type=Demon Voidreaver
                            animate=no
                            side=5
                            x,y=$hex[$i].x,$hex[$i].y
                            generate_name=no
                            random_gender=yes
                            find_vacant=yes
                        [/unit]
                    [/case]
                [/switch]
                [if]
                    [have_unit]
                        id=Esther
                        x,y=$hex[$i].x,$hex[$i].y
                    [/have_unit]
                    [then]
                        [harm_unit]
                            [filter]
                                x,y=$hex[$i].x,$hex[$i].y
                            [/filter]
                            amount=7
                            animate=yes
                            kill=no
                            slowed=yes
                        [/harm_unit]
                    [/then]
                [/if]
                {CLEAR_VARIABLE spawn_val}
            [/do]
        [/for]
        {CLEAR_VARIABLE hex}
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            type=Fire Fae
            [filter_location]
                terrain=Qxu
            [/filter_location]
        [/filter]

        [filter_condition]
            [variable]
                name=part4
                numerical_equals=1
            [/variable]
        [/filter_condition]
        [harm_unit]
            [filter]
                x,y=$x1,$y1
            [/filter]
            amount=7
            animate=yes
            kill=no
            slowed=yes
        [/harm_unit]
        {CLEAR_VARIABLE damage}
    [/event]

    ###########################################################################################
    ##################################### PART 5 ##############################################
    ###########################################################################################

    #ifdef HARD
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 30 68 5 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 32 70 6 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 9 68 6 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 7 73 5 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 10 77 6 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 33 78 5 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 39 74 6 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 37 75 5 ("boss_stage")}
    #endif
    #ifdef NORMAL
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 30 68 10 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 32 70 12 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 9 68 10 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 7 73 12 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 10 77 10 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 33 78 12 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 39 74 10 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 37 75 12 ("boss_stage")}
    #endif
    #ifdef EASY
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 30 68 14 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 32 70 16 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 9 68 14 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 7 73 16 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 10 77 14 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 33 78 16 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 39 74 14 ("boss_stage")}
        {RESPAWN_POINT_CONDITIONAL ("Demon Nightmare,Demon Nightmare,Demon Dreamweaver") 4 37 75 16 ("boss_stage")}
    #endif
    [event]
        name=moveto
        [filter]
            side=1
            x,y=34,53
        [/filter]
        [set_variable]
            name=part4
            value=0
        [/set_variable]
        [message]
            speaker=Esther
            message= _ "That way?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "I don't know, but we can't stay. It's chasing us."
        [/message]
        [message]
            speaker=Esther
            message= _ "(<i>shivers</i>) Right. I'd rather not get caught by the void stuff. Let's go, then."
        [/message]

        [store_unit]
            [filter]
                id=Esther
            [/filter]
            variable=esther
        [/store_unit]
        [store_unit]
            [filter]
                id=Yumi
            [/filter]
            variable=yumi
        [/store_unit]

        #ifdef EASY
        {VARIABLE_OP esther.experience add 225}
        {VARIABLE_OP yumi.experience add 75}

        [unstore_unit]
            variable=esther
            find_vacant=no
            text= _ "+225 XP"
            red,green,blue=255,0,255
        [/unstore_unit]
        [unstore_unit]
            variable=yumi
            find_vacant=no
            text= _ "+75 XP"
            red,green,blue=255,0,255
        [/unstore_unit]
        #endif
        #ifdef NORMAL
        {VARIABLE_OP esther.experience add 150}
        {VARIABLE_OP yumi.experience add 50}

        [unstore_unit]
            variable=esther
            find_vacant=no
            text= _ "+150 XP"
            red,green,blue=255,0,255
        [/unstore_unit]
        [unstore_unit]
            variable=yumi
            find_vacant=no
            text= _ "+50 XP"
            red,green,blue=255,0,255
        [/unstore_unit]
        #endif
        #ifdef HARD
        {VARIABLE_OP esther.experience add 75}
        {VARIABLE_OP yumi.experience add 25}

        [unstore_unit]
            variable=esther
            find_vacant=no
            text= _ "+75 XP"
            red,green,blue=255,0,255
        [/unstore_unit]
        [unstore_unit]
            variable=yumi
            find_vacant=no
            text= _ "+25 XP"
            red,green,blue=255,0,255
        [/unstore_unit]
        #endif

        {CLEAR_VARIABLE esther}
        {CLEAR_VARIABLE yumi}


        {FADE_SCREEN}

        [fade_out_music][/fade_out_music]
        {REPLACE_SCENARIO_MUSIC underground.ogg}
        {APPEND_MUSIC           snowfall.ogg}
        [store_unit]
            [filter]
                id=Esther
            [/filter]
            variable=esther
        [/store_unit]
        [store_unit]
            [filter]
                id=Yumi
            [/filter]
            variable=yumi
        [/store_unit]
        [kill]
            id=Esther,Yumi
        [/kill]
        [kill]
            type=Manifestation
        [/kill]

        [place_shroud]
            side=1
            x=29-47
            y=18-56
        [/place_shroud]
        [remove_shroud]
            side=1
            x,y=33,63
            radius=1
        [/remove_shroud]
        [lift_fog]
            [filter_side]
                side=1
            [/filter_side]
            x,y=33,63
            radius=1
            multiturn=no
        [/lift_fog]
        {SCROLL_TO 33 63}

        [replace_schedule]
            {ETERNALDARK2}
        [/replace_schedule]

        {UNFADE_SCREEN}
        [unstore_unit]
            variable=yumi
            x,y=32,62
        [/unstore_unit]
        [unstore_unit]
            variable=esther
            x,y=31,63
        [/unstore_unit]
        [unhide_unit]
            [filter][/filter]
        [/unhide_unit]
        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]

        {DELAY 250}
        {TURN_UNIT5 "Esther"}

        [message]
            speaker=Esther
            message= _ "Looks like we got away. But now it looks like we're totally lost."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>frowns</i>)"
        [/message]
        [message]
            speaker=Esther
            message= _ "Something wrong?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>looks up</i>) <i>Aryel's here...</i>"
        [/message]
        {DELAY 250}

        [unstore_unit]
            variable=aryel
            x,y=23,63
        [/unstore_unit]
        [unstore_unit]
            variable=talya
            x,y=24,61
        [/unstore_unit]

        [hide_unit]
            id=Aryel,Talya
        [/hide_unit]

        {SCROLL_TO 23 63}
        {DELAY 500}

        [unhide_unit]
            [filter][/filter]
        [/unhide_unit]
        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]
        {CLEAR_VARIABLE esther}
        {CLEAR_VARIABLE yumi}
        {CLEAR_VARIABLE aryel}
        {CLEAR_VARIABLE talya}

        [message]
            speaker=Talya
            message= _ "Ugh. My legs are killing me. How far down did we even go?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>flutters wings</i>) Far enough that I can barely feel my wings anymore."
        [/message]
        [message]
            speaker=Talya
            message= _ "And what's with all this weird water? It's like the same stuff that was in the Arcaneum."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Probably the blue demons. We might be running into some soon."
        [/message]
        [message]
            speaker=Talya
            message= _ "You really think Yumi's going to be down here?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "She has to be. <i>I hope</i>."
        [/message]

        {DELAY 750}

        [move_unit]
            id=Esther
            to_x,to_y=28,63
        [/move_unit]
        [move_unit]
            id=Yumi
            to_x,to_y=29,64
        [/move_unit]
        {DELAY 500}
        [message]
            speaker=Esther
            message= _ "Hmm, I still don't see anything- oh, hold on. The tunnel's widening up ahead."
        [/message]
        {DELAY 500}
        [move_unit]
            id=Esther
            to_x,to_y=25,63
        [/move_unit]
        [move_unit]
            id=Yumi
            to_x,to_y=26,63
        [/move_unit]
        {DELAY 250}
        [message]
            speaker=Esther
            message= _ "Wait, I think I see someone- Aryel? Talya?"
        [/message]
        [message]
            speaker=Talya
            message= _ "Esther!"
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>bites lip</i>) And Yumi."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>fidgets with hair</i>)"
        [/message]
        [message]
            speaker=Aryel
            message= _ "I... uh..."
        [/message]
        {DELAY 1500}
        [message]
            speaker=Aryel
            message= _ "Can we talk?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>nods</i>)"
        [/message]
        [move_unit]
            id=Aryel
            to_x,to_y=15,60
        [/move_unit]
        [move_unit]
            id=Yumi
            to_x,to_y=15,61
        [/move_unit]
        {DELAY 500}
        [message]
            speaker=Talya
            message= _ "You were totally right. Those two get in so much trouble together."
        [/message]
        [message]
            speaker=Esther
            message= _ "(<i>sighs</i>) Tell me about it. They're like children."
        [/message]
        [message]
            speaker=Talya
            message= _ "(<i>laughs</i>) It kind of makes them a little endearing though, doesn't it? You care a lot about them."
        [/message]
        [message]
            speaker=Esther
            message= _ "How could I not? They're all that I have."
        [/message]
        [message]
            speaker=Talya
            message= _ "(<i>quietly</i>) I understand. I asked Aryel about this, but she seemed kind of stressed so I didn't want to push her before. Do you mind if I ask you instead?"
        [/message]
        [message]
            speaker=Esther
            message= _ "(<i>sharply</i>) This is about us not being normal faerie, is it?"
        [/message]
        [message]
            speaker=Talya
            message= _ "How'd you know?"
        [/message]
        [message]
            speaker=Esther
            message= _ "Give me some credit. I might not be a mind reader like Aryel or Yumi, but I'm not totally clueless."
        [/message]
        [message]
            speaker=Talya
            message= _ "Haha, fair enough. Yeah, I was wondering about that."
        [/message]
        [message]
            speaker=Esther
            message= _ "Well..."
        [/message]
        [message]
            speaker=Esther
            message= _ "It's complicated. I don't know the full truth of it. Neither does Aryel. Only Yumi might, but as you can tell, she rarely shares her thoughts. I guess we have some time to talk about it while Aryel and Yumi aren't here. But how did you end up noticing?"
        [/message]
        [message]
            speaker=Talya
            message= _ "It's... sort of because I'm different too. Not exactly a normal human. Like I told Aryel, I'm actually part faerie."
        [/message]
        [message]
            speaker=Esther
            message= _ "That explains quite a lot actually. You'll have to tell me more about that..."
        [/message]

        {SCROLL_TO 15 60}
        {DELAY 350}
        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]
        {DELAY 750}
        [message]
            speaker=Aryel
            message= _ "Yumi."
        [/message]
        [message]
            speaker=Aryel
            message= _ "I..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "I'm so sorry. I didn't mean to yell at you. I was just so <i>frustrated</i>."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yumi, please."
        [/message]
        [message]
            speaker=Aryel
            message= _ "You know I care about you. That's the only reason I'd get mad like that."
        [/message]
        {DELAY 1500}
        [message]
            speaker=Yumi
            message= _ "I know."
        [/message]
        [message]
            speaker=Aryel
            message= _ "I've always tried to look out for you."
        [/message]
        [message]
            speaker=Yumi
            message= _ "I know."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>shakes head</i>) It's just that this whole demon mess is scaring me. Like, before, in that sea of blood, you told me about all your nightmares. And then when I was trying to find you and those creepy scythe demons showed up, and then when that illusion demon was hunting you..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "It's just that all the crazy stuff is happening to <i>you</i> and I don't know what to do about it. I know you're trying to protect us by keeping us out of it, but seriously, Yumi. We want to protect you too."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>closes eyes</i>) B-but..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "But I know that it's complicated. And forcing you to talk about it might not be the best thing to do. I'm sorry. I didn't mean to upset you."
        [/message]
        [message]
            speaker=Yumi
            message= _ "It's okay. Aryel..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Hmm?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shaking</i>) It's just... it's hard for me to tell you..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "You already told me about your dreams, if that's what you're referring to?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shakes head</i>) I didn't tell you everything. In my nightmares, I always see you and Esther. Sometimes... sometimes it's the demons killing you, and sometimes it's someone else... and sometimes... you two attack me and I have to- I have to..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yumi! Yumi. (<i>breathes</i>)"
        [/message]
        [message]
            speaker=Aryel
            message= _ "You're worried about us."
        [/message]
        [message]
            speaker=Yumi
            message= _ "I don't want to see you get hurt. And I hate it when I have to attack you."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Ugh. I know. I couldn't imagine having to fight you in a nightmare. I don't know what to say. I'm... not really sure I can help you. But maybe if we get to the bottom of this blue demon mess, maybe your nightmares will stop. There's a chance of that."
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>No, nothing can stop it. And, Aryel... the problem is, all my nightmares come true. Does this mean you and Esther will die?</i>"
        [/message]
        [message]
            speaker=Aryel
            message= _ "<i>Her eyes are so dark. What is she thinking about?</i>"
        [/message]
        [message]
            speaker=Aryel
            message= _ "I wish there were something I could do to make you feel better."
        [/message]
        [message]
            speaker=Yumi
            message= _ "It's okay. I'm... okay. At least you're not mad at me anymore. I'm better now."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>sighs</i>) I'm sorry about that. Here, let me make it up to you. When we get out of this stupid hole, I'll go find you the best pudding you've ever eaten. Just as soon as we figure out what's hiding down here."
        [/message]
        [message]
            speaker=Yumi
            message= _ "Okay."
        [/message]
        {DELAY 500}
        [move_unit]
            id=Aryel
            to_x,to_y=21,63
        [/move_unit]
        [move_unit]
            id=Yumi
            to_x,to_y=20,62
        [/move_unit]
        {DELAY 500}
        [message]
            speaker=Esther
            message= _ "Looks like you two had a nice long chat."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Looks like you did too. So let's not wait around any longer. With all this water around, there's bound to be blue demons down here somewhere."
        [/message]
        [message]
            speaker=Esther
            message= _ "So you want to go hunting for them."
        [/message]
        [message]
            speaker=Aryel
            message= _ "That's what we came to do, right?"
        [/message]
        [message]
            speaker=Esther
            message= _ "I suppose so. Let's go looking then, shall we?"
        [/message]

        [objectives]
            {OBJECTIVE_VICTORY  ( _ "Explore")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Aryel")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Talya")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Yumi")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Esther")}
        [/objectives]
    [/event]


    ########## BOSS FIGHT ##########
#define SPAWN_ILLUSION_NOID X Y R
    [store_locations]
        [and]
            x,y={X},{Y}
            radius={R}
        [/and]
        [not]
            terrain=Wuy,Wuyb
        [/not]
        [not]
            [filter]
            [/filter]

            [or]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/or]
        [/not]
        variable=spawn_points
    [/store_locations]

    [set_variable]
        name=tmp
        rand=0..$($spawn_points.length-1)
    [/set_variable]

    [set_variable]
        name=x_loc
        value=$spawn_points[$tmp].x
    [/set_variable]

    [set_variable]
        name=y_loc
        value=$spawn_points[$tmp].y
    [/set_variable]

    [unit]
        type=Illusory Angel Illusion
        animate=yes
        side=4
        x,y=$x_loc,$y_loc
        random_traits=no
        generate_name=no
        gender=female
        find_vacant=yes
        moves=1
        hitpoints=$luna.hitpoints
    [/unit]

    [clear_variable]
        name=x_loc,y_loc,spawn_points,tmp
    [/clear_variable]
#enddef

#define REGENERATE_ILLUSIONS
    [store_unit]
        [filter]
            id=Luna
        [/filter]
        variable=luna
    [/store_unit]
    [kill]
        side=4
        type=Illusory Angel,Illusory Angel Illusion
        animate=yes
    [/kill]
    [set_variable]
        name=generator
        rand=1..7
    [/set_variable]
    [set_variable]
        name=gen_counter
        value=0
    [/set_variable]
    [set_variable]
        name=rev_gen
        value=7
    [/set_variable]
    {VARIABLE_OP rev_gen sub $generator}
    {VARIABLE_OP rev_gen sub 1}

    [while]
        [variable]
            name=gen_counter
            less_than=$generator
        [/variable]
        [do]
            {SPAWN_ILLUSION_NOID 22 73 5}
            {VARIABLE_OP gen_counter add 1}
        [/do]
    [/while]

    [set_variable]
        name=gen_counter
        value=0
    [/set_variable]

    [store_locations]
        [and]
            x,y=22,73
            radius=5
        [/and]
        [not]
            terrain=Wuy,Wuyb
        [/not]
        [not]
            [filter]
            [/filter]

            [or]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/or]
        [/not]
        variable=spawn_points
    [/store_locations]

    [set_variable]
        name=tmp
        rand=0..$($spawn_points.length-1)
    [/set_variable]

    [set_variable]
        name=x_loc
        value=$spawn_points[$tmp].x
    [/set_variable]
        [set_variable]
        name=y_loc
        value=$spawn_points[$tmp].y
    [/set_variable]
    [unit]
        id=Luna
        type=Illusory Angel
        hitpoints=$luna.hitpoints
        animate=yes
        side=4
        x,y=$x_loc,$y_loc
        random_traits=no
        generate_name=no
        gender=female
        find_vacant=yes
        moves=1
    [/unit]
    [clear_variable]
        name=x_loc,y_loc,spawn_points,tmp
    [/clear_variable]

    [while]
        [variable]
            name=gen_counter
            less_than=$rev_gen
        [/variable]
        [do]
            {SPAWN_ILLUSION_NOID 22 73 5}
            {VARIABLE_OP gen_counter add 1}
        [/do]
    [/while]
    #ifdef NORMAL
        {SPAWN_ILLUSION_NOID 22 73 5}
    #endif
    #ifdef HARD
        {SPAWN_ILLUSION_NOID 22 73 5}
        {SPAWN_ILLUSION_NOID 22 73 5}
        {SPAWN_ILLUSION_NOID 22 73 5}
    #endif

    [clear_variable]
        name=gen_counter,rev_gen,generator,luna
    [/clear_variable]
#enddef

    [event]
        name=moveto
        [filter]
            [filter_location]
                x,y=22,75
                radius=6
            [/filter_location]
            side=1
        [/filter]

        {FADE_SCREEN}
        [store_unit]
            [filter]
                id=Aryel
            [/filter]
            variable=aryel
        [/store_unit]
        [store_unit]
            [filter]
                id=Talya
            [/filter]
            variable=talya
        [/store_unit]
        [store_unit]
            [filter]
                id=Yumi
            [/filter]
            variable=yumi
        [/store_unit]
        [store_unit]
            [filter]
                id=Esther
            [/filter]
            variable=esther
        [/store_unit]
        [kill]
            id=Aryel,Talya,Yumi,Esther
        [/kill]

        {SCROLL_TO 22 75}
        [remove_shroud]
            side=1
            x,y=22,75
            radius=4
        [/remove_shroud]
        {UNFADE_SCREEN}

        [unstore_unit]
            variable=aryel
            x,y=22,70
        [/unstore_unit]
        [unstore_unit]
            variable=esther
            x,y=23,70
        [/unstore_unit]
        [unstore_unit]
            variable=talya
            x,y=21,70
        [/unstore_unit]
        [unstore_unit]
            variable=yumi
            x,y=22,69
        [/unstore_unit]
        [unhide_unit]
            [filter][/filter]
        [/unhide_unit]

        {CLEAR_VARIABLE aryel}
        {CLEAR_VARIABLE talya}
        {CLEAR_VARIABLE yumi}
        {CLEAR_VARIABLE esther}
        {DELAY 500}


        {REPEAT 2 ({QUAKE_FIXED "rumble.ogg"})}
        {DELAY 1000}
        {PLAY_SOUND "magic-dark-miss.ogg"}
        {DELAY 500}
        {REPEAT 2 ({QUAKE_FIXED "rumble.ogg"})}
        {DELAY 1000}
        {PLAY_SOUND "magic-dark-miss.ogg"}
        {DELAY 500}
        {REPEAT 2 ({QUAKE_FIXED "rumble.ogg"})}
        {DELAY 500}
        {PLAY_SOUND "magic-dark.ogg"}
        {DELAY 350}

        [fade_out_music][/fade_out_music]

        {REPLACE_SCENARIO_MUSIC everlasting_night.ogg}
        {APPEND_MUSIC           into_the_shadows.ogg}

        [unit]
            id=Luna
            type=Illusory Angel
            animate=yes
            side=4
            x,y=22,75
            random_traits=no
            generate_name=no
            gender=female
            find_vacant=no
        [/unit]

        [message]
            speaker=Luna
            message= _ "<i>Hello ladies</i>."
        [/message]
        [message]
            speaker=Esther
            message= _ "Oh my."
        [/message]
        [message]
            speaker=Talya
            message= _ "(<i>pales</i>)"
        [/message]
        [message]
            speaker=Aryel
            message= _ "So, you've come out of hiding again. Let me guess. Same spiel as before, come quietly with you to meet your master, don't bother resisting, we can't possibly fight you off. Am I right?"
        [/message]
        [message]
            speaker=Luna
            message= _ "<i>My request has not changed.</i>"
        [/message]
        [message]
            speaker=Aryel
            message= _ "And my reply has not changed. If you want us to come with you, then you'll have to make us by force."
        [/message]
        [message]
            speaker=Luna
            message= _ "<i>Very well then, I will</i>."
        [/message]
        [message]
            speaker=Esther
            message= _ "(<i>glances at Aryel</i>) So, let me guess. She's behind the blue demon infiltration, and her goal is to capture us."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yes, and yes. I don't know too much of the specifics, but now's not the time to get into that anyway. She'll turn hostile soon enough."
        [/message]
        [message]
            speaker=Talya
            message= _ "Ohhh, so she's the one you and Yumi were fighting in the Arcaneum's prison. She seems dangerous."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yep. So don't let your guard down-"
        [/message]
        {DELAY 500}
        {REGENERATE_ILLUSIONS}
        {DELAY 500}
        [message]
            speaker=Aryel
            message= _ "Aaaand here she comes."
        [/message]

        [objectives]
            {OBJECTIVE_VICTORY  ( _ "Defeat the Illusory Angel")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Aryel")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Talya")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Yumi")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Esther")}
        [/objectives]
        [set_variable]
            name=boss_stage
            value=1
        [/set_variable]
        [set_variable]
            name=illusions_hit
            value=0
        [/set_variable]
        [set_variable]
            name=real_hit
            value=0
        [/set_variable]
    [/event]

    [event]
        name=side 4 turn
        first_time_only=no

        [filter_condition]
            [variable]
                name=boss_stage
                numerical_equals=1
            [/variable]
        [/filter_condition]
        [store_unit]
            [filter]
                ability=dreamwalk
            [/filter]
            variable=heal_unit
        [/store_unit]
        [for]
            array=heal_unit
            [do]
                {VARIABLE heal_health $heal_unit[$i].max_hitpoints}
                {VARIABLE_OP heal_health sub $heal_unit[$i].hitpoints}
                {VARIABLE_OP heal_health multiply 0.4}

                [if]
                    [variable]
                        name=heal_health
                        greater_than=0
                    [/variable]
                    [then]
                        [heal_unit]
                            [filter]
                                x,y=$heal_unit[$i].x,$heal_unit[$i].y
                            [/filter]
                            amount=$heal_health
                            animate=yes
                            restore_statuses=yes
                        [/heal_unit]
                    [/then]
                [/if]
                {CLEAR_VARIABLE heal_health}
            [/do]
        [/for]
        {CLEAR_VARIABLE heal_unit}
    [/event]
    [event]
        name=attacker hits
        first_time_only=no

        [filter_second]
            type=Illusory Angel Illusion
        [/filter_second]
        {PLAY_SOUND "magic-dark-miss.ogg"}
        [kill]
            x,y=$x2,$y2
        [/kill]
        [filter_condition]
            [variable]
                name=boss_stage
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=second_unit.hitpoints
                    less_than=50
                [/variable]
            [/and]
        [/filter_condition]
        [if]
            [variable]
                name=boss_stage
                numerical_equals=1
            [/variable]
            [then]
                [switch]
                    variable=illusions_hit
                    [case]
                        value=5
                        [message]
                            speaker=Talya
                            message= _ "Okay, seriously. How are we supposed to tell which one's the real one?"
                        [/message]
                        [message]
                            speaker=Aryel
                            message= _ "You aren't."
                        [/message]
                        {VARIABLE_OP illusions_hit add 1}
                    [/case]
                    [case]
                        value=9
                        [message]
                            speaker=Esther
                            message= _ "Another fake."
                        [/message]
                        {VARIABLE_OP illusions_hit add 1}
                    [/case]
                    [case]
                        value=17
                        [message]
                            speaker=narrator
                            message= _ "<i>Instead of dancing around like this, why don't you give up and come with me</i>?"
                        [/message]
                        [message]
                            speaker=Aryel
                            message= _ "Like that'll happen."
                        [/message]
                        {VARIABLE_OP illusions_hit add 1}
                    [/case]
                    [case]
                        value=25
                        [message]
                            speaker=Talya
                            message= _ "All these illusions are seriously throwing me for a loop."
                        [/message]
                        {VARIABLE_OP illusions_hit add 1}
                    [/case]
                    [case]
                        value=31
                        [message]
                            speaker=Esther
                            message= _ "<i>Can't seem to pin her down</i>."
                        [/message]
                        {VARIABLE_OP illusions_hit add 1}
                    [/case]
                    [case]
                        value=39
                        [message]
                            speaker=narrator
                            message= _ "<i>I can keep this up forever</i>."
                        [/message]
                        [message]
                            speaker=Aryel
                            message= _ "So can we."
                        [/message]
                        {VARIABLE_OP illusions_hit add 1}
                    [/case]
                    [else]
                        {VARIABLE_OP illusions_hit add 1}
                    [/else]
                [/switch]
            [/then]
        [/if]
        [if]
            [have_unit]
                type=Illusory Angel Illusion
            [/have_unit]
            [then][/then]
            [else]
                {REGENERATE_ILLUSIONS}
            [/else]
        [/if]
    [/event]

    [event]
        name=defender hits
        first_time_only=no
        [filter_condition]
            [variable]
                name=boss_stage
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=unit.hitpoints
                    less_than=50
                [/variable]
            [/and]
        [/filter_condition]
        [filter]
            type=Illusory Angel Illusion
        [/filter]
        {PLAY_SOUND "magic-dark-miss.ogg"}
        [kill]
            x,y=$x1,$y1
        [/kill]

        [if]
            [variable]
                name=boss_stage
                numerical_equals=1
            [/variable]
            [then]
                [switch]
                    variable=illusions_hit
                    [case]
                        value=5
                        [message]
                            speaker=Talya
                            message= _ "Okay, seriously. How are we supposed to tell which one's the real one?"
                        [/message]
                        [message]
                            speaker=Aryel
                            message= _ "You aren't."
                        [/message]
                        {VARIABLE_OP illusions_hit add 1}
                    [/case]
                    [case]
                        value=9
                        [message]
                            speaker=Esther
                            message= _ "Another fake."
                        [/message]
                        {VARIABLE_OP illusions_hit add 1}
                    [/case]
                    [case]
                        value=17
                        [message]
                            speaker=narrator
                            message= _ "<i>Instead of dancing around like this, why don't you give up and come with me</i>?"
                        [/message]
                        [message]
                            speaker=Aryel
                            message= _ "Like that'll happen."
                        [/message]
                        {VARIABLE_OP illusions_hit add 1}
                    [/case]
                    [case]
                        value=25
                        [message]
                            speaker=Talya
                            message= _ "All these illusions are seriously throwing me for a loop."
                        [/message]
                        {VARIABLE_OP illusions_hit add 1}
                    [/case]
                    [case]
                        value=31
                        [message]
                            speaker=Esther
                            message= _ "<i>Can't seem to pin her down</i>."
                        [/message]
                        {VARIABLE_OP illusions_hit add 1}
                    [/case]
                    [case]
                        value=39
                        [message]
                            speaker=narrator
                            message= _ "<i>I can keep this up forever</i>."
                        [/message]
                        [message]
                            speaker=Aryel
                            message= _ "So can we."
                        [/message]
                        {VARIABLE_OP illusions_hit add 1}
                    [/case]
                    [else]
                        {VARIABLE_OP illusions_hit add 1}
                    [/else]
                [/switch]
            [/then]
        [/if]

        [if]
            [have_unit]
                type=Illusory Angel Illusion
            [/have_unit]
            [then][/then]
            [else]
                {REGENERATE_ILLUSIONS}
            [/else]
        [/if]
    [/event]

    [event]
        name=attack end
        first_time_only=no
        [filter_condition]
            [variable]
                name=boss_stage
                numerical_equals=1
            [/variable]
        [/filter_condition]

        [if]
            [have_unit]
                x,y=$x1,$y1
                type=Illusory Angel
                [or]
                    x,y=$x2,$y2
                    type=Illusory Angel
                [/or]
            [/have_unit]
            [then]
                [switch]
                    variable=real_hit
                    [case]
                        value=0
                        [message]
                            speaker=Talya
                            message= _ "We got her!"
                        [/message]
                        {DELAY 250}
                        {REGENERATE_ILLUSIONS}
                        {DELAY 250}
                        [message]
                            speaker=Talya
                            message= _ "... oh. Never mind."
                        [/message]
                        {VARIABLE_OP real_hit add 1}
                    [/case]
                    [case]
                        value=3
                        [message]
                            speaker=Aryel
                            message= _ "Is the only thing you can do run from us?"
                        [/message]
                        {REGENERATE_ILLUSIONS}
                        {VARIABLE_OP real_hit add 1}
                    [/case]
                    [case]
                        value=6
                        [message]
                            speaker=Esther
                            message= _ "This is getting annoying..."
                        [/message]
                        {DELAY 250}
                        {REGENERATE_ILLUSIONS}
                        {DELAY 250}
                        {VARIABLE_OP real_hit add 1}
                    [/case]
                    [else]
                        {VARIABLE_OP real_hit add 1}
                        {REGENERATE_ILLUSIONS}
                    [/else]
                [/switch]
            [/then]
        [/if]
    [/event]


    [event]
        name=last breath
        first_time_only=yes
        [filter]
            id=Luna
        [/filter]

        [filter_condition]
            [variable]
                name=boss_stage
                numerical_equals=1
            [/variable]
        [/filter_condition]

        {DELAY 500}
        [kill]
            side=4
            type=Illusory Angel Illusion
        [/kill]
        {DELAY 500}

        [store_unit]
            [filter]
                id=Esther
            [/filter]
            variable=esther
        [/store_unit]
        [store_unit]
            [filter]
                id=Yumi
            [/filter]
            variable=yumi
        [/store_unit]
        [store_unit]
            [filter]
                id=Aryel
            [/filter]
            variable=aryel
        [/store_unit]
        [store_unit]
            [filter]
                id=Talya
            [/filter]
            variable=talya
        [/store_unit]

        #ifdef EASY
        {VARIABLE_OP esther.experience add 150}
        {VARIABLE_OP yumi.experience add 150}
        {VARIABLE_OP aryel.experience add 150}
        {VARIABLE_OP talya.experience add 50}

        [unstore_unit]
            variable=esther
            find_vacant=no
            text= _ "+150 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=yumi
            find_vacant=no
            text= _ "+150 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=aryel
            find_vacant=no
            text= _ "+150 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=talya
            find_vacant=no
            text= _ "+50 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        #endif
        #ifdef NORMAL
        {VARIABLE_OP esther.experience add 90}
        {VARIABLE_OP yumi.experience add 90}
        {VARIABLE_OP aryel.experience add 90}
        {VARIABLE_OP talya.experience add 30}

        [unstore_unit]
            variable=esther
            find_vacant=no
            text= _ "+90 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=yumi
            find_vacant=no
            text= _ "+90 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=aryel
            find_vacant=no
            text= _ "+90 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=talya
            find_vacant=no
            text= _ "+30 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        #endif
        #ifdef HARD
        {VARIABLE_OP esther.experience add 30}
        {VARIABLE_OP yumi.experience add 30}
        {VARIABLE_OP aryel.experience add 30}
        {VARIABLE_OP talya.experience add 10}

        [unstore_unit]
            variable=esther
            find_vacant=no
            text= _ "+30 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=yumi
            find_vacant=no
            text= _ "+30 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=aryel
            find_vacant=no
            text= _ "+30 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=talya
            find_vacant=no
            text= _ "+10 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        #endif

        {CLEAR_VARIABLE esther}
        {CLEAR_VARIABLE yumi}
        {CLEAR_VARIABLE aryel}
        {CLEAR_VARIABLE talya}

        [message]
            speaker=Luna
            message= _ "<i>We are at an impasse again.</i>"
        [/message]
        [message]
            speaker=Aryel
            message= _ "An impasse?! We're beating you! And besides, all you've done is copy our moves again! What makes you still think you can capture us?"
        [/message]
        [message]
            speaker=Luna
            message= _ "<i>Because I must.</i>"
        [/message]
        {DELAY 500}
        {PLAY_SOUND "magic-dark-miss.ogg"}
        {DELAY 500}
        [kill]
            id=Luna
            animate=yes
        [/kill]

        [fade_out_music][/fade_out_music]
        {REPLACE_SCENARIO_MUSIC silence.ogg}
        {DELAY 250}
        {PLAY_SOUND "magic-dark-miss.ogg"}
        {DELAY 250}
        [message]
            speaker=Aryel
            message= _ "Wha-"
        [/message]
        {DELAY 500}
        {PLAY_SOUND "magic-dark-miss.ogg"}
        {DELAY 250}
        [message]
            speaker=Talya
            message= _ "Uh oh."
        [/message]
        {DELAY 500}
        {PLAY_SOUND "magic-dark.ogg"}
        {DELAY 500}
        [unit]
            id=Luna
            type=Ephemeral Angel
            animate=yes
            side=4
            x,y=$x1,$y1
            random_traits=no
            generate_name=no
            gender=female
            find_vacant=yes
        [/unit]

        {REPLACE_SCENARIO_MUSIC end.ogg}
        {APPEND_MUSIC           the_dangerous_symphony.ogg}

        [message]
            speaker=Aryel
            message= _ "(<i>eyes narrow</i>) You finally intend to fight us for real this time."
        [/message]
        [message]
            speaker=Luna
            message= _ "<i>I must capture you. You will not escape.</i>"
        [/message]
        [message]
            speaker=Esther
            message= _ "Over my dead body. I'll never let you hurt my friends ever again."
        [/message]
        {DELAY 250}
        {PLAY_SOUND "fire.wav"}
        {DELAY 250}
        [harm_unit]
            [filter]
                id=Luna
            [/filter]
            amount=7
            kill=no
            fire_event=no
            animate=yes
        [/harm_unit]
        {DELAY 500}
        {PLAY_SOUND "fire.wav"}
        {DELAY 250}
        #ifdef EASY
        [harm_unit]
            [filter]
                id=Luna
            [/filter]
            amount=40
            kill=no
            fire_event=no
            animate=yes
        [/harm_unit]
        #endif
        #ifdef NORMAL
        [harm_unit]
            [filter]
                id=Luna
            [/filter]
            amount=30
            kill=no
            fire_event=no
            animate=yes
        [/harm_unit]
        #endif
        #ifdef HARD
        [harm_unit]
            [filter]
                id=Luna
            [/filter]
            amount=15
            kill=no
            fire_event=no
            animate=yes
        [/harm_unit]
        #endif
        {DELAY 500}
        {PLAY_SOUND "fire.wav"}
        {DELAY 250}
        {PLAY_SOUND "magic-dark-miss.ogg"}
        {DELAY 250}
        [message]
            speaker=Esther
            message= _ "<i>She stopped my attack!</i>"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Tch. Looks like we're doing this the hard way. You're going down, demon."
        [/message]

        [heal_unit]
            [filter]
                side=1
            [/filter]
            amount=full
            animate=no
            restore_attacks=no
            restore_statuses=yes
        [/heal_unit]

        [objectives]
            {OBJECTIVE_VICTORY  ( _ "Defeat the Ephemeral Angel")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Aryel")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Talya")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Yumi")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Esther")}
        [/objectives]
        [set_variable]
            name=boss_stage
            value=2
        [/set_variable]
    [/event]


    [event]
        name=side 4 turn
        first_time_only=no
        [filter_condition]
            [variable]
                name=boss_stage
                numerical_equals=2
            [/variable]
        [/filter_condition]
        [store_unit]
            [filter]
                [filter_adjacent]
                    is_enemy=yes
                    ability=dreamweave
                [/filter_adjacent]
            [/filter]
            variable=copy_unit
        [/store_unit]
        [for]
            array=copy_unit
            [do]
                [switch]
                    variable=copy_unit[$i].id
                    [case]
                        value="Esther"

                        [unit]
                            side=6
                            animate=yes
                            find_vacant=yes
                            type=Fake Fire Fae
                            generate_name=no
                            random_traits=no
                            gender=$copy_unit[$i].gender
                            x,y=$copy_unit[$i].x,$copy_unit[$i].y
                        [/unit]
                        [fire_event]
                            name=fae_copy
                        [/fire_event]
                    [/case]
                    [case]
                        value="Aryel"

                        [unit]
                            side=6
                            animate=yes
                            find_vacant=yes
                            type=Fake Blood Fae
                            generate_name=no
                            random_traits=no
                            gender=$copy_unit[$i].gender
                            x,y=$copy_unit[$i].x,$copy_unit[$i].y
                        [/unit]
                        [fire_event]
                            name=fae_copy
                        [/fire_event]
                    [/case]
                    [case]
                        value="Yumi"

                        [fire_event]
                            name=yumi_copy
                        [/fire_event]
                    [/case]
                    [else]
                        [unit]
                            side=6
                            animate=yes
                            find_vacant=yes
                            type=$copy_unit[$i].type
                            generate_name=no
                            random_traits=no
                            gender=$copy_unit[$i].gender
                            x,y=$copy_unit[$i].x,$copy_unit[$i].y
                        [/unit]

                        [fire_event]
                            name=unit_copy
                        [/fire_event]
                    [/else]
                [/switch]
            [/do]
        [/for]
        {CLEAR_VARIABLE copy_unit}
    [/event]


    [event]
        name=unit_copy
        first_time_only=yes

        [message]
            speaker=Esther
            message= _ "Be careful! She's making copies of everyone close to her!"
        [/message]
    [/event]
    [event]
        name=fae_copy
        first_time_only=yes

        [message]
            speaker=Aryel
            message= _ "It'll take more than that to copy us properly."
        [/message]
        [message]
            speaker=Luna
            message= _ "<i>So it seems.</i>"
        [/message]
    [/event]
    [event]
        name=yumi_copy
        first_time_only=yes

        [message]
            speaker=Luna
            message= _ "<i>What? I can't duplicate the shadow one's energies.</i>"
        [/message]
    [/event]

    [event]
        name=last breath
        first_time_only=yes
        [filter]
            id=Luna
        [/filter]

        [filter_condition]
            [variable]
                name=boss_stage
                numerical_equals=2
            [/variable]
        [/filter_condition]

        {DELAY 500}
        [store_unit]
            [filter]
                id=Esther
            [/filter]
            variable=esther
        [/store_unit]
        [store_unit]
            [filter]
                id=Yumi
            [/filter]
            variable=yumi
        [/store_unit]
        [store_unit]
            [filter]
                id=Aryel
            [/filter]
            variable=aryel
        [/store_unit]
        [store_unit]
            [filter]
                id=Talya
            [/filter]
            variable=talya
        [/store_unit]

        #ifdef EASY
        {VARIABLE_OP esther.experience add 225}
        {VARIABLE_OP yumi.experience add 225}
        {VARIABLE_OP aryel.experience add 225}
        {VARIABLE_OP talya.experience add 75}

        [unstore_unit]
            variable=esther
            find_vacant=no
            text= _ "+225 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=yumi
            find_vacant=no
            text= _ "+225 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=aryel
            find_vacant=no
            text= _ "+225 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=talya
            find_vacant=no
            text= _ "+75 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        #endif
        #ifdef NORMAL
        {VARIABLE_OP esther.experience add 150}
        {VARIABLE_OP yumi.experience add 150}
        {VARIABLE_OP aryel.experience add 150}
        {VARIABLE_OP talya.experience add 50}

        [unstore_unit]
            variable=esther
            find_vacant=no
            text= _ "+150 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=yumi
            find_vacant=no
            text= _ "+150 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=aryel
            find_vacant=no
            text= _ "+150 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=talya
            find_vacant=no
            text= _ "+50 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        #endif
        #ifdef HARD
        {VARIABLE_OP esther.experience add 75}
        {VARIABLE_OP yumi.experience add 75}
        {VARIABLE_OP aryel.experience add 75}
        {VARIABLE_OP talya.experience add 25}

        [unstore_unit]
            variable=esther
            find_vacant=no
            text= _ "+75 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=yumi
            find_vacant=no
            text= _ "+75 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=aryel
            find_vacant=no
            text= _ "+75 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        [unstore_unit]
            variable=talya
            find_vacant=no
            text= _ "+25 XP"
            red,green,blue=255,0,255
            advance=no
        [/unstore_unit]
        #endif

        {CLEAR_VARIABLE esther}
        {CLEAR_VARIABLE yumi}
        {CLEAR_VARIABLE aryel}
        {CLEAR_VARIABLE talya}
        {DELAY 750}
        [kill]
            side=4,6
            [not]
                id=Luna
            [/not]
        [/kill]
        {DELAY 500}
        [message]
            speaker=Esther
            message= _ "<i>All the blue demons just disappeared!</i>"
        [/message]

        [fade_out_music][/fade_out_music]

        {REPLACE_SCENARIO_MUSIC weight_of_revenge.ogg}
        {DELAY 1500}

        [message]
            speaker=Luna
            message= _ "(<i>breathes</i>)"
        [/message]
        [message]
            speaker=Aryel
            message= _ "..!"
        [/message]
        [message]
            speaker=Aryel
            message= _ "That's the first noise I've ever heard you make. It seems like you can be harmed after all."
        [/message]
        [message]
            speaker=Luna
            message= _ "..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "The silent treatment, huh? You're not getting out of this one, you know. We beat you, even with your full powers."
        [/message]
        [message]
            speaker=Esther
            message= _ "There's nowhere to run. So it's in your best interest to cooperate with us and give us some answers."
        [/message]
        [message]
            speaker=Luna
            message= _ "<i>I am bound by the master's energies. I cannot speak.</i>"
        [/message]
        [message]
            speaker=Esther
            message= _ "That's not going to cut it. You are the one directing the humans to attack us, and you are at least partially responsible for corrupting the Urdemons. You're <i>going</i> to talk."
        [/message]
        [message]
            speaker=Luna
            message= _ "<i>There is nothing I can tell you.</i>"
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>eyes narrow</i>) Then I'll <i>make</i> you speak."
        [/message]
        [message]
            speaker=Luna
            message= _ "(<i>shifts uncomfortably</i>)"
        [/message]
        [message]
            speaker=Aryel
            message= _ "<i>Hmm, she's suddenly... afraid?</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>frowns</i>)"
        [/message]
        {DELAY 500}
        {PLAY_SOUND "magic-faeriefire.ogg"}
        {DELAY 500}
        {PLAY_SOUND "magic-dark-miss.ogg"}
        {DELAY 500}
        [message]
            speaker=Esther
            message= _ "(<i>turns</i>) Yumi, what are you doing?"
        [/message]
        {DELAY 250}
        {PLAY_SOUND "magic-dark-miss.ogg"}
        {DELAY 500}
        {PLAY_SOUND "magic-faeriefire.ogg"}
        {DELAY 500}
        {PLAY_SOUND "magic-dark-miss.ogg"}
        {DELAY 250}

        [message]
            speaker=Luna
            message= _ "<i>You won't catch me. Not here.</i>"
        [/message]
        [message]
            speaker=Aryel
            message= _ "She's trying to escape! Get her!"
        [/message]
        {DELAY 250}
        {PLAY_SOUND "fire.wav"}
        {DELAY 250}
        [harm_unit]
            [filter]
                id=Luna
            [/filter]
            amount=0
            kill=no
            fire_event=no
            animate=yes
        [/harm_unit]
        {DELAY 250}
        {PLAY_SOUND "magic-dark-miss.ogg"}
        {DELAY 250}
        [message]
            speaker=Luna
            message= _ "<i>I...</i>"
        [/message]
        {DELAY 250}
        {PLAY_SOUND "magic-faeriefire.ogg"}
        {DELAY 250}
        [message]
            speaker=Luna
            message= _ "<i>It hurts...</i>"
        [/message]
        {DELAY 250}
        {PLAY_SOUND "magic-dark-miss.ogg"}
        {DELAY 500}
        {PLAY_SOUND "fire.wav"}
        {DELAY 250}
        [harm_unit]
            [filter]
                id=Luna
            [/filter]
            amount=0
            kill=no
            fire_event=no
            animate=yes
        [/harm_unit]
        [message]
            speaker=Luna
            message= _ "<i>Stop...</i>"
        [/message]
        [message]
            speaker=Esther
            message= _ "Then stop resisting us. We won't hurt you if you just stay still."
        [/message]
        {DELAY 250}
        {PLAY_SOUND "magic-dark-miss.ogg"}
        {DELAY 250}
        [harm_unit]
            [filter]
                id=Luna
            [/filter]
            amount=0
            kill=no
            fire_event=no
            animate=yes
        [/harm_unit]
        {DELAY 250}
        [message]
            speaker=Luna
            message= _ "(<i>gasping</i>) <i>Please stop...</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>eyes glow</i>)"
        [/message]
        {DELAY 250}
        {PLAY_SOUND "magic-dark-miss.ogg"}
        {DELAY 250}
        [harm_unit]
            [filter]
                id=Luna
            [/filter]
            amount=0
            kill=no
            fire_event=no
            animate=yes
        [/harm_unit]
        {DELAY 250}
        [harm_unit]
            [filter]
                id=Luna
            [/filter]
            amount=0
        [/harm_unit]
        {PLAY_SOUND "magic-faeriefire.ogg"}
        {DELAY 250}
        [harm_unit]
            [filter]
                id=Luna
            [/filter]
            amount=0
            kill=no
            fire_event=no
        [/harm_unit]
        {DELAY 500}
        [harm_unit]
            [filter]
                id=Luna
            [/filter]
            amount=0
        [/harm_unit]
        {DELAY 200}
        [harm_unit]
            [filter]
                id=Luna
            [/filter]
            amount=0
            kill=no
            fire_event=no
        [/harm_unit]
        {DELAY 250}
        [message]
            speaker=Yumi
            message= _ "(<i>frowns</i>)"
        [/message]
        {DELAY 250}
        {PLAY_SOUND "magic-faeriefire.ogg"}
        {DELAY 200}
        [harm_unit]
            [filter]
                id=Luna
            [/filter]
            amount=0
            kill=no
            fire_event=no
        [/harm_unit]
        {DELAY 500}
        [harm_unit]
            [filter]
                id=Luna
            [/filter]
            amount=0
            kill=no
            fire_event=no
        [/harm_unit]
        {DELAY 200}
        [kill]
            id=Luna
            animate=yes
        [/kill]
        {DELAY 250}
        [message]
            speaker=Aryel
            message= _ "Wha-"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>breathes</i>)"
        [/message]
        [message]
            speaker=Esther
            message= _ "She got away."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Damn it. Damn it all. It looked like Yumi was keeping her down pretty well, too."
        [/message]
        [message]
            speaker=Aryel
            message= _ "... or not? Yumi?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shakes head</i>)"
        [/message]
        [message]
            speaker=Yumi
            message= _ "She was fighting something in her head. She was trying to break free. <i>It was that Guardian.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "I was trying to help her, but she was losing. It will take over her body again."
        [/message]
        [message]
            speaker=Aryel
            message= _ "And why were you-"
        [/message]
        [message]
            speaker=Yumi
            message= _ "She is being controlled."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yes, I understood that much. It must've been the thing she's referring to as her 'master'. The question is, who is it?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>frowns</i>) <i>I definitely can't tell them that yet. If I tell them, she will get in trouble too...</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "I don't know."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>sighs</i>) Of course you don't. It's always the same reply."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>pouts</i>) I'm sorry. I really don't."
        [/message]
        [message]
            speaker=Aryel
            message= _ "... right. Let's see, then. So we know this demon, whoever she is, is at least as strong as your average demon lord. If what you say is true, for her to be controlled like that, the one doing it would either have to be an extremely powerful demon lord, or..."
        [/message]
        [message]
            speaker=Esther
            message= _ "The more likely case is a Guardian."
        [/message]
        [message]
            speaker=Aryel
            message= _ "That's what I was afraid you'd say."
        [/message]
        [message]
            speaker=Esther
            message= _ "We can't worry about that right now. Even if it's really a Guardian behind this, that's not something we're equipped to deal with. We'd have to get Xia'el involved. For now, we have to first track down this demon. It's clear that she's being used to influence these blue demons somehow. Whatever information we can get out of her is secondary."
        [/message]
        [message]
            speaker=Aryel
            message= _ "That's a great idea, Esther, but... as you can see, she's gone."
        [/message]
        [message]
            speaker=Yumi
            message= _ "She's not."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>points</i>)"
        [/message]
        {SCROLL_TO 22 75}
        {DELAY 500}
        {PLAY_SOUND "magic-faeriefire.ogg"}
        {DELAY 500}
        [terrain]
            x,y=22,75
            terrain=Qxu
        [/terrain]
        [redraw][/redraw]
        {DELAY 500}
        [terrain]
            x,y=22,75
            radius=1
            terrain=Qxu
        [/terrain]
        [redraw][/redraw]
        {DELAY 500}
        [terrain]
            x,y=22,75
            radius=2
            terrain=Qxu
        [/terrain]
        [redraw][/redraw]
        {DELAY 500}
        [message]
            speaker=Yumi
            message= _ "She ran down there."
        [/message]
        {DELAY 500}
        {SCROLL_TO 22 75}
        {PLAY_SOUND "shaxthal-roam-1.ogg"}
        {DELAY 500}
        {PLAY_SOUND "shaxthal-roam-2.ogg"}
        {DELAY 350}
        {PLAY_SOUND "shaxthal-roam-1.ogg"}
        {DELAY 1000}
        [message]
            speaker=Talya
            message= _ "(<i>shivers</i>) Uhm, that place looks pretty dark..."
        [/message]
        [message]
            speaker=Esther
            message= _ "(<i>shifts uncomfortably</i>) I don't like it either."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shrugs</i>)"
        [/message]
        [move_unit]
            id=Yumi
            to_x,to_y=22,75
        [/move_unit]
        {DELAY 750}
        [store_unit]
            [filter]
                id=Yumi
            [/filter]
            variable=yumi
        [/store_unit]
        [kill]
            id=Yumi
        [/kill]
        [redraw][/redraw]
        [message]
            speaker=Aryel
            message= _ "Uh-"
        [/message]
        [message]
            speaker=Aryel
            message= _ "This girl. She's always nervous and afraid <i>except</i> for when she needs to be. She really has a terrible sense of danger."
        [/message]
        [move_unit]
            id=Aryel
            to_x,to_y=22,75
        [/move_unit]
        {DELAY 250}
        [harm_unit]
            [filter]
                id=Aryel
            [/filter]
            amount=0
        [/harm_unit]
        {DELAY 500}
        [harm_unit]
            [filter]
                id=Aryel
            [/filter]
            amount=0
        [/harm_unit]
        {DELAY 250}
        [message]
            speaker=Aryel
            message= _ "<i>Ohhh, it's cold.</i>"
        [/message]
        [message]
            speaker=Aryel
            message= _ "<i>Can't let her go alone, though.</i>"
        [/message]
        {DELAY 250}
        [store_unit]
            [filter]
                id=Aryel
            [/filter]
            variable=aryel
        [/store_unit]
        [kill]
            id=Aryel
        [/kill]
        [redraw][/redraw]
        {DELAY 1000}
        [message]
            speaker=Esther
            message= _ "Those two... Talya, you stay up here."
        [/message]
        [message]
            speaker=Talya
            message= _ "Esther, don't tell me you're seriously thinking of going in there too."
        [/message]
        [message]
            speaker=Esther
            message= _ "I have to. As crazy as they might be, they're my friends."
        [/message]
        [message]
            speaker=Talya
            message= _ "Yeah, but remember what happened at Fort Helemoor? When the whole thing just collapsed into a bottomless pit? This thing looks exactly like that. For all we know, those brain draining monsters might start spawning out of it again. And you don't know what'll happen if you walk into it. It's dangerous! You'll probably get killed!"
        [/message]
        [message]
            speaker=Esther
            message= _ "All the more reason I need to be there to help them."
        [/message]
        [message]
            speaker=Talya
            message= _ "You don't look very convinced of yourself."
        [/message]
        [message]
            speaker=Esther
            message= _ "(<i>sighs</i>) I know. Aryel and Yumi are definitely more suited for this sort of thing. Mysticism was never my strong point. But I can't abandon them."
        [/message]
        [move_unit]
            id=Esther
            to_x,to_y=22,75
        [/move_unit]
        {DELAY 250}
        [harm_unit]
            [filter]
                id=Esther
            [/filter]
            amount=0
        [/harm_unit]
        {DELAY 250}
        [harm_unit]
            [filter]
                id=Esther
            [/filter]
            amount=0
        [/harm_unit]
        {DELAY 250}
        [message]
            speaker=Esther
            message= _ "(<i>shivers</i>)"
        [/message]
        {DELAY 250}
        [store_unit]
            [filter]
                id=Esther
            [/filter]
            variable=esther
        [/store_unit]
        [kill]
            id=Esther
        [/kill]
        [redraw][/redraw]
        {DELAY 500}
        [message]
            speaker=Talya
            message= _ "Ugh."
        [/message]
        {TURN_UNIT5 "Talya"}
        [message]
            speaker=Talya
            message= _ "Wait up, girls!"
        [/message]
        [move_unit]
            id=Talya
            to_x,to_y=22,75
        [/move_unit]

        {DELAY 500}

        {FADE_SCREEN}
        [endlevel]
            result=victory
            carryover_report=no
            linger_mode=no
            {NEW_GOLD_CARRYOVER 100}
            next_scenario=22_Moonlit_Night
        [/endlevel]
    [/event]

    # CLEANUP
    [event]
        name=victory
        [kill]
            side=1
            type=Manifestation
        [/kill]
        {CLEAR_VARIABLE part2}
        {CLEAR_VARIABLE part3}
        {CLEAR_VARIABLE part4}
        {CLEAR_VARIABLE boss_stage}
        {CLEAR_VARIABLE illusions_hit}
        {CLEAR_VARIABLE illusion_flag}
        {CLEAR_VARIABLE real_hit}
        {CLEAR_VARIABLE ud_spawns1}
        {CLEAR_VARIABLE ud_spawns2}
        {CLEAR_VARIABLE turn_dmg}
        {CLEAR_VARIABLE sound_hex}
        [clear_menu_item]
            id=recruit_manifestation
        [/clear_menu_item]
    [/event]
    [event]
        name=last breath
        [filter]
            id=Yumi
        [/filter]

        [message]
            speaker=Yumi
            message= _ "(<i>gasp</i>)"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=last breath
        [filter]
            id=Esther
        [/filter]

        [message]
            speaker=Esther
            message= _ "I... failed..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=last breath
        [filter]
            id=Aryel
        [/filter]

        [message]
            speaker=Aryel
            message= _ "Ah..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=last breath
        [filter]
            id=Talya
        [/filter]

        [message]
            speaker=Talya
            message= _ "Ow!"
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]