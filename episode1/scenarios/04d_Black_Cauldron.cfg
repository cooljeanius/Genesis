#textdomain wesnoth-Genesis
[scenario]
    id=04d_Black_Cauldron
    name= _ "Black Cauldron"
    map_data="{~add-ons/Genesis/episode1/maps/04d_Black_Cauldron.map}"
    next_scenario=03_Northlands
    victory_when_enemies_defeated=no
    turns=6
    {UNDERGROUND}
    {STORYTXT_BLACK_CAULDRON}

    {FAE_DEATHS}
    {SCENARIO_MUSIC underground.ogg}
    {EXTRA_SCENARIO_MUSIC siege_of_laurelmor.ogg}
    {EXTRA_SCENARIO_MUSIC knalgan_theme.ogg}
    {EXTRA_SCENARIO_MUSIC waves.ogg}
    {EXTRA_SCENARIO_MUSIC the_dangerous_symphony.ogg}

    [side]
        type=Fire Fae
        name= _ "Esther"
        id=Esther
        canrecruit=yes
        side=1
        controller=human
        recruit=
        gold=100
        team_name=fae
        {INCOME 6 5 4}
        user_team_name= _ "team_name^Fae"
        fog=yes
        shroud=yes
    [/side]
    [side]
        side=2
        type=Demon Stromguarde
        id=boss
        canrecruit=yes
        team_name=demons
        controller=ai
        user_team_name= _ "team_name^Demons"
        [ai]
            aggression=1
            caution=0
            grouping=false
        [/ai]
    [/side]
    {STARTING_VILLAGES 2 6}
    [side]
        side=3
        no_leader=yes
        team_name=demons
        controller=ai
        user_team_name= _ "team_name^Demons"
        [ai]
            aggression=1
            caution=0
            grouping=false
        [/ai]
    [/side]
    [side]
        side=4
        no_leader=yes
        controller=ai
        team_name=spirits
        user_team_name= _ "team_name^Spirits"
        [ai]
            aggression=1
            caution=0
            grouping=false
        [/ai]
    [/side]
    [side]
        side=5
        no_leader=yes
        controller=ai
        team_name=spirits
        [ai]
            aggression=1
            caution=0
            grouping=false
        [/ai]
    [/side]

    {PLACE_IMAGE items/bones.png 52 35}

#define GENERATE_FUNGUS
    [store_locations]
        variable=cave_hex
        terrain=Uu
        [filter_adjacent_location]
            terrain=Xu,Xuc,Xue,Xuce
        [/filter_adjacent_location]
    [/store_locations]
    [for]
        array=cave_hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..6
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$cave_hex[$i].x,$cave_hex[$i].y
                        terrain=Uu^Uf
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE cave_hex}
    [store_locations]
        variable=cave_hex
        terrain=Uu
    [/store_locations]
    [for]
        array=cave_hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..15
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$cave_hex[$i].x,$cave_hex[$i].y
                        terrain=Uu^Uf
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE cave_hex}

    # we can do this for cave hills too, for a bit of visual variety
    [store_locations]
        variable=cave_hill_hex
        terrain=Uh
        [filter_adjacent_location]
            terrain=Xu,Xuc,Xue,Xuce
        [/filter_adjacent_location]
    [/store_locations]
    [for]
        array=cave_hill_hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..5
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$cave_hill_hex[$i].x,$cave_hill_hex[$i].y
                        terrain=Uh^Uf
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE cave_hill_hex}
    [store_locations]
        variable=cave_hill_hex
        terrain=Uh
        [filter_adjacent_location]
            terrain=Uu^Uf
        [/filter_adjacent_location]
    [/store_locations]
    [for]
        array=cave_hill_hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..2
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$cave_hill_hex[$i].x,$cave_hill_hex[$i].y
                        terrain=Uh^Uf
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE cave_hill_hex}
#enddef

#define GENERATE_CAVE_HILL
    [store_locations]
        variable=cave_hex
        terrain=Uu
        [filter_adjacent_location]
            terrain=Xu,Xuc,Xue,Xuce
        [/filter_adjacent_location]
    [/store_locations]
    [for]
        array=cave_hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..5
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$cave_hex[$i].x,$cave_hex[$i].y
                        terrain=Uh
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE cave_hex}
    [store_locations]
        variable=cave_hex
        terrain=Uu
        [not]
            [filter_adjacent_location]
                terrain=Xu,Xuc,Xue,Xuce,Wwg
            [/filter_adjacent_location]
        [/not]
    [/store_locations]
    [for]
        array=cave_hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..15
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$cave_hex[$i].x,$cave_hex[$i].y
                        terrain=Uh
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE cave_hex}
    [store_locations]
        variable=cave_hex
        terrain=Uu
        [filter_adjacent_location]
            terrain=Wwg
        [/filter_adjacent_location]
    [/store_locations]
    [for]
        array=cave_hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..30
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$cave_hex[$i].x,$cave_hex[$i].y
                        terrain=Uh
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE cave_hex}
#enddef

#define GENERATE_CAVE_PATH
    [store_locations]
        variable=cave_hex
        terrain=Uu
        [not]
            [filter_adjacent_location]
                terrain=Ur
            [/filter_adjacent_location]
        [/not]
    [/store_locations]
    [for]
        array=cave_hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..10
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$cave_hex[$i].x,$cave_hex[$i].y
                        terrain=Ur
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE cave_hex}
    [store_locations]
        variable=cave_hex
        terrain=Uu
        [filter_adjacent_location]
            terrain=Ur
        [/filter_adjacent_location]
    [/store_locations]
    [for]
        array=cave_hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..2
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$cave_hex[$i].x,$cave_hex[$i].y
                        terrain=Ur
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE cave_hex}
#enddef

    # ghost spawns

    {RESPAWN_POINT ("Ghost") 4 4 12 12}
    {RESPAWN_POINT ("Ghost") 4 20 12 12}
    {RESPAWN_POINT ("Ghost") 4 26 15 12}
    {RESPAWN_POINT ("Ghost") 4 15 13 12}
    {RESPAWN_POINT ("Ghost") 4 21 19 12}
    {RESPAWN_POINT ("Ghost") 4 5 15 12}
    {RESPAWN_POINT ("Ghost") 4 4 20 12}
    {RESPAWN_POINT ("Ghost") 4 12 10 12}

    # demon spawns
    #ifdef HARD
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 52 21 18}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 47 19 18}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 40 15 18}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 40 20 18}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 44 21 18}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 45 23 18}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 43 24 18}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 50 18 18}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 41 16 18}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 51 15 24}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 53 15 24}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 44 14 24}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 42 14 24}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 56 18 24}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 48 16 24}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 49 17 24}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 55 18 24}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 54 58 14 17 21}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 46 50 12 16 21}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 57 61 14 19 21}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 38 40 21 23 21}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 42 45 24 25 21}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 37 39 25 27 21}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 56 60 9 13 21}
    #endif
    #ifdef NORMAL
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 52 21 21}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 47 19 21}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 40 15 21}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 40 20 21}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 44 21 21}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 45 23 21}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 43 24 21}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 50 18 21}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 41 16 21}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 51 15 30}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 53 15 30}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 44 14 30}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 42 14 30}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 56 18 30}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 48 16 30}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 49 17 30}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 55 18 30}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 54 58 14 17 28}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 46 50 12 16 28}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 57 61 14 19 28}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 38 40 21 23 28}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 42 45 24 25 28}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 37 39 25 27 28}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 56 60 9 13 28}
    #endif
    #ifdef EASY
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 52 21 24}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 47 19 24}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 40 15 24}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 40 20 24}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 44 21 24}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 45 23 24}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 43 24 24}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 50 18 24}
        {RESPAWN_POINT ("Demon","Red Demon,Imp") 3 41 16 24}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 51 15 34}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 53 15 34}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 44 14 34}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 42 14 34}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 56 18 34}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 48 16 34}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 49 17 34}
        {RESPAWN_POINT ("Demon Sword Dancer","Demon Grunt","Fire Demon") 3 55 18 34}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 54 58 14 17 35}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 46 50 12 16 35}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 57 61 14 19 35}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 38 40 21 23 35}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 42 45 24 25 35}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 37 39 25 27 35}
        {RESPAWN_POINT_RANDOM ("Demon Zephyr") 2 56 60 9 13 35}
    #endif


    # generate some terrain and do some housekeeping
    [event]
        name=prestart
        {GENERATE_CAVE_HILL}
        {GENERATE_FUNGUS}
        {GENERATE_CAVE_PATH}
        {RECALL_YUMI_NOLOC}

        [set_variable]
            name=have_aryel
            value=0
        [/set_variable]
        [set_variable]
            name=lose_ghost
            value=0
        [/set_variable]
        [set_variable]
            name=volcano
            value=0
        [/set_variable]
        [set_recruit]
            side=1
            recruit=
        [/set_recruit]

        {SPAWN ("Demon Grunt") 2 55 9}
        {SPAWN ("Demon Grunt") 2 61 12}
        {SPAWN ("Demon Sword Dancer") 2 57 12}
        {SPAWN ("Fire Demon") 2 59 9}
        {SPAWN ("Ghost") 4 15 13}
    [/event]

    [event]
        name=start
        [message]
            speaker=Yumi
            message= _ "(<i>looks up</i>)"
        [/message]
        [message]
            speaker=Yumi
            message= _ "Esther, there are demons here."
        [/message]
        [message]
            speaker=Esther
            message= _ "We should hurry, then. Hopefully we can find Aryel before they do. Can you sense where she is?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "Mmmm, somewhere to the south, I think."
        [/message]
        {DELAY 250}
        [move_unit]
            id=Yumi
            to_x,to_y=8,7
        [/move_unit]
        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]
        {DELAY 250}
        [message]
            speaker=Esther
            message= _ "That way? Alright."
        [/message]
        [move_unit]
            id=Esther
            to_x,to_y=8,6
        [/move_unit]
        [objectives]
            {OBJECTIVE_VICTORY  ( _ "Find Aryel")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Yumi")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Esther")}
            {OBJECTIVE_DEFEAT  ( _ "Turns run out")}
            {OBJECTIVE_CARRYOVER}
        [/objectives]
    [/event]

    [event]
        name=sighted
        first_time_only=yes
        [filter]
            side=2,3
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=unit
            message= _ "There they are! Seize them!"
        [/message]
        [message]
            speaker=Esther
            message= _ "Run!"
        [/message]
    [/event]

    [event]
        name=sighted
        first_time_only=yes
        [filter]
            side=4
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=Esther
            message= _ "Undead..?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "Aryel likes necromancy, remember?"
        [/message]
        [message]
            speaker=Esther
            message= _ "I do. That's not what surprised me. What's strange is that they seem hostile, but Aryel wouldn't attack us..."
        [/message]
        [message]
            speaker=Yumi
            message= _ "Or maybe she lost control. (<i>bites lip</i>) Maybe she... got hurt."
        [/message]
        [message]
            speaker=Esther
            message= _ "More reason to find her as soon as we can."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            x,y=13,18
            side=1
        [/filter]

        [message]
            speaker=Yumi
            message= _ "Umm, hello? Aryel, are you there?"
        [/message]

        {DELAY 1000}

        [unit]
            side=1
            type=Blood Fae
            variation=BF1
            canrecruit=yes
            x,y=13,18
            name= _ "Aryel"
            id=Aryel
            unrenamable=yes
            # profile=portraits/aryel.png
            animate=yes
            experience=37
        [/unit]

        [message]
            speaker=Aryel
            message= _ "Shush! Do you intend to draw all those spirits over here?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "I thought you were the one controlling them..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "I was, until the demons came here. Something about their energy makes it very hard to control these things."
        [/message]
        [message]
            speaker=Esther
            message= _ "Aryel, listen, the demons-"
        [/message]
        [message]
            speaker=Aryel
            message= _ "I already know. Irdya's being invaded. It's another war."
        [/message]
        [message]
            speaker=Esther
            message= _ "But not full scale. I guess they don't want to attract Xia'el's attention just yet, otherwise she'll wipe them out."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yes, but they can still get plenty done in the meantime. You know they're targeting us."
        [/message]
        [if]
            [variable]
                name=white_city
                numerical_equals=1
            [/variable]
            [then]
                [message]
                    speaker=Esther
                    message= _ "Well, we can't just wait around. Aryel, there's a crypt in Caerleon that Yumi said you could open. We were planning to go there."
                [/message]
                [message]
                    speaker=Aryel
                    message= _ "That place? Yes, we could go there, but I don't know what you're expecting."
                [/message]
                [message]
                    speaker=Aryel
                    message= _ "..."
                [/message]
                [message]
                    speaker=Aryel
                    message= _ "Yumi? Hello? Wake up, daydreamer."
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "Uhm... I'm not sure. I thought I sensed something inside of it."
                [/message]
                [message]
                    speaker=Esther
                    message= _ "I suppose it wouldn't hurt to pay a visit, would it?"
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Esther
                    message= _ "Then, what? We can't just wait around. We need to do something."
                [/message]
                [message]
                    speaker=Aryel
                    message= _ "Hmm. Well, the first thing that comes to mind is the crypt in Caerleon. Supposedly, many secrets lie within, though I'm not exactly sure of what sort they are."
                [/message]
                [message]
                    speaker=Esther
                    message= _ "I suppose it wouldn't hurt to pay a visit, would it?"
                [/message]
            [/else]
        [/if]
        [message]
            speaker=Aryel
            message= _ "We could go, but I locked it up a long time ago. Didn't want the humans messing with the stuff left inside, since you know how humans are with magic. We'll need to go get the key first."
        [/message]
        [message]
            speaker=Esther
            message= _ "Then let's go get it. Think you can summon up some help?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Maybe, but I can't guarantee that I'll be able to maintain control with the demons around. We might have to brute force our way through them."
        [/message]
        [message]
            speaker=Yumi
            message= _ "Not like you mind..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Of course not. Actually, it would be my pleasure."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>rolls eyes</i>)"
        [/message]

        [modify_side]
            side=1
            recruit=Ghost,Skeleton,Skeleton Archer
        [/modify_side]

        [set_variable]
            name=have_aryel
            value=1
        [/set_variable]

        # recruiting code for this scenario
        [set_menu_item]
            id=recruit_ghost
            description= _ "Recruit Ghost"
            image="attacks/wail.png~SCALE(18,18)"
            [show_if]
                [variable]
                    name=side_number
                    numerical_equals=1
                [/variable]
            [/show_if]
            [filter_location]
                [not]
                    [filter][/filter]
                [/not]
                [filter_adjacent_location]
                    [filter]
                        side=1
                        id=Aryel
                    [/filter]
                [/filter_adjacent_location]
            [/filter_location]
            [command]
                [store_gold]
                    [filter_side]
                        side=1
                    [/filter_side]
                    variable=side1gold
                [/store_gold]
                [if]
                    [variable]
                        name=side1gold
                        less_than=20
                    [/variable]
                    [then]
                        [message]
                            speaker=narrator
                            message= _ "You do not have enough gold!"
                        [/message]
                    [/then]
                    [else]
                        [unit]
                            side=1
                            type=Ghost
                            x,y=$x1,$y1
                            moves,attacks_left=0,0
                            animate=yes
                        [/unit]
                        {VARIABLE_OP side1gold sub 20}
                        [modify_side]
                            side=1
                            gold=$side1gold
                        [/modify_side]
                        {CLEAR_VARIABLE side1gold}
                    [/else]
                [/if]
            [/command]
        [/set_menu_item]

        [remove_shroud]
            side=1
            x=52,51,51,52,50,53
            y=29,30,29,28,30,29
        [/remove_shroud]

        {SCROLL_TO 51 30}

        {DELAY 1000}

        [modify_turns]
            value=50
        [/modify_turns]
        [modify_unit]
            [filter]
                id=Yumi,Esther,Aryel
            [/filter]
            moves=6
            attacks_left=1
        [/modify_unit]
        {SCROLL_TO 18 13}

        [objectives]
            {OBJECTIVE_VICTORY  ( _ "Proceed southeast to locate the key to the crypt of Caerleon")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Yumi")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Esther")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Aryel")}
            {OBJECTIVE_DEFEAT  ( _ "Turns run out")}
            {OBJECTIVE_NOTE ( _ "You may recruit ghosts by right-clicking a hex next to Aryel.")}
            {OBJECTIVE_NOTE ( _ "Every turn, you have a chance to lose control of ghosts.")}
        [/objectives]
    [/event]


    # side 5 spawns
    #ifdef HARD
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 12 32 9 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 7 34 9 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 14 33 9 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 28 35 9 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 26 39 9 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 27 32 9 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith,Shadow") 5 22 44 12 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith,Shadow") 5 4 37 12 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith,Shadow") 5 27 44 12 ("have_aryel")}
    #endif
    #ifdef NORMAL
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 12 32 14 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 7 34 14 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 14 33 14 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 28 35 14 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 26 39 14 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 27 32 14 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 22 44 14 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith,Shadow") 5 4 37 14 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith,Shadow") 5 27 44 14 ("have_aryel")}
    #endif
    #ifdef EASY
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 12 32 17 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 7 34 17 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 14 33 17 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 28 35 17 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 26 39 17 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 27 32 17 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith") 5 22 44 17 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith,Shadow") 5 4 37 17 ("have_aryel")}
        {RESPAWN_POINT_CONDITIONAL ("Wraith,Shadow") 5 27 44 17 ("have_aryel")}
    #endif

    # lose ghosts event
    [event]
        name=new turn
        first_time_only=no
        [store_unit]
            [filter]
                type=Ghost
                side=1
            [/filter]
            variable=ghosts
        [/store_unit]
        [for]
            array=ghosts
            [do]
                [set_variable]
                    name=change_side
                    rand=1..100
                [/set_variable]
                [if]
                    [variable]
                        name=change_side
                        numerical_equals=1
                    [/variable]
                    [then]
                        [set_variable]
                            name=ghosts[$i].side
                            value=4
                        [/set_variable]
                        [unstore_unit]
                            variable=ghosts[$i]
                            find_vacant=no
                        [/unstore_unit]
                        # only do this once
                        [if]
                            [variable]
                                name=lose_ghost
                                numerical_equals=0
                            [/variable]
                            [then]
                                [message]
                                    speaker=Aryel
                                    message= _ "Damn it. Stupid demon magic."
                                [/message]
                                [set_variable]
                                    name=lose_ghost
                                    value=1
                                [/set_variable]
                            [/then]
                        [/if]
                    [/then]
                [/if]
                {CLEAR_VARIABLE change_side}
            [/do]
        [/for]
        {CLEAR_VARIABLE ghosts}
    [/event]

    [event]
        name=last breath
        first_time_only=yes
        [filter]
            side=2,3
        [/filter]
        [filter_second]
            id=Aryel
        [/filter_second]
        [message]
            speaker=Aryel
            message= _ "Mmmmm, you feel that? Savor your last breaths, demon, before I send you back to hell with everyone else."
        [/message]

        [kill]
            id=unit
            animate=yes
        [/kill]

        [message]
            speaker=Esther
            message= _ "Getting kind of excited, aren't you?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Just a little."
        [/message]
    [/event]

    [event]
        name=turn 9

        [message]
            speaker=Esther
            message= _ "So... how has life been down here in this lightless stink hole?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>rolls eyes</i>) I know you hate caves, Esther."
        [/message]
        [message]
            speaker=Esther
            message= _ "Hmph. It's been a while, though. When did you move down here in this rat cave again? It must've been since before the last time the demons came."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yeah. Couldn't stand having so many people around, faerie or not. I'm not a social butterfly, like you."
        [/message]
        [message]
            speaker=Esther
            message= _ "I mean, it's not that bad. All you have to do is talk a bit. Act as normal as possible."
        [/message]
        [message]
            speaker=Aryel
            message= _ "And you've always been miss goody goody sunshine. Must be easy for you."
        [/message]
        [message]
            speaker=Esther
            message= _ "Come on, Aryel. You, of all people, should know better than to judge me like that."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>smirks</i>) Yeah, yeah. Just teasing."
        [/message]
        [message]
            speaker=Yumi
            message= _ "Wait, what is Esther really like?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Don't ask silly questions, girl! What you see is what you get."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>frowns</i>)"
        [/message]
        [message]
            speaker=Esther
            message= _ "Just be content with the way things are."
        [/message]
    [/event]

    [event]
        name=turn 13

        [message]
            speaker=Yumi
            message= _ "(<i>whispers</i>) Aryel?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yes?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>whispers</i>) Is Esther scary?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Wha-? What kind of question is that?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>whispers</i>) Shhh! Please, Aryel-"
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>whispers</i>) I don't get it. Don't you think you can't trust her?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>whispers</i>) I... it's not that..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "(<i>whispers</i>) You're so dumb sometimes, you know that? Of all people, why wouldn't you trust Esther?"
        [/message]
        [message]
            speaker=Esther
            message= _ "Is something going on that I should be aware about?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "N-no. W-we were just, you know... uhh..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "This brat, how do you deal with her..."
        [/message]
        [message]
            speaker=Esther
            message= _ "Haha, just be patient. Give her some room and she might open up in time."
        [/message]
    [/event]

    [event]
        name=turn 19

        [message]
            speaker=Aryel
            message= _ "Esther, do you still remember what happened last time? When the demons invaded?"
        [/message]
        [message]
            speaker=Esther
            message= _ "What, when the Valdemons started running amuck when Shardia and Valdir had another one of their feuds?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yeah. I'm pretty sure Xia'el stepped in to help us, right?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "... what are you two talking about?"
        [/message]
        [message]
            speaker=Esther
            message= _ "I keep forgetting how young you are. Basically, there are other worlds besides our own, and the Guardians of them sometimes don't control their subjects very well. The Valdemons are from Norsula, the world of Water, and are particularly belligerent. They invaded other worlds in the past, but when they came to Irdya, Xia'el took care of business rather quickly."
        [/message]
        [message]
            speaker=Yumi
            message= _ "Why would the demons attack us? Or each other?"
        [/message]
        [message]
            speaker=Esther
            message= _ "It's in their nature, as aggressive, destructive beings. And a lot of the time, Guardians use this to wage war on one another. You have to understand, most of them positively hate each other and don't mind letting their subjects fight."
        [/message]
        [message]
            speaker=Aryel
            message= _ "That, and many of them are a bunch of egotistical tyrants who couldn't give a crap about anything but themselves. Except Uria and Xia'el. And Shardia, the Guardian of Fire. Usually. Sometimes."
        [/message]
        [message]
            speaker=Yumi
            message= _ "But we're being ditched now..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "That was my original question. Esther, any ideas?"
        [/message]
        [message]
            speaker=Esther
            message= _ "It's not that simple. I don't really know much about the factions among Guardians, but I'm pretty sure that Xia'el and Uria are friends with each other. However, the demons that have been attacking us are 'Urdemons', Uria's subjects who live on Ethea, the world of life. Knowing her, it's unlikely that she's ordered them to attack us. So this doesn't make sense. It also doesn't make sense that Xia'el doesn't come to help us either."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Knowing her? You've met her?"
        [/message]
        [message]
            speaker=Esther
            message= _ "Once. She seemed surprisingly sincere, and at least from what I've heard, she generally does try to protect her people. Uria's the Guardian of Life, after all."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Well, then something else is going on. I just wonder what Xia'el is doing."
        [/message]
        [message]
            speaker=Esther
            message= _ "We'll have to see."
        [/message]
    [/event]

    [event]
        name=moveto
        first_time_only=yes
        [filter]
            x=15-21
            y=25-30
            side=1
        [/filter]
        [filter_condition]
            [variable]
                name=have_aryel
                numerical_equals=1
            [/variable]
        [/filter_condition]
        [message]
            speaker=Esther
            message= _ "Uhh, which way?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "The path east leads to our intended destination. The path south leads through the chasm. I've never been there myself, but it might be worth checking out if we have the time."
        [/message]
    [/event]

    [event]
        name=sighted
        first_time_only=yes
        [filter]
            side=5
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=Esther
            message= _ "Those spirits look pretty dangerous."
        [/message]
        [message]
            speaker=Aryel
            message= _ "I never had any control over them. Those are the ones from the chasms. They're not that hard to kill, but certainly stronger than your average ghost."
        [/message]
    [/event]

    # reach the volcano peak
    [event]
        name=moveto
        first_time_only=no
        [filter]
            x,y=12,41
            id=Esther,Yumi,Aryel
        [/filter]

        # this gets set to 1 if we complete the event, so you can't get the bonuses over and over
        [filter_condition]
            [variable]
                name=have_aryel
                numerical_equals=1
            [/variable]
            [variable]
                name=volcano
                numerical_equals=0
            [/variable]
        [/filter_condition]

        # everyone should be nearby
        [if]
            [have_unit]
                id=Aryel
                [filter_location]
                    x,y=12,41
                    radius=6
                [/filter_location]
            [/have_unit]
            [and]
                [have_unit]
                    id=Esther
                    [filter_location]
                        x,y=12,41
                        radius=6
                    [/filter_location]
                [/have_unit]
            [/and]
            [and]
                [have_unit]
                    id=Yumi
                    [filter_location]
                        x,y=12,41
                        radius=6
                    [/filter_location]
                [/have_unit]
            [/and]
            [then]
                [move_unit]
                    id=Esther
                    to_x,to_y=11,42
                [/move_unit]
                [move_unit]
                    id=Yumi
                    to_x,to_y=12,42
                [/move_unit]
                [move_unit]
                    id=Aryel
                    to_x,to_y=13,42
                [/move_unit]
                [message]
                    speaker=Aryel
                    message= _ "Interesting. Try touching the lava."
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "But-"
                [/message]
                [message]
                    speaker=Aryel
                    message= _ "Don't be a chicken. Just do it."
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "Well, uhm..."
                [/message]

                {DELAY 1000}

                [move_unit]
                    id=Yumi
                    to_x,to_y=12,41
                [/move_unit]

                [message]
                    speaker=Yumi
                    message= _ "It stings a little. Almost like iron."
                [/message]
                [message]
                    speaker=Aryel
                    message= _ "Just stay there for a moment. Esther, you come too."
                [/message]
                [message]
                    speaker=Esther
                    message= _ "What exactly is supposed to happen?"
                [/message]

                {WHITE_SCREEN}
                {DELAY 500}
                {UNWHITE_SCREEN}

                [object]
                    [filter]
                        id=Esther
                    [/filter]
                    [effect]
                        apply_to=resistance
                        [resistance]
                            blade=-10
                            impact=-10
                            pierce=-10
                        [/resistance]
                    [/effect]
                    silent=yes
                    duration=forever
                [/object]
                [object]
                    [filter]
                        id=Yumi
                    [/filter]
                    [effect]
                        apply_to=resistance
                        [resistance]
                            blade=-10
                            impact=-10
                            pierce=-10
                        [/resistance]
                    [/effect]
                    silent=yes
                    duration=forever
                [/object]
                [object]
                    [filter]
                        id=Aryel
                    [/filter]
                    [effect]
                        apply_to=resistance
                        [resistance]
                            blade=-10
                            impact=-10
                            pierce=-10
                        [/resistance]
                    [/effect]
                    silent=yes
                    duration=forever
                [/object]

                [message]
                    speaker=Aryel
                    message= _ "It doesn't hurt any more, right?"
                [/message]
                [message]
                    speaker=Esther
                    message= _ "Whoa. What did you do?"
                [/message]
                [message]
                    speaker=Aryel
                    message= _ "Negated our natural weakness to cold iron. Physical attacks shouldn't hurt as much now."
                [/message]
                [message]
                    speaker=Esther
                    message= _ "That's so helpful! It's amazing that you can do that!"
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "(<i>grumbles</i>) Yeah, amazing."
                [/message]
                [message]
                    speaker=Aryel
                    message= _ "You jealous? (<i>smirks</i>)"
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "(<i>sighs</i>)"
                [/message]
                [set_variable]
                    name=volcano
                    value=1
                [/set_variable]
            [/then]
            [else]
                [if]
                    [have_unit]
                        id=Yumi
                        x,y=12,41
                    [/have_unit]
                    [then]
                        [message]
                            speaker=Yumi
                            message= _ "Esther? Aryel? I think I found something."
                        [/message]
                    [/then]
                    [else]
                        [message]
                            speaker=Esther
                            message= _ "You two should check this out."
                        [/message]
                    [/else]
                [/if]
            [/else]
        [/if]
    [/event]

    # boss battle!
    [event]
        name=sighted
        first_time_only=yes
        [filter]
            id=boss
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=boss
            message= _ "Fools! Faeries like you have no business challenging a demon!"
        [/message]
        [message]
            speaker=Esther
            message= _ "Faeries like us are not the docile pacifists you think we are. We're not afraid of you."
        [/message]
        [message]
            speaker=boss
            message= _ "So be it! My blood boils for the glory of battle!"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Hmph. Your blood boils? Let me show you what happens when your blood <i>really</i> boils."
        [/message]

        {DELAY 500}
        {PLAY_SOUND "fire.wav"}
        {DELAY 250}
        [harm_unit]
            [filter]
                id=boss
            [/filter]
            [filter_second]
                id=Aryel
            [/filter_second]
            [primary_attack]
                name=blood boil
            [/primary_attack]
            [secondary_attack]
                name=blood boil
            [/secondary_attack]
            animate=yes
            amount=11
        [/harm_unit]

        [message]
            speaker=boss
            message= _ "Aaargh! Insignificant wretch! Prepare to die!"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>whispers</i>)  Aryel, you're just making him angry..."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Who cares? Stop being so scared, Yumi. This is the perfect time to see how strong these demons really are."
        [/message]
    [/event]
    [event]
        name=last breath
        [filter]
            id=boss
        [/filter]
        [message]
            speaker=boss
            message= _ "I... shall return."
        [/message]

        [kill]
            id=boss
            animate=no
        [/kill]

        [message]
            speaker=Yumi
            message= _ "That was scary..."
        [/message]
        [message]
            speaker=Esther
            message= _ "He seemed fairly strong, at least more so than the small fry we've been fighting up until now."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Hmph. Still weren't on the level of real demon lords."
        [/message]
        [message]
            speaker=Esther
            message= _ "Well, do you really want to fight a demon lord?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "It'd be interesting, at least."
        [/message]
        [message]
            speaker=Yumi
            message= _ "She's crazy, Esther, I told you!"
        [/message]
        [message]
            speaker=Aryel
            message= _ "So what? You're not planning to tell me you're normal, are you?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>frowns</i>)"
        [/message]
        [message]
            speaker=Esther
            message= _ "(<i>sighs</i>) You two. We still have to get that key and get out of here, so save it for later."
        [/message]
    [/event]

    [event]
        name=turn 25

        [message]
            speaker=Esther
            message= _ "Geez, sometimes I wonder how you two can handle so much darkness. It really gets to you after a while."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Maybe it gets to you, but some of us enjoy it. I, for one, bet Yumi doesn't like it when you force her to get up at dawn. Right, Yumi?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "... uh huh..."
        [/message]
        [message]
            speaker=Esther
            message= _ "You two. If you like the dark so much, go live on Yrathid."
        [/message]
        [message]
            speaker=Yumi
            message= _ "The world of darkness?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Yup. And, no thanks. Merthiaal isn't as nice as Xia'el. Actually, she's honestly pretty creepy most of the time."
        [/message]
        [message]
            speaker=Esther
            message= _ "Not unlike both of you. Maybe she just has self image issues, like Yumi."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>sulks</i>)"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Pfff. Doesn't matter. Unless we meet her, we'll never find out anyway."
        [/message]
    [/event]

    # works whether or not you have Aryel
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            x=51,52
            y=30,29
            side=1
            [not]
                id=Aryel
            [/not]
        [/filter]
        [filter_condition]
            [variable]
                name=destroy_wall_one
                numerical_not_equals=1
            [/variable]
        [/filter_condition]
        [message]
            speaker=Yumi
            message= _ "There's something behind that wall."
        [/message]
        [message]
            speaker=Esther
            message= _ "Looks like we need Aryel to get through it."
        [/message]
        [objectives]
            {OBJECTIVE_VICTORY  ( _ "Move Aryel to the lit hexes")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Yumi")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Esther")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Aryel")}
            {OBJECTIVE_DEFEAT  ( _ "Turns run out")}
            {OBJECTIVE_CARRYOVER}
        [/objectives]
    [/event]

    [event]
        name=moveto
        first_time_only=yes
        [filter]
            x=51,52
            y=30,29
            id=Aryel
        [/filter]
        [message]
            speaker=Aryel
            message= _ "It takes some skill to notice that this wall blocks off a hidden path. It's not the easiest thing to open either, so give me a moment."
        [/message]

        {DELAY 750}

        [terrain]
            x=51,52
            y=30,29
            terrain=Uu
        [/terrain]
        [redraw]
            clear_shroud=yes
        [/redraw]

        [terrain]
            x=51,52
            y=31,30
            terrain=Uu
        [/terrain]
        {DELAY 250}

        [message]
            speaker=Aryel
            message= _ "There. Follow me."
        [/message]
        [set_variable]
            name=destroy_wall_one
            value=1
        [/set_variable]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            x,y=52,35
            side=1
        [/filter]
        [message]
            speaker=narrator
            message= _ "Here lies Wodahs Retsam. She never found the way out."
        [/message]
    [/event]

    [event]
        name=moveto
        first_time_only=yes
        [filter]
            x=59,60,58
            y=35,34,34
            side=1
            [not]
                id=Aryel
            [/not]
        [/filter]
        [filter_condition]
            [variable]
                name=destroy_wall_two
                numerical_not_equals=1
            [/variable]
        [/filter_condition]
        [message]
            speaker=Esther
            message= _ "Aryel, it seems that we need you again."
        [/message]
    [/event]

    [event]
        name=moveto
        first_time_only=yes
        [filter]
            x=59,60,58
            y=35,34,34
            id=Aryel
        [/filter]
        [message]
            speaker=Aryel
            message= _ "Stand back."
        [/message]

        {DELAY 250}
        [terrain]
            x=60,59,58
            y=35,36,35
            terrain=Uue
        [/terrain]
        [redraw][/redraw]

        [set_variable]
            name=destroy_wall_two
            value=1
        [/set_variable]
    [/event]

    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            [filter_location]
                x,y=59,41
                radius=5
            [/filter_location]
        [/filter]

        [remove_shroud]
            side=1
            x,y=59,47
            radius=10
        [/remove_shroud]
        [lift_fog]
            [filter_side]
                side=1
            [/filter_side]
            x,y=59,47
            radius=10
            multiturn=yes
        [/lift_fog]

        [scroll_to]
            x,y=59,47
        [/scroll_to]

        {DELAY 2000}

        [message]
            speaker=Esther
            message= _ "Whoa."
        [/message]
        [message]
            speaker=Aryel
            message= _ "You like it? I found this place a while ago and thought it'd be a good hideout. Had to make a few modifications so that the trees could grow, of course."
        [/message]
        [message]
            speaker=Esther
            message= _ "What was it originally?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Probably a shrine to Xia'el. If you get closer to the center, you can see the light coming down in the form of her symbol. The energies here used to be stronger, but they've faded with time. I guess it's because she doesn't bless this place with her presence any more."
        [/message]
        [message]
            speaker=Esther
            message= _ "And I thought Yumi was supposed to be the sarcastic one. 'Bless this place with her presence'. You have quite the sense of humor."
        [/message]
        [message]
            speaker=Yumi
            message= _ "... I don't get it."
        [/message]
        [message]
            speaker=Esther
            message= _ "Guardians are known for being secretive and aloof. Xia'el and Uria aren't as bad as some of the others, and they usually try to take care of their worlds, but even they have a knack for not showing up for long periods of time. Though, if we really need them, I bet they'll come."
        [/message]
        [message]
            speaker=Aryel
            message= _ "It's also why Irdya and Ethea, the worlds of Xia'el and Uria, are better to live on. Remember that if you ever get stuck on your own, Yumi."
        [/message]
        [message]
            speaker=Yumi
            message= _ "I... don't want to think about that."
        [/message]
        [message]
            speaker=Esther
            message= _ "Yeah, no need to talk like that. Let's get that key and get out of here."
        [/message]

        [objectives]
            {OBJECTIVE_VICTORY  ( _ "Move Aryel to the center of the chamber")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Yumi")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Esther")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Aryel")}
            {OBJECTIVE_DEFEAT  ( _ "Turns run out")}
            {OBJECTIVE_CARRYOVER}
        [/objectives]
    [/event]

    # we don't need any conditions since if Aryel moves here, you win
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            x,y=59,47
            side=1
            [not]
                id=Aryel
            [/not]
        [/filter]
        [message]
            speaker=unit
            message= _ "Aryel should be the one to look at this."
        [/message]
    [/event]

    [event]
        name=moveto
        first_time_only=yes
        [filter]
            x,y=59,47
            id=Aryel
        [/filter]

        [message]
            speaker=Yumi
            message= _ "... where's the key you were talking about?"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Silly girl. Not a physical key. As if I would leave such a thing lying around for anyone else to use."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>pouts</i>)"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Well, that's all taken care of. I do wonder what's inside that crypt. Never felt the need to go inside, myself."
        [/message]
        [message]
            speaker=Esther
            message= _ "You don't seem like you're scared of what's within."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Not really, I'm not. It's just that knowledge is a burden, you know? And dealing with powerful magics draws unwanted attention."
        [/message]
        [message]
            speaker=Esther
            message= _ "But, you are okay with opening it."
        [/message]
        [message]
            speaker=Aryel
            message= _ "I'm not going to anything unnecessary. But I'm also not scared. There's no need to be. Right, girl?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>looks away</i>)"
        [/message]
        [message]
            speaker=Aryel
            message= _ "Hmph. Well, it's up to us, I guess. Shall we give it a shot, or do we sit on our hands and wait for Xia'el to do something?"
        [/message]
        [message]
            speaker=Esther
            message= _ "We might as well try something, right? As much as I hate to say it, we can't rely on anyone else right now. Dabbling in dangerous magic is something we're built to do, after all."
        [/message]
        [message]
            speaker=Aryel
            message= _ "Fine. Then let's get out of here before more demons come."
        [/message]

        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 40}
            next_scenario=03_Northlands
        [/endlevel]
    [/event]


    # cleaning up some variables
    [event]
        name=victory

        {CLEAR_VARIABLE volcano}
        {CLEAR_VARIABLE destroy_wall_one}
        {CLEAR_VARIABLE destroy_wall_two}
        {CLEAR_VARIABLE have_aryel}
        {CLEAR_VARIABLE lose_ghost}
        [clear_menu_item]
            id=recruit_ghost
        [/clear_menu_item]
        [set_variable]
            name=black_cauldron
            value=1
        [/set_variable]
        [set_variable]
            name=white_city
            value=2
        [/set_variable]
        [set_variable]
            name=prev_scenario
            value="Black Cauldron"
        [/set_variable]
    [/event]

    [event]
        name=turn 55

        [message]
            speaker=Yumi
            message= _ "(<i>shudders</i>) The demons are coming again. Strong ones. Really strong ones."
        [/message]
        [message]
            speaker=Aryel
            message= _ "I can feel it too. We'd better hurry up."
        [/message]
    [/event]


    [event]
        name=time over

        [store_unit]
            [filter]
                id=Yumi
            [/filter]
            variable=yumi
        [/store_unit]
        [store_unit]
            [filter]
                id=Esther
            [/filter]
            variable=esther
        [/store_unit]
        [store_unit]
            [filter]
                id=Aryel
            [/filter]
            variable=aryel
        [/store_unit]
        [message]
            speaker=Yumi
            message= _ "Uhh, Esther? I sense something. Something really bad."
        [/message]
        [message]
            speaker=Esther
            message= _ "What is it-"
        [/message]

        {FLASH_RED_EXTREME ({DELAY 500})}

        {SPAWN_ID ("Demon Stromguarde") 2 $yumi.x $yumi.y ("boss1") ("male")}
        {SPAWN_ID ("Demon Stromguarde") 2 $yumi.x $yumi.y ("boss2") ("male")}
        {SPAWN_ID ("Demon Stromguarde") 2 $yumi.x $yumi.y ("boss3") ("male")}
        {SPAWN_ID ("Demon Stromguarde") 2 $esther.x $esther.y ("boss4") ("male")}
        {SPAWN_ID ("Demon Stromguarde") 2 $esther.x $esther.y ("boss5") ("male")}
        {SPAWN_ID ("Demon Stromguarde") 2 $esther.x $esther.y ("boss6") ("male")}
        {SPAWN_ID ("Demon Stromguarde") 2 $aryel.x $aryel.y ("boss7") ("male")}
        {SPAWN_ID ("Demon Stromguarde") 2 $aryel.x $aryel.y ("boss8") ("male")}
        {SPAWN_ID ("Demon Stromguarde") 2 $aryel.x $aryel.y ("boss9") ("male")}

        {CLEAR_VARIABLE yumi}
        {CLEAR_VARIABLE esther}
        {CLEAR_VARIABLE aryel}

        [message]
            speaker=boss1
            message= _ "Meet your makers, heathens!"
        [/message]
        [message]
            speaker=Yumi
            message= _ "Ugh, we're totally doomed now."
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]
