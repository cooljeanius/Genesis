#textdomain wesnoth-Genesis
[scenario]
    id=10_Incubus
    name= _ "Incubus"
    map_data="{~add-ons/Genesis/episode1/maps/10_Incubus.map}"
    next_scenario=11_Frozen_Skies
    victory_when_enemies_defeated=no
    disallow_recall=yes
    turns=29
    {ETERNALDARKDREAM}

    {SCENARIO_MUSIC wind3.ogg}
    {EXTRA_SCENARIO_MUSIC returning_in_time.ogg}
    {EXTRA_SCENARIO_MUSIC snowfall.ogg}
    {EXTRA_SCENARIO_MUSIC underground.ogg}

    [side]
        {PLAYER_FAE}
        side=1
        recruit=
        {GOLD 400 360 280}
        {NO_INCOME_SIDE}
        fog=yes
        shroud=yes
    [/side]

    [side]
        {YUURE_SIDE}
        side=2
        [ai]
            aggression=1
            caution=0
            grouping=false
            [goal]
                [criteria]
                    id=Yumi
                [/criteria]
                value=200
            [/goal]
        [/ai]
    [/side]

    [side]
        side=3
        no_leader=yes
        team_name=yuure
        controller=ai
        user_team_name= _ "team_name^Humans"
        color=white
        [ai]
            aggression=1
            caution=0
            grouping=false
            [goal]
                [criteria]
                    id=Yumi
                [/criteria]
                value=200
            [/goal]
        [/ai]
    [/side]

    [side]
        side=4
        no_leader=yes
        hidden=yes
        controller=null
        team_name=yuure
        color=black
    [/side]

    [side]
        {YUURE_SIDE}
        side=5
        hidden=yes
        [ai]
            aggression=1
            caution=0
            grouping=false
            [goal]
                [criteria]
                    id=Yumi
                [/criteria]
                value=200
            [/goal]
        [/ai]
    [/side]

[event]
    name=switch_terrain
    first_time_only=no
    [if]
        [variable]
            name=change_terrain
            numerical_equals=1
        [/variable]
        [then]
            [terrain]
                x,y=$hex[$i].x,$hex[$i].y
                terrain=Ai
            [/terrain]
        [/then]
    [/if]
    [if]
        [variable]
            name=change_terrain
            numerical_equals=2
        [/variable]
        [then]
            [terrain]
                 x,y=$hex[$i].x,$hex[$i].y
                terrain=Aa
            [/terrain]
        [/then]
    [/if]
    {CLEAR_VARIABLE change_terrain}
[/event]
#define GENERATE_BLACK_SHALLOW
    [store_locations]
        variable=hex
        [filter_adjacent_location]
            terrain=Wwby
        [/filter_adjacent_location]
        [not]
            terrain=Woby
        [/not]
    [/store_locations]
    [for]
        array=hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..3
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$hex[$i].x,$hex[$i].y
                        terrain=Wwby
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE hex}
#enddef
#define REGENERATE_TERRAIN
    [store_locations]
        variable=hex
        [not]
            terrain=Aa^Fma,Aa^Fpa,Wwby,Woby
        [/not]
    [/store_locations]
    [for]
        array=hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..50
            [/set_variable]
            [fire_event]
                name=switch_terrain
            [/fire_event]
        [/do]
    [/for]
    {CLEAR_VARIABLE hex}
    [store_locations]
        variable=hex
        terrain=Aa^Fma,Aa^Fpa
        [not]
            terrain=Wwby,Woby
        [/not]
    [/store_locations]
    [for]
        array=hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..160
            [/set_variable]
            [fire_event]
                name=switch_terrain
            [/fire_event]
        [/do]
    [/for]
    {CLEAR_VARIABLE hex}
#enddef
#define GENERATE_ICE
    [set_variable]
        name=x_coord
        rand=1..27,7..21
    [/set_variable]
    [set_variable]
        name=y_coord
        rand=1..27,7..21
    [/set_variable]
    [terrain]
        x=$x_coord
        y=$y_coord
        terrain=Ai
    [/terrain]
    {CLEAR_VARIABLE x_coord}
    {CLEAR_VARIABLE y_coord}
    [store_locations]
        variable=hex
        [filter_adjacent_location]
            terrain=Ai
        [/filter_adjacent_location]
    [/store_locations]
    [for]
        array=hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..12
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$hex[$i].x,$hex[$i].y
                        terrain=Ai
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE hex}
#enddef

#define GENERATE_SNOW
    [set_variable]
        name=x_coord
        rand=1..27,7..21
    [/set_variable]
    [set_variable]
        name=y_coord
        rand=1..27,7..21
    [/set_variable]
    [terrain]
        x=$x_coord
        y=$y_coord
        terrain=Aa
    [/terrain]
    {CLEAR_VARIABLE x_coord}
    {CLEAR_VARIABLE y_coord}
    [store_locations]
        variable=hex
        [filter_adjacent_location]
            terrain=Aa
        [/filter_adjacent_location]
    [/store_locations]
    [for]
        array=hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..12
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$hex[$i].x,$hex[$i].y
                        terrain=Aa
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE hex}
#enddef

#define GENERATE_SNOW_PINE_FOREST
    [set_variable]
        name=x_coord
        rand=5..23,10..18
    [/set_variable]
    [set_variable]
        name=y_coord
        rand=5..23,10..18
    [/set_variable]
    [terrain]
        x=$x_coord
        y=$y_coord
        terrain=Aa^Fpa
    [/terrain]
    {CLEAR_VARIABLE x_coord}
    {CLEAR_VARIABLE y_coord}
    [store_locations]
        variable=hex
        [filter_adjacent_location]
            terrain=Aa^Fma,Aa^Fpa
        [/filter_adjacent_location]
    [/store_locations]
    [for]
        array=hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..15
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$hex[$i].x,$hex[$i].y
                        terrain=Aa^Fpa
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE hex}
#enddef

#define GENERATE_SNOW_MIXED_FOREST
    [set_variable]
        name=x_coord
        rand=5..23,10..18
    [/set_variable]
    [set_variable]
        name=y_coord
        rand=5..23,10..18
    [/set_variable]
    [terrain]
        x=$x_coord
        y=$y_coord
        terrain=Aa^Fma
    [/terrain]
    {CLEAR_VARIABLE x_coord}
    {CLEAR_VARIABLE y_coord}
    [store_locations]
        variable=hex
        [filter_adjacent_location]
            terrain=Aa^Fma,Aa^Fpa
        [/filter_adjacent_location]
    [/store_locations]
    [for]
        array=hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..15
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$hex[$i].x,$hex[$i].y
                        terrain=Aa^Fma
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE hex}
#enddef
#define GENERATE_SNOW_HILLS
    [set_variable]
        name=x_coord
        rand=5..23,10..18
    [/set_variable]
    [set_variable]
        name=y_coord
        rand=5..23,10..18
    [/set_variable]
    [terrain]
        x=$x_coord
        y=$y_coord
        terrain=Ha
    [/terrain]
    {CLEAR_VARIABLE x_coord}
    {CLEAR_VARIABLE y_coord}
    [store_locations]
        variable=hex
        [filter_adjacent_location]
            terrain=Ha
        [/filter_adjacent_location]
    [/store_locations]
    [for]
        array=hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..10
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$hex[$i].x,$hex[$i].y
                        terrain=Ha
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE hex}
#enddef
#define GENERATE_SHALLOW_WATER
    [set_variable]
        name=x_coord
        rand=1..27
    [/set_variable]
    [set_variable]
        name=y_coord
        rand=1..27
    [/set_variable]
    [terrain]
        x=$x_coord
        y=$y_coord
        terrain=Wwg
    [/terrain]
    {CLEAR_VARIABLE x_coord}
    {CLEAR_VARIABLE y_coord}
    [store_locations]
        variable=hex
        [filter_adjacent_location]
            terrain=Wwg
        [/filter_adjacent_location]
    [/store_locations]
    [for]
        array=hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..30
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$hex[$i].x,$hex[$i].y
                        terrain=Wwg
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE hex}
#enddef
#define GENERATE_DEEP_WATER
    [set_variable]
        name=x_coord
        rand=1..27
    [/set_variable]
    [set_variable]
        name=y_coord
        rand=1..27
    [/set_variable]
    [terrain]
        x=$x_coord
        y=$y_coord
        terrain=Wog
    [/terrain]
    {CLEAR_VARIABLE x_coord}
    {CLEAR_VARIABLE y_coord}
    [store_locations]
        variable=hex
        [filter_adjacent_location]
            terrain=Wog
        [/filter_adjacent_location]
    [/store_locations]
    [for]
        array=hex
        [do]
            [set_variable]
                name=change_terrain
                rand=1..30
            [/set_variable]
            [if]
                [variable]
                    name=change_terrain
                    numerical_equals=1
                [/variable]
                [then]
                    [terrain]
                         x,y=$hex[$i].x,$hex[$i].y
                        terrain=Wog
                    [/terrain]
                [/then]
            [/if]
            {CLEAR_VARIABLE change_terrain}
        [/do]
    [/for]
    {CLEAR_VARIABLE hex}
#enddef

# enemy spawns

    #ifdef HARD
        {RESPAWN_POINT_CONDITIONAL_RANDOM ("Shadow Demon") 5 7 21 7 21 7 ("new_terrain")}
        {RESPAWN_POINT_CONDITIONAL_RANDOM ("Shadow Demon") 5 7 21 7 21 7 ("new_terrain")}
        {RESPAWN_POINT_CONDITIONAL_RANDOM ("Shadow Demon") 5 7 21 7 21 7 ("new_terrain")}
        {RESPAWN_POINT_CONDITIONAL_RANDOM ("Shadow Demon") 5 7 21 7 21 7 ("new_terrain")}
    #endif
    #ifdef NORMAL
        {RESPAWN_POINT_CONDITIONAL_RANDOM ("Shadow Demon") 5 7 21 7 21 14 ("new_terrain")}
        {RESPAWN_POINT_CONDITIONAL_RANDOM ("Shadow Demon") 5 7 21 7 21 14 ("new_terrain")}
        {RESPAWN_POINT_CONDITIONAL_RANDOM ("Shadow Demon") 5 7 21 7 21 14 ("new_terrain")}
        {RESPAWN_POINT_CONDITIONAL_RANDOM ("Shadow Demon") 5 7 21 7 21 14 ("new_terrain")}
    #endif
    #ifdef EASY
        {RESPAWN_POINT_CONDITIONAL_RANDOM ("Shadow Demon") 5 7 21 7 21 19 ("new_terrain")}
        {RESPAWN_POINT_CONDITIONAL_RANDOM ("Shadow Demon") 5 7 21 7 21 19 ("new_terrain")}
        {RESPAWN_POINT_CONDITIONAL_RANDOM ("Shadow Demon") 5 7 21 7 21 19 ("new_terrain")}
        {RESPAWN_POINT_CONDITIONAL_RANDOM ("Shadow Demon") 5 7 21 7 21 19 ("new_terrain")}
    #endif

    [event]
        name=new turn
        first_time_only=no
        [store_locations]
            variable=hex
            terrain=Ha^*,Aa,Ai,Ha,Aa^*,Wwg,Wog
        [/store_locations]
        [for]
            array=hex
            [do]
                #ifdef HARD
                [set_variable]
                    name=spawn_val
                    rand=1..1800
                [/set_variable]
                #endif
                #ifdef NORMAL
                [set_variable]
                    name=spawn_val
                    rand=1..3000
                [/set_variable]
                #endif
                #ifdef EASY
                [set_variable]
                    name=spawn_val
                    rand=1..3600
                [/set_variable]
                #endif
                [if]
                    [variable]
                        name=spawn_val
                        less_than=3
                    [/variable]
                    [then]
                        {SPAWN_NOID ("Dream Dragoon","Dream Swordsman","Dream Javelineer","Dream Knight","Dream Longbowman","Dream Red Mage","Dream White Mage","Dream Pikeman","Dream Shock Trooper") 3 $hex[$i].x $hex[$i].y}
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=spawn_val
                        numerical_equals=4
                    [/variable]
                    [then]
                        {SPAWN_NOID ("Demon Dreamweaver","Demon Nightmare") 2 $hex[$i].x $hex[$i].y}
                    [/then]
                [/if]
                {CLEAR_VARIABLE spawn_val}
            [/do]
        [/for]
        {CLEAR_VARIABLE hex}
        [store_locations]
            variable=hex
            terrain=Wwby
        [/store_locations]
        [for]
            array=hex
            [do]
                [set_variable]
                    name=spawn_val
                    rand=1..700
                [/set_variable]
                [if]
                    [variable]
                        name=spawn_val
                        numerical_equals=1
                    [/variable]
                    [then]
                        {SPAWN_NOID ("Shadow Demon") 5 $hex[$i].x $hex[$i].y}
                    [/then]
                [/if]
                {CLEAR_VARIABLE spawn_val}
            [/do]
        [/for]
        {CLEAR_VARIABLE hex}
    [/event]

    [event]
        name=prestart
        {REPEAT 15 ({GENERATE_SHALLOW_WATER})}
        {REPEAT 7 ({GENERATE_ICE})}
        {REPEAT 7 ({GENERATE_SNOW})}
        {REPEAT 5 ({GENERATE_SHALLOW_WATER})}
        {REPEAT 5 ({GENERATE_ICE})}
        {REPEAT 5 ({GENERATE_SNOW})}
        {REPEAT 5 ({GENERATE_SHALLOW_WATER})}
        {REPEAT 3 ({GENERATE_ICE})}
        {REPEAT 3 ({GENERATE_SNOW})}
        {REPEAT 5 ({GENERATE_SNOW_HILLS})}
        {REPEAT 5 ({GENERATE_SNOW_PINE_FOREST})}
        {REPEAT 5 ({GENERATE_SNOW_MIXED_FOREST})}
        {REPEAT 3 ({GENERATE_ICE})}
        {REPEAT 3 ({GENERATE_SNOW})}
        {REPEAT 3 ({GENERATE_SNOW_HILLS})}
        {REPEAT 3 ({GENERATE_SNOW_PINE_FOREST})}
        {REPEAT 3 ({GENERATE_SNOW_MIXED_FOREST})}
        {RECALL_YUMI_NOLOC}
        [set_variable]
            name=x_coord
            rand=9..19
        [/set_variable]
        [set_variable]
            name=y_coord
            rand=9..19
        [/set_variable]
        [move_unit]
            id=Yumi
            to_x,to_y=$x_coord,$y_coord
        [/move_unit]
        [store_unit]
            [filter]
                id=Esther
            [/filter]
            variable=esther_tmp
        [/store_unit]
        [kill]
            id=Esther
        [/kill]

        # recruiting code for this scenario
        [set_menu_item]
            id=recruit_manifestation
            description= _ "Recruit Manifestation"
            image="attacks/wail.png~SCALE(18,18)"
            [show_if]
                [variable]
                    name=side_number
                    numerical_equals=1
                [/variable]
            [/show_if]
            [filter_location]
                [not]
                    [filter][/filter]
                [/not]
                [filter_adjacent_location]
                    [filter]
                        side=1
                        id=Yumi
                    [/filter]
                [/filter_adjacent_location]
            [/filter_location]
            [command]
                [store_gold]
                    [filter_side]
                        side=1
                    [/filter_side]
                    variable=side1gold
                [/store_gold]
                [if]
                    [variable]
                        name=side1gold
                        less_than=5
                    [/variable]
                    [then]
                        {MESSAGE_NOT_ENOUGH_GOLD}
                    [/then]
                    [else]
                        [unit]
                            side=1
                            type=Manifestation
                            x,y=$x1,$y1
                            moves,attacks_left=0,0
                            animate=yes
                            upkeep=free
                            [modifications]
                                {TRAIT_LOYAL}
                            [/modifications]
                        [/unit]
                        {VARIABLE_OP side1gold sub 5}
                        [modify_side]
                            side=1
                            gold=$side1gold
                        [/modify_side]
                        {CLEAR_VARIABLE side1gold}
                    [/else]
                [/if]
            [/command]
        [/set_menu_item]
        {CLEAR_VARIABLE x_coord}
        {CLEAR_VARIABLE y_coord}
        [sound_source]
            id=s10dark1
            x=14
            y=14
            sounds="dark-2.ogg"
            full_range=100
            delay=0
            loop=-1
            check_fogged=no
            check_shrouded=no
        [/sound_source]
        [set_variable]
            name=new_terrain
            value=0
        [/set_variable]
    [/event]

    [event]
        name=start
        [message]
            speaker=Yumi
            message= _ "(<i>rubs eyes</i>)"
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>Again?</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shivers</i>)"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>It's here, that power. It wants you to use it.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>nods</i>)"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>But you do not want to. You do not trust it. You do not trust yourself.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "... (<i>nods</i>)"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>It will not simply disappear if you ignore it. What will you do?</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>covers ears</i>)"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>So you're giving up.</i>"
        [/message]
        {DELAY 1000}
        [message]
            speaker=Yumi
            message= _ "(<i>shakes head</i>)"
        [/message]

        [objectives]
            {OBJECTIVE_VICTORY  ( _ "Survive until end of turns")}
            {OBJECTIVE_DEFEAT  ( _ "Death of Yumi")}
            {OBJECTIVE_FULL_CARRYOVER}
            {OBJECTIVE_NOTE ( _ "You may recruit by right clicking on a hex next to Yumi.")}
        [/objectives]
    [/event]

    [event]
        name=new turn
        first_time_only=no
        [filter_condition]
            [variable]
                name=new_terrain
                numerical_equals=0
            [/variable]
        [/filter_condition]

        {REPEAT 5 ({GENERATE_SHALLOW_WATER})}
        {GENERATE_ICE}
        {GENERATE_SNOW}
        {GENERATE_SNOW_HILLS}
        {GENERATE_SNOW_PINE_FOREST}
        {GENERATE_SNOW_MIXED_FOREST}
        {REPEAT 5 ({GENERATE_DEEP_WATER})}
    [/event]
    [event]
        name=new turn
        first_time_only=no
        [filter_condition]
            [variable]
                name=new_terrain
                numerical_equals=1
            [/variable]
        [/filter_condition]

        {REGENERATE_TERRAIN}
        {REPEAT 3 ({GENERATE_BLACK_SHALLOW})}
    [/event]

    [event]
        name=attack
        [filter]
            side=3
        [/filter]
        [filter_second]
            id=Yumi
        [/filter_second]
        [message]
            speaker=unit
            message= _ "Die, faerie scum!"
        [/message]
        [harm_unit]
            [filter]
                id=Yumi
            [/filter]
            [filter_second]
                x,y=$x1,$y1
            [/filter_second]
            [primary_attack]
                range=melee
            [/primary_attack]
            [secondary_attack]
                range=melee
            [/secondary_attack]
            animate=yes
            amount=4
        [/harm_unit]
        {DELAY 250}
        [message]
            speaker=Yumi
            message= _ "<i>Ugh. Why would they attack us? What did we do to deserve this?</i>"
        [/message]
        [message]
            speaker=unit
            message= _ "Say something!"
        [/message]
        {DELAY 350}
        [harm_unit]
            [filter]
                id=Yumi
            [/filter]
            [filter_second]
                x,y=$x1,$y1
            [/filter_second]
            [primary_attack]
                range=melee
            [/primary_attack]
            [secondary_attack]
                range=melee
            [/secondary_attack]
            amount=0
            animate=yes
        [/harm_unit]
        [message]
            speaker=unit
            message= _ "What's the matter? Cat got your tongue?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>steps back</i>) <i>I hate this.</i>"
        [/message]
    [/event]

    [event]
        name=turn 4
        [message]
            speaker=narrator
            message= _ "<i>You are so quiet.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>Is there something wrong with that?</i>"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>You keep so much to yourself. Why are you afraid of telling people things? You should not be so scared of opening up.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>I'm not afraid.</i>"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>No?</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>No.</i>"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>You seem upset. Or maybe angry.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>Do I?</i>"
        [/message]
        {DELAY 1500}
        [message]
            speaker=Yumi
            message= _ "(<i>shakes head</i>) <i>I just feel strange.</i>"
        [/message]
    [/event]
    [event]
        name=turn 7
        [message]
            speaker=Yumi
            message= _ "(<i>looks up</i>)"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>eyes gleam</i>)"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>You see what will happen if you use that power? Blood rains from the sky. Everything crumbles into the void. This is your doing.</i>"
        [/message]
        {DELAY 500}
        {TURN_UNIT5 "Yumi"}
        {DELAY 500}
        [message]
            speaker=narrator
            message= _ "<i>You are horrifying, are you not?</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>remains silent</i>)"
        [/message]
    [/event]
    [event]
        name=turn 11
        [store_unit]
            [filter]
                id=Yumi
            [/filter]
            variable=yumi
        [/store_unit]
        {FADE_SCREEN}
        {DELAY 250}
        {PLAY_SOUND "dark-1.ogg"}
        [message]
            speaker=Yumi
            message= _ "(<i>shudders</i>)"
        [/message]
        {DELAY 750}
        {PLAY_SOUND "magic-dark.ogg"}
        {DELAY 550}
        [message]
            speaker=Yumi
            message= _ "<i>Something is coming.</i>"
        [/message]
        {DELAY 500}
        {PLAY_SOUND "magic-dark-miss.ogg"}
        {DELAY 400}
        {PLAY_SOUND "magic-dark.ogg"}
        {DELAY 500}
        {UNFADE_SCREEN}
        {SPAWN_ID ("Demon Incubus") 2 $yumi.x $yumi.y ("boss1") ("male")}
        {SPAWN_ID ("Demon Incubus") 2 $yumi.x $yumi.y ("boss2") ("male")}
        [message]
            speaker=Yumi
            message= _ "<i>Uhh...</i>"
        [/message]
        [message]
            speaker=boss1
            message= _ "Why, she is only a child. The poor thing."
        [/message]
        [message]
            speaker=boss2
            message= _ "One must show a limited amount of empathy for such a creature."
        [/message]
        [message]
            speaker=boss1
            message= _ "That is true."
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>They look strong... should I try to fight or run?</i>"
        [/message]
        [message]
            speaker=boss2
            message= _ "She is frightened."
        [/message]
        [message]
            speaker=boss1
            message= _ "So you suppose. Will you come quietly?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>frowns</i>)"
        [/message]
        [message]
            speaker=boss2
            message= _ "She is silent. So be it."
        [/message]
        [message]
            speaker=boss1
            message= _ "We will have to subdue her by force."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>holds head</i>)"
        [/message]
        {CLEAR_VARIABLE yumi}
    [/event]
    [event]
        name=last breath
        [filter]
            id=boss1
        [/filter]
        [message]
            speaker=boss1
            message= _ "She is powerful, even in our domain. But she cannot resist forever..."
        [/message]
        [kill]
            id=boss1
        [/kill]
    [/event]
    [event]
        name=last breath
        [filter]
            id=boss2
        [/filter]
        [message]
            speaker=boss2
            message= _ "Sooner or later... you will belong to us."
        [/message]
        [kill]
            id=boss2
        [/kill]
        [message]
            speaker=Yumi
            message= _ "<i>All I am is a toy to them...</i>"
        [/message]
    [/event]
    [event]
        name=turn 17
        [message]
            speaker=Yumi
            message= _ "(<i>winces</i>) <i>It hurts...</i>"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>The more you think about it the more harm it will do. You are letting it slip out of control.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>stares at hands</i>)"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>All that passes through your dreams comes into reality.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>remains silent</i>)"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>Are you afraid of the future?</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>Am I?</i>"
        [/message]
        {DELAY 1500}
        [message]
            speaker=Yumi
            message= _ "<i>...I don't know how I feel.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>Esther... Aryel...</i>"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>They cannot help you. They cannot stand before it. You are the only one with that power.</i>"
        [/message]
    [/event]
    [event]
        name=turn 21
        {FADE_SCREEN}
        [terrain]
            x,y=14,14
            radius=2
            terrain=Wwby
        [/terrain]
        [terrain]
            x,y=14,14
            radius=1
            terrain=Woby
        [/terrain]
        [redraw][/redraw]
        [message]
            speaker=Yumi
            message= _ "..."
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>It's so dark.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "..."
        [/message]
        {UNFADE_SCREEN}
        {DELAY 500}
        [store_unit]
            [filter]
                id=Yumi
            [/filter]
            variable=yumi
        [/store_unit]
        [if]
            [variable]
                name=yumi.x
                numerical_equals=14
            [/variable]
            [and]
                [variable]
                    name=yumi.y
                    numerical_equals=14
                [/variable]
            [/and]
            [then]
                [move_unit]
                    id=Yumi
                    to_x,to_y=14,15
                [/move_unit]
            [/then]
        [/if]
        {CLEAR_VARIABLE yumi}
        [message]
            speaker=Yumi
            message= _ "(<i>flinches</i>)"
        [/message]
        {DELAY 750}
        [remove_shroud]
            side=1
            x,y=14,14
            radius=4
        [/remove_shroud]
        [lift_fog]
            [filter_side]
                side=1
            [/filter_side]
            x,y=14,14
            radius=4
            multiturn=yes
        [/lift_fog]
        [redraw]
            clear_shroud=yes
        [/redraw]
        [unit]
            type=Guardian of Darkness
            id=Merthiaal
            name= _ "Merthiaal"
            x,y=14,14
            side=4
            random_traits=no
            find_vacant=yes
        [/unit]
        {DELAY 500}
        [message]
            speaker=Yumi
            message= _ "(<i>pales</i>)"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "Hello. Do you know who I am?"
        [/message]
        {DELAY 1000}
        [message]
            speaker=Merthiaal
            message= _ "I'm going to assume you do. I'm sure you don't know why I'm here, though."
        [/message]
        {DELAY 1000}
        [message]
            speaker=Merthiaal
            message= _ "Are you afraid of me?"
        [/message]
        {DELAY 2000}
        [message]
            speaker=Merthiaal
            message= _ "<i>How strange. I can't tell what she is thinking at all. This is a first.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shudders</i>)"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "I'm not going to hurt you. I just want to help. Please come here."
        [/message]
        {DELAY 1500}
        [message]
            speaker=Merthiaal
            message= _ "<i>She's a difficult one.</i>"
        [/message]
        [set_variable]
            name=new_terrain
            value=1
        [/set_variable]
    [/event]
    [event]
        name=attack
        first_time_only=no
        [filter]
        [/filter]
        [filter_second]
            id=Merthiaal
        [/filter_second]
        [message]
            speaker=Merthiaal
            message= _ "You don't really want to attack me."
        [/message]
        [store_unit]
            [filter]
                id=Merthiaal
            [/filter]
            variable=merthiaal
        [/store_unit]
        [kill]
            x,y=$x2,$y2
        [/kill]
        [unit]
            type=Guardian of Darkness
            id=Merthiaal
            name= _ "Merthiaal"
            x,y=$merthiaal.x,$merthiaal.y
            side=4
            random_traits=no
            find_vacant=yes
            facing=$merthiaal.facing
        [/unit]
        {CLEAR_VARIABLE merthiaal}
    [/event]
    [event]
        name=turn 22
        {COLOR_ADJUST -10 -10 -10}
    [/event]
    [event]
        name=turn 23
        [message]
            speaker=Merthiaal
            message= _ "Why are you afraid of me?"
        [/message]
        {COLOR_ADJUST -20 -20 -20}
    [/event]
    [event]
        name=side 3 turn 23
        [message]
            speaker=Merthiaal
            message= _ "I haven't even done anything to you. The humans and the demons are the ones attacking you. Come here, I'll protect you against them."
        [/message]
    [/event]
    [event]
        name=turn 24
        {DELAY 500}
        [message]
            speaker=Yumi
            message= _ "(<i>holds head</i>)"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "Are you hurt? Maybe I can help you."
        [/message]
        {COLOR_ADJUST -30 -30 -30}
    [/event]
    [event]
        name=turn 25
        [message]
            speaker=Merthiaal
            message= _ "Listen, I'm friends with Xia'el. You don't need to fear me."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shakes head</i>)"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "What's wrong? I just want to protect you. Xia'el trusts me. Don't you trust her?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>looks away</i>)"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "<i>Ah, she doesn't trust anyone. I see. I suppose I can empathize.</i>"
        [/message]
        {COLOR_ADJUST -40 -40 -40}
    [/event]
    [event]
        name=turn 26
        [message]
            speaker=narrator
            message= _ "<i>You two are not so different.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>looks up</i>)"
        [/message]
        {TURN_UNIT5 "Yumi"}
        [message]
            speaker=Merthiaal
            message= _ "(<i>eyes narrow</i>) <i>She can feel it too? I thought so.</i>"
        [/message]
        {COLOR_ADJUST -50 -50 -50}
    [/event]
    [event]
        name=side 5 turn 26
        [message]
            speaker=Merthiaal
            message= _ "<i>Perhaps she is more similar to me than I had originally thought.</i>"
        [/message]
    [/event]
    [event]
        name=turn 27
        [message]
            speaker=narrator
            message= _ "<i>She is the one. She has seen it too. She knows what must be done to stop it.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>turns</i>)"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "(<i>frowns</i>) <i>She's looking at me now? But it's not because of anything I said. What could she be thinking?</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>tenses</i>) <i>Should I trust her?</i>"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>What do you think?</i>"
        [/message]
        {COLOR_ADJUST -60 -60 -60}
    [/event]
    [event]
        name=turn 28
        [store_unit]
            [filter]
                id=Yumi
            [/filter]
            variable=yumi
        [/store_unit]
        [unit]
            type=Fake Shadow Fae
            id=Fake Yumi
            name=_ "Yumi"
            random_traits=no
            side=4
            x,y=$yumi.x,$yumi.y
            find_vacant=yes
        [/unit]
        {CLEAR_VARIABLE yumi}
        {DELAY 500}
        [message]
            speaker=Yumi
            message= _ "(<i>eyes widen</i>)"
        [/message]
        [message]
            speaker=Fake Yumi
            message= _ "<i>What can you do? If they knew, Esther and Aryel wouldn't care enough to help you. And even if they did...</i>"
        [/message]
        [kill]
            id=Fake Yumi
        [/kill]
        [message]
            speaker=narrator
            message= _ "<i>They would not be able to.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>whispers</i>) ... they do care. They'll help me. They'll help me stop it!"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "Who?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>holds hand over mouth</i>) <i>I- I shouldn't have said that-</i>"
        [/message]
        {COLOR_ADJUST -70 -70 -70}
    [/event]
    [event]
        name=turn 29
        [message]
            speaker=Yumi
            message= _ "<i>I guess... it doesn't matter. We're all doomed anyway. It's better if they don't know about it. At least that way, they'll still like me.</i>"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>Is that what you have concluded?</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shrugs</i>)"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>They will find out about it sooner or later, and when they do, all of your secrets will be revealed. What will they think then? Do you think they will give up like you have?</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "I..."
        [/message]
        [message]
            speaker=Yumi
            message= _ "... don't want to give up."
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "(<i>speaks slowly</i>) Are you talking to someone?"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>But what can you do? You do not have what it takes to fight the void on your own.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "I'm... so weak."
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "(<i>frowns</i>) Aren't we all?"
        [/message]
        {COLOR_ADJUST -80 -80 -80}
    [/event]

    [event]
        name=time over
        [store_unit]
            [filter]
                id=Yumi
            [/filter]
            variable=yumi
        [/store_unit]
        [unit]
            type=Fake Shadow Fae
            id=Fake Yumi
            name=_ "Yumi"
            random_traits=no
            side=4
            x,y=$yumi.x,$yumi.y
            find_vacant=yes
        [/unit]
        {CLEAR_VARIABLE yumi}
        {DELAY 500}
        [message]
            speaker=Fake Yumi
            message= _ "<i>Why do you keep fighting?</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>Because... because-</i>"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>You think it is a power you can use. That may be true, but it is not something you can control.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "<i>But- I-</i>"
        [/message]
        [message]
            speaker=Fake Yumi
            message= _ "<i>Shouldn't we just give up?</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>whispers</i>) Give up?"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "Give up on what?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>whispers</i>) Shouldn't we try?"
        [/message]
        {DELAY 1500}
        {COLOR_ADJUST -85 -85 -85}
        [message]
            speaker=Fake Yumi
            message= _ "<i>That takes too much effort. Let's let it all disappear.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>whispers</i>) But, my friends..!"
        [/message]
        [message]
            speaker=Fake Yumi
            message= _ "<i>They're not really-</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "They are! They'll prove you wrong. I trust them. I'm not scared of them."
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "Of... course. Who exactly are you referring to?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>bites lip</i>)"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>She is the one. She has seen it too. The other two cannot help you, but she could... if you would just let her.</i>"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "You don't have to be afraid. You can tell me your secrets. This'll all stay between us. Okay? I won't tell anyone else."
        [/message]
        [message]
            speaker=Fake Yumi
            message= _ "<i>Let's just let her handle it. A small sacrifice is nothing if she actually knows how to stop it.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "I... don't... want to."
        [/message]
        {COLOR_ADJUST -90 -90 -90}
        [message]
            speaker=Merthiaal
            message= _ "Excuse me?"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>You and your friends, you are powerless by yourselves.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "We're not helpless!"
        [/message]
        {COLOR_ADJUST -95 -95 -95}
        [message]
            speaker=Merthiaal
            message= _ "<i>So she is not talking to me. That means...</i>"
        [/message]
        [message]
            speaker=Fake Yumi
            message= _ "<i>She's looking at you. Are you just going to stand there?</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>holds head in hands</i>) No! No, I mean, I know, but-"
        [/message]
        {COLOR_ADJUST -100 -100 -100}
        [message]
            speaker=narrator
            message= _ "<i>You would fight a Guardian?</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "N-no no no. I just..."
        [/message]
        {COLOR_ADJUST -105 -105 -105}
        [message]
            speaker=Merthiaal
            message= _ "Tell me. Who are you talking to? And what are you referring to as 'we'? Friends, perhaps?"
        [/message]
        [message]
            speaker=Fake Yumi
            message= _ "<i>She knows about Esther and Aryel.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "I-I don't have friends."
        [/message]
        {COLOR_ADJUST -110 -110 -110}
        [message]
            speaker=Merthiaal
            message= _ "That's not true. You can't lie to me. You are going to tell me everything-"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>looks around frantically</i>) No!"
        [/message]
        {COLOR_ADJUST -115 -115 -115}
        [message]
            speaker=Merthiaal
            message= _ "<i>She's starting to panic. Is it because of me, or because of something else?</i>"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "Come now. It won't hurt. I'm just trying to-"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shakes head vehemently</i>) S-stop! Please... please- j-just... get out of my head!"
        [/message]
        {COLOR_ADJUST -120 -120 -120}
        [message]
            speaker=Fake Yumi
            message= _ "<i>We have to get out of here, now!</i>"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>There is no escape. It is coming.</i>"
        [/message]
        [message]
            speaker=Yumi
            message= _ "Get out!"
        [/message]
        {COLOR_ADJUST -140 -140 -140}
        [message]
            speaker=Merthiaal
            message= _ "What the-"
        [/message]
        {COLOR_ADJUST -170 -170 -170}
        [message]
            speaker=Merthiaal
            message= _ "<i>She's forcibly removing us from her mind! She has that kind of power?</i>"
        [/message]
        [kill]
            side=2
        [/kill]
        [kill]
            side=3
        [/kill]
        [kill]
            side=5
        [/kill]
        {DELAY 750}
        {COLOR_ADJUST -210 -210 -210}
        [message]
            speaker=Yumi
            message= _ "Leave!"
        [/message]
        [message]
            speaker=Merthiaal
            message= _ "But-"
        [/message]
        [kill]
            id=Merthiaal
        [/kill]
        {DELAY 750}
        {COLOR_ADJUST -255 -255 -255}
        [hide_unit]
        [/hide_unit]
        {DELAY 2000}

        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 100}
            replay_save=no
            carryover_report=no
            linger_mode=no
            next_scenario=11_Frozen_Skies
        [/endlevel]
    [/event]


    # don't forget to unstore Esther
    [event]
        name=victory
        [kill]
            side=1
            type=Manifestation
        [/kill]
        [unstore_unit]
            variable=esther_tmp
            find_vacant=yes
        [/unstore_unit]
        [clear_menu_item]
            id=recruit_manifestation
        [/clear_menu_item]
        {CLEAR_VARIABLE esther_tmp}
        {CLEAR_VARIABLE new_terrain}
    [/event]

    [event]
        name=last breath
        [filter]
            id=Yumi
        [/filter]
        [message]
            speaker=Yumi
            message= _ "(<i>gasps</i>)"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]

#undef GENERATE_DEEP_WATER
#undef GENERATE_SHALLOW_WATER
#undef GENERATE_ICE
#undef GENERATE_SNOW
#undef GENERATE_SNOW_HILLS
#undef GENERATE_SNOW_PINE_FOREST
#undef GENERATE_SNOW_MIXED_FOREST
#undef REGENERATE_TERRAIN
