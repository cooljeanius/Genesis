#textdomain wesnoth-Genesis

[scenario]
    id=01_Ash
    name= _ "Ash"
    map_data="{~add-ons/Genesis/episode1/maps/01_Ash.map}"
    {TURNS 23 21 19}
    theme=Cutscene_Minimal
    next_scenario=02_Red_Peaks
    {STORYTXT_INIT_WARNING}
    {STORYTXT_ASH}

    {EXTENDED_TIME3_DUSK}

    {FAE_DEATHS}

    [side]
        type=Fire Fae
        variation=FF1
        name= _ "Esther"
        id=Esther
        facing=se
        [modifications]
            {TRAIT_FEARLESS}
        [/modifications]
        # profile=portraits/esther.png
        canrecruit=yes
        unrenamable=yes
        side=1
        controller=human
        recruit=Faerie Sprite,Dusk Faerie,Faerie Shaman
        {GOLD 180 170 150}
        village_gold=2
        village_support=1
        team_name=fae
        user_team_name= _ "team_name^Fae"
    [/side]

    [side]
        type=Demon Warrior
        id=Azzarae
        name= _ "Azzarae"
        unrenamable=yes
        canrecruit=yes
        side=2
        recruit=Demon,Winged Demon,Chaos Hound
        {GOLD 70 80 100}
        {INCOME 1 2 3}
		village_gold=1
        team_name=demons
        user_team_name= _ "team_name^Demons"
    [/side]

    {STARTING_VILLAGES_ALL 1}
    {STARTING_VILLAGES 2 8}

    [time_area]
        current_time=0
        x="6,7,8,9,10,11,12"
        y="5-8,5-9,4-9,4-10,4-9,5-9,5-8"
        [time]
            id=shaded
            name= _ "Shaded Forest"
            image=misc/time-schedules/tod-schedule-24hrs.png~CROP(0,195,125,39)
            lawful_bonus=-25
            red=-45
            green=-35
            blue=-10
        [/time]
    [/time_area]

    # enemy creep spawns

    #ifdef HARD
        {RESPAWN_POINT ("Winged Demon") 2 43 20 5}
        {RESPAWN_POINT ("Winged Demon") 2 46 20 5}
        {RESPAWN_POINT ("Winged Demon") 2 48 19 5}
        {RESPAWN_POINT ("Winged Demon") 2 49 17 5}
        {RESPAWN_POINT ("Winged Demon") 2 47 14 5}
    #endif
    #ifdef NORMAL
        {RESPAWN_POINT ("Winged Demon") 2 43 20 7}
        {RESPAWN_POINT ("Winged Demon") 2 46 20 7}
        {RESPAWN_POINT ("Winged Demon") 2 48 19 7}
        {RESPAWN_POINT ("Winged Demon") 2 49 17 7}
        {RESPAWN_POINT ("Winged Demon") 2 47 14 7}
    #endif
    #ifdef EASY
        {RESPAWN_POINT ("Winged Demon") 2 43 20 8}
        {RESPAWN_POINT ("Winged Demon") 2 46 20 8}
        {RESPAWN_POINT ("Winged Demon") 2 48 19 8}
        {RESPAWN_POINT ("Winged Demon") 2 49 17 8}
        {RESPAWN_POINT ("Winged Demon") 2 47 14 8}
    #endif

    [event]
        name=prestart

        {FADE_SCREEN}
        [store_unit]
            [filter]
                id=Esther
            [/filter]
            variable=esther
        [/store_unit]
        [kill]
            id=Esther
        [/kill]
        [modify_side]
            side=1
            shroud=yes
        [/modify_side]
        [place_shroud]
            side=1
            x=1-50
            y=1-21
        [/place_shroud]

        [set_variable]
            name=turn_fire_dmg
            value=0
        [/set_variable]
    [/event]

    [event]
        name=start

        [lua]
            code=<<
                local wml_actions = wesnoth.wml_actions

                function alpha_print(text, size, alpha)

                    local c = helper.round(255 * alpha)

                    wml_actions.print({
                        text = text,
                        size = size,
                        red = c, green = c, blue = c,
                        duration=1000
                    })

                    wesnoth.delay(20)

                    wml_actions.redraw({})
                end

                -- Arguments:
                --   text:          Text displayed
                --   duration:      Duration of the text after fade-in and before fade-out animations, in milliseconds
                function wml_actions.credits_text(cfg)

                    local title = cfg.title
                    local text = cfg.body
                    local duration = cfg.duration
                    --local fade_duration = cfg.fade_duration

                    if text == nil then
                        text = ""
                    end

                    if title ~= nil then
                        text = "<span size='larger' weight='bold'>" .. title .. "</span>\n\n" .. text;
                    end

                    if duration == nil then
                        duration = 5000
                    end

                    for alpha = 0.0, 1.0, 0.1 do
                        alpha_print(text, 20, alpha)
                    end

                    wesnoth.delay(duration)

                    for alpha = 1.0, 0.0, -0.1 do
                        alpha_print(text, 20, alpha)
                    end

                    wml_actions.print({
                        text = text,
                        size = 20,
                        red = 0, green = 0, blue = 0,
                        duration=10
                    })

                    wesnoth.delay(750)
                end
            >>
        [/lua]

        {DELAY 1500}

        [credits_text]
            title= _ "GENESIS"
            duration=3500
        [/credits_text]

        [credits_text]
            title= _ "Part I: Dreams of Darkness"
            duration=2500
        [/credits_text]
        [fade_out_music]
            duration=1500
        [/fade_out_music]
        {REPLACE_SCENARIO_MUSIC silence.ogg}
        {SCROLL_TO 18 10}
        [change_theme]
            theme=default
        [/change_theme]
        [modify_side]
            side=1
            shroud=no
        [/modify_side]
        [remove_shroud]
            side=1
            x=1-50
            y=1-21
        [/remove_shroud]
        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]
        {UNFADE_SCREEN}
        [unstore_unit]
            variable=esther
        [/unstore_unit]
        [unhide_unit]
            [filter][/filter]
        [/unhide_unit]
        {CLEAR_VARIABLE esther}

        {REPLACE_SCENARIO_MUSIC revelation.ogg}

        [message]
            speaker=Esther
            message= _ "Yumi? Yumi, wake up. Yumi..."
        [/message]

        [unit]
            side=1
            type=Shadow Fae
            variation=SF1
            canrecruit=yes
            x,y=9,7
            name= _ "Yumi"
            id=Yumi
            unrenamable=yes
            # profile=portraits/yumi.png
            animate=yes
            facing=se
        [/unit]

        {DELAY 750}

        [message]
            speaker=Yumi
            message= _ "(<i>yawns</i>)"
        [/message]
        [message]
            speaker=Esther
            message= _ "Look, we've got some visitors."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>squints</i>)"
        [/message]

        [scroll_to]
            x,y=42,15
        [/scroll_to]

        {DELAY 2000}

        [message]
            speaker=Yumi
            message= _ "Demons? I thought demons didn't live here on Irdya."
        [/message]
        [message]
            speaker=Esther
            message= _ "They don't, these ones look like they're from Ethea, the world of Life. Wonder why they're here. What do you think?"
        [/message]
        [message]
            speaker=Esther
            message= _ "... Yumi?"
        [/message]
        [message]
            speaker=Esther
            message= _ "Hello? You paying attention?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>stares</i>)"
        [/message]
        [message]
            speaker=Yumi
            message= _ "Looks like we're in for a rough fight."
        [/message]
        [message]
            speaker=Esther
            message= _ "Don't be like that. We're supposed to be allies with Ethea. Maybe they're... just delivering a message or something."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>rolls eyes</i>) Riiight. You saw what they did to the forest over there."
        [/message]
        [message]
            speaker=Esther
            message= _ "Hmm, that's true. Just to be safe, we'd better wake the faeries in the other villages."
        [/message]

        [objectives]
            {OBJECTIVE_VICTORY  ( _ "Defeat Azzarae")}
            {OBJECTIVE_DEFEAT ( _ "Death of Esther")}
            {OBJECTIVE_DEFEAT ( _ "Death of Yumi")}
            {OBJECTIVE_DEFEAT ( _ "Turns run out")}
            {OBJECTIVE_CARRYOVER}
            {OBJECTIVE_NOTE ( _ "Be careful where you place your units, especially during later turns.")}
        [/objectives]

        # replace music
        {REPLACE_SCENARIO_MUSIC battle.ogg}
        {APPEND_MUSIC battle-epic.ogg}
        {APPEND_MUSIC casualties_of_war.ogg}
        {APPEND_MUSIC nunc_dimittis.ogg}
        {APPEND_MUSIC knolls.ogg}
    [/event]


    # fire damage event - turn on turn_fire_dmg to activate this
    [event]
        name=new turn
        first_time_only=no
        [if]
            [variable]
                name=turn_fire_dmg
                numerical_not_equals=0
            [/variable]
            [then]
                [store_unit]
                    [filter]
                        side=1
                        [not]
                            id=Esther
                        [/not]
                    [/filter]
                    variable=fire_dmg_unit
                [/store_unit]
                {PLAY_SOUND "fire.wav"}
            [/then]
        [/if]
        [for]
            array=fire_dmg_unit
            [do]
                [if]
                    [variable]
                        name=fire_dmg_unit[$i].hitpoints
                        greater_than=$turn_fire_dmg
                    [/variable]

                    [then]
                        {VARIABLE_OP fire_dmg_unit[$i].hitpoints sub $turn_fire_dmg}
                    [/then]
                    [else]
                        [set_variable]
                            name=fire_dmg_unit[$i].hitpoints
                            value=1
                        [/set_variable]
                    [/else]
                [/if]
                [unstore_unit]
                    variable=fire_dmg_unit[$i]
                    find_vacant=no
                    text= _ "burned"
                    {COLOR_HARM}
                [/unstore_unit]
            [/do]
        [/for]
        {CLEAR_VARIABLE fire_dmg_unit}
    [/event]

    # some extra events
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            id=Yumi
            x,y=18,10
        [/filter]

        [message]
            speaker=Yumi
            message= _ "I don't know about this, Esther..."
        [/message]
        [message]
            speaker=Esther
            message= _ "It's okay. What are you scared of?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "It's just, well..."
        [/message]
        [message]
            speaker=Esther
            message= _ "Stop worrying! You'll do great!"
        [/message]
    [/event]

    [event]
        name=attack
        first_time_only=yes
        [filter]
            side=2
        [/filter]
        [filter_second]
            id=Yumi
        [/filter_second]

        [message]
            speaker=Esther
            message= _ "Be careful! You'll get hurt!"
        [/message]
    [/event]

    [event]
        name=last breath
        first_time_only=yes
        [filter]
            side=2
            [not]
                type=Chaos Hound, Demonic Hound, Hellhound
            [/not]
        [/filter]
        [filter_second]
            id=Esther
        [/filter_second]

        [message]
            speaker=Esther
            message= _ "Why are you here? Who ordered you to attack us?"
        [/message]
        [message]
            speaker=unit
            message= _ "(<i>stares</i>)"
        [/message]
        [message]
            speaker=Esther
            message= _ "Something's not quite right. Can you hear me? Answer me."
        [/message]
        [message]
            speaker=unit
            message= _ "(<i>stares</i>)"
        [/message]

        [if]
            [variable]
                name=unit.gender
                equals=male
            [/variable]
            [then]
                [message]
                    speaker=Yumi
                    message= _ "He's not talking. Just get rid of him."
                [/message]
                [message]
                    speaker=Esther
                    message= _ "Yumi, that's not-"
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "Look at his eyes. He's being controlled."
                [/message]
                [message]
                    speaker=Esther
                    message= _ "Hmm. I guess you're right."
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Yumi
                    message= _ "She's not talking. Just get rid of her."
                [/message]
                [message]
                    speaker=Esther
                    message= _ "Yumi, that's not-"
                [/message]
                [message]
                    speaker=Yumi
                    message= _ "Look at her eyes. She's being controlled."
                [/message]
                [message]
                    speaker=Esther
                    message= _ "Hmm. I guess you're right."
                [/message]
            [/else]
        [/if]
    [/event]

    [event]
        name=turn 2

        [message]
            speaker=Azzarae
            message= _ "(<i>whispering</i>) Leave no survivors. The Master will be displeased if we are caught here."
        [/message]
        [message]
            speaker=Esther
            message= _ "They're saying something, but I can't quite hear them."
        [/message]
        [message]
            speaker=Yumi
            message= _ "He's probably just giving the order to destroy us..."
        [/message]
        [message]
            speaker=Esther
            message= _ "It seems like it, but it still doesn't make sense to me. Remember, we're allies with Ethea, and Xia'el and Uria are friends."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>tits head</i>)"
        [/message]
        [message]
            speaker=Esther
            message= _ "They're the Guardians of Earth and Life, remember? They keep peace on our worlds. Also means that we don't fight each other, usually."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shrugs</i>)"
        [/message]
        [message]
            speaker=Esther
            message= _ "Isn't this troubling, though? If even Xia'el and Uria are fighting, then there's no telling how many more could be coming for us."
        [/message]
        [message]
            speaker=Yumi
            message= _ "... I guess."
        [/message]
        [message]
            speaker=Esther
            message= _ "Then again, if they really intend fight us, it's not like we really have a choice in the matter."
        [/message]
    [/event]

    # text split into two events so the fire damage goes in the middle of the speech
    [event]
        name=turn 5 end

        [message]
            speaker=Azzarae
            message= _ "... shadows and crimson fire, soot and ash, heed my words..."
        [/message]
        [message]
            speaker=Esther
            message= _ "He's saying something. Sounds like a spell. Should we try to stop him?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "I think he's too far."
        [/message]
        [message]
            speaker=Azzarae
            message= _ "... rise, rise and burn everything to the ground!"
        [/message]
        #ifndef HARD
            [set_variable]
                name=turn_fire_dmg
                value=2
            [/set_variable]
        #endif
        #ifdef HARD
            [set_variable]
                name=turn_fire_dmg
                value=3
            [/set_variable]
        #endif

        {FLASH_RED_EXTREME ({DELAY 1500})}
        {COLOR_ADJUST 50 0 0}
    [/event]
    [event]
        name=side 1 turn 6

        [message]
            speaker=Yumi
            message= _ "Ow!"
        [/message]
        [message]
            speaker=Esther
            message= _ "Yumi! Are you okay?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "I'm... fine. What was that?"
        [/message]
        [message]
            speaker=Esther
            message= _ "The lava, I think. He intends to fry us with its heat."
        [/message]
        [message]
            speaker=Yumi
            message= _ "Ugh, can you do anything about it?"
        [/message]
        [message]
            speaker=Esther
            message= _ "Not unless I can get some time alone to get rid of the magma. We've got to beat them first."
        [/message]
    [/event]
    [event]
        name=turn 10 end

        #ifndef HARD
            [set_variable]
                name=turn_fire_dmg
                value=3
            [/set_variable]
        #endif
        #ifdef HARD
            [set_variable]
                name=turn_fire_dmg
                value=4
            [/set_variable]
        #endif

        {COLOR_ADJUST 75 0 0}
    [/event]
    [event]
        name=side 1 turn 11

        [message]
            speaker=Yumi
            message= _ "Oww..."
        [/message]
        [message]
            speaker=Esther
            message= _ "Hang in there. Don't give up on me now."
        [/message]
        [message]
            speaker=Yumi
            message= _ "I'm trying..."
        [/message]
    [/event]
    [event]
        name=turn 14

        [message]
            speaker=Yumi
            message= _ "(<i>looks up</i>)"
        [/message]
        [message]
            speaker=Yumi
            message= _ "Esther, I have a bad feeling."
        [/message]
        [message]
            speaker=Esther
            message= _ "About?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "The demon magic, it's getting stronger. Look, there, around that patch of burned earth. And there, and-"
        [/message]
        [message]
            speaker=Esther
            message= _ "You're right. We should avoid the burned areas, just to be safe."
        [/message]
    [/event]

    # redrawing terrain events
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=2
            [filter_location]
                terrain=Gll^Fp,Gll^Fdw
            [/filter_location]
        [/filter]

        [message]
            speaker=Esther
            message= _ "They're burning the forest!"
        [/message]
        [message]
            speaker=Yumi
            message= _ "Wonderful."
        [/message]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=2
            [filter_location]
                terrain=Gll^Fp,Gll^Fdw,Gg^Ve,Gg^Fet
            [/filter_location]
        [/filter]
        {PLAY_SOUND "torch.ogg"}
        [terrain]
            x,y=$x1,$y1
            terrain=Rd
        [/terrain]
        [redraw][/redraw]
    [/event]
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=2
            [filter_location]
                terrain=Gg^Fet
            [/filter_location]
        [/filter]

        [message]
            speaker=Azzarae
            message= _ "Leave nothing standing!"
        [/message]
    [/event]

    # better place your units properly before this event
    # luckily, it kills enemies too
    [event]
        name=turn 16

        [message]
            speaker=Azzarae
            message= _ "Fires of abaddon, heed my call Let all who would oppose us know fear! Let all who would resist us be burned to ashes!"
        [/message]

        [store_locations]
            variable=lava_hex
            terrain=Rd
        [/store_locations]
        {PLAY_SOUND "dragonstick.ogg"}
        {DELAY 300}
        {PLAY_SOUND "melee-fire.ogg"}
        {DELAY 300}
        {PLAY_SOUND "dragonstick.ogg"}
        {DELAY 300}
        [music]
            name=vengeful.ogg
            immediate=yes
            play_once=yes
        [/music]
        [for]
            array=lava_hex
            [do]
                [terrain]
                    x,y=$lava_hex[$i].x,$lava_hex[$i].y
                    terrain=Qlf
                [/terrain]
            [/do]
        [/for]
        [redraw][/redraw]
        #ifndef HARD
            {VARIABLE tmp_lava_dmg 15}
        #endif
        #ifdef HARD
            {VARIABLE tmp_lava_dmg 20}
        #endif
        [for]
            array=lava_hex
            [do]
                [if]
                    [have_unit]
                        x,y=$lava_hex[$i].x,$lava_hex[$i].y
                        [not]
                            type=Fire Fae, Shadow Fae, Winged Demon, Demon Zephyr, Demon Windlasher, Demon Stormbringer, Demon Galerunner
                        [/not]
                    [/have_unit]
                    [then]
                        [kill]
                            x,y=$lava_hex[$i].x,$lava_hex[$i].y
                            animate=yes
                            fire_event=yes
                        [/kill]
                    [/then]
                [/if]
                [if]
                    [have_unit]
                        x,y=$lava_hex[$i].x,$lava_hex[$i].y
                        type=Fire Fae, Shadow Fae
                    [/have_unit]
                    [then]
                        [harm_unit]
                            [filter]
                                x,y=$lava_hex[$i].x,$lava_hex[$i].y
                            [/filter]
                            amount=$tmp_lava_dmg
                            damage_type=fire
                            animate=yes
                            fire_event=yes
                        [/harm_unit]
                    [/then]
                [/if]
            [/do]
        [/for]

        {CLEAR_VARIABLE tmp_lava_dmg}
        {CLEAR_VARIABLE lava_hex}
        #ifndef HARD
            [set_variable]
                name=turn_fire_dmg
                value=6
            [/set_variable]
        #endif
        #ifdef HARD
            [set_variable]
                name=turn_fire_dmg
                value=9
            [/set_variable]
        #endif
        {COLOR_ADJUST 100 0 0}

        [message]
            speaker=Esther
            message= _ "Oh no... this is bad. Really bad. We have to finish them off before everyone gets burned to death."
        [/message]
    [/event]

    # victory events
    [event]
        name=last breath
        [filter]
            id=Azzarae
        [/filter]

        [message]
            speaker=unit
            message= _ "Damn you..."
        [/message]

        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]

    [event]
        name=victory
        [message]
            speaker=Esther
            message= _ "Smile, Yumi! We won!"
        [/message]
        [message]
            speaker=Yumi
            message= _ "Ugh."
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>looks around</i>)"
        [/message]

        [scroll_to]
            x,y=42,15
        [/scroll_to]

        {DELAY 1250}

        [scroll_to]
            x,y=40,7
        [/scroll_to]

        {DELAY 1250}

        [scroll_to]
            x,y=31,15
        [/scroll_to]

        {DELAY 1250}

        [message]
            speaker=Yumi
            message= _ "We won. Awesome. Isn't this just the greatest day ever."
        [/message]
        [message]
            speaker=Esther
            message= _ "On the bright side at least we're still alive. Right?"
        [/message]
        [message]
            speaker=Esther
            message= _ "Anyway, I don't think we can stay here forever. We have to- what are you doing?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "Going to sleep. I'm tired."
        [/message]
        [message]
            speaker=Esther
            message= _ "But-"
        [/message]
        [message]
            speaker=Yumi
            message= _ "Please?"
        [/message]
        [message]
            speaker=Esther
            message= _ "(<i>sighs</i>) Okay, but we really shouldn't stay here for too long. After you wake up, we have to get going. Otherwise the demons will hunt us down. Okay?"
        [/message]
        [message]
            speaker=Yumi
            message= _ "(<i>shrugs</i>)"
        [/message]

        {CLEAR_VARIABLE turn_fire_dmg}
    [/event]

    # defeat
    [event]
        name=time over

        [message]
            speaker=Azzarae
            message= _ "The time has come! Now, you are all doomed!"
        [/message]

        {PLAY_SOUND "dragonstick.ogg"}
        {FLASH_RED_EXTREME ({DELAY 1500})}

        [message]
            speaker=Yumi
            message= _ "Great, now we're going to be roasted alive..."
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]
